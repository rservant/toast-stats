openapi: 3.0.3
info:
  title: Toast-Stats API
  description: |
    Toastmasters District Statistics and Analytics API.

    This API provides access to Toastmasters district performance data, club statistics,
    rankings, analytics, and historical data management capabilities.

    ## Features

    - **District Data**: Access district statistics, club information, and performance metrics
    - **Rankings**: Global and district-level ranking comparisons
    - **Analytics**: Membership trends, club health analysis, and leadership insights
    - **Historical Data**: Backfill operations for historical data collection
    - **Administration**: Snapshot management and system administration

    ## Data Model

    The API uses a snapshot-based data model where each snapshot represents a complete,
    normalized view of the source data at a specific point in time. Responses include
    `_snapshot_metadata` to indicate data freshness and source information.

    ## Error Handling

    All error responses follow a consistent format with machine-readable error codes
    and human-readable messages. See the ErrorResponse schema for details.
  version: 1.0.0
  contact:
    name: Development Team

servers:
  - url: http://localhost:3001/api
    description: Development server
  - url: https://ts.taverns.red/api
    description: Production server (primary domain)
  - url: https://toast-stats-prod-6d64a.web.app/api
    description: Production server (Firebase Hosting)
  - url: https://toast-stats-prod-6d64a.firebaseapp.com/api
    description: Production server (Firebase App)

tags:
  - name: Districts
    description: Core district data endpoints
  - name: Rankings
    description: Global and district ranking endpoints
  - name: Analytics
    description: Analytics and insights endpoints
  - name: Backfill
    description: Historical data collection endpoints
  - name: Admin
    description: Administrative and snapshot management endpoints
  - name: Cache
    description: Cache management endpoints

paths:
  /districts:
    get:
      tags:
        - Districts
      operationId: getDistricts
      summary: List all districts
      description: |
        Retrieves a list of all available Toastmasters districts.

        The response includes basic information about each district including
        its identifier, name, status, and last update timestamp. Snapshot metadata
        is included to indicate data freshness.
      responses:
        '200':
          description: Successfully retrieved list of districts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictsResponse'
              example:
                districts:
                  - id: "57"
                    name: "District 57"
                    status: active
                    lastUpdated: "2026-01-24T10:30:00Z"
                  - id: "F"
                    name: "District F"
                    status: active
                    lastUpdated: "2026-01-24T10:30:00Z"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '404':
          description: No data available - no cached district data exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/rankings:
    get:
      tags:
        - Rankings
      operationId: getDistrictRankings
      summary: Get global district rankings
      description: |
        Retrieves comparative rankings for all Toastmasters districts.

        Rankings are calculated using a Borda count methodology that combines
        performance across multiple categories:
        - **Club Growth**: Percentage growth in paid clubs
        - **Payment Growth**: Percentage growth in membership payments
        - **Distinguished Clubs**: Percentage of clubs achieving Distinguished status

        Each district receives an aggregate score based on their performance across
        all categories, with higher scores indicating better overall performance.

        ## Fallback Behavior

        When the `fallback` parameter is set to `true` (default), the API will
        automatically return data from the nearest available snapshot if no data
        exists for the requested date. This is useful for ensuring data availability
        when exact date matches are not critical.

        When `fallback` is `false`, the API will return a 404 error if no snapshot
        exists for the exact requested date.

        The response includes `_snapshot_metadata` with `is_fallback`, `requested_date`,
        and `actual_date` fields to indicate when fallback was applied.
      parameters:
        - $ref: '#/components/parameters/dateQueryParam'
        - name: fallback
          in: query
          required: false
          description: |
            Whether to fall back to the nearest available snapshot if no data
            exists for the requested date.

            - `true` (default): Return data from the nearest available snapshot
            - `false`: Return 404 if no exact match exists

            When fallback is applied, the response metadata will include
            `is_fallback: true` along with `requested_date` and `actual_date`
            to indicate the date substitution.
          schema:
            type: boolean
            default: true
          example: true
      responses:
        '200':
          description: Successfully retrieved district rankings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RankingsResponse'
              examples:
                success:
                  summary: Successful rankings response
                  value:
                    rankings:
                      - districtId: "101"
                        districtName: "District 101"
                        aggregateScore: 342.0
                        clubsRank: 1
                        paymentsRank: 3
                        distinguishedRank: 2
                        overallRank: 1
                        region: "Region 10"
                      - districtId: "57"
                        districtName: "District 57"
                        aggregateScore: 285.5
                        clubsRank: 15
                        paymentsRank: 22
                        distinguishedRank: 8
                        overallRank: 12
                        region: "Region 7"
                    totalDistricts: 120
                    asOfDate: "2026-01-24"
                    programYear: "2025-2026"
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
                fallback:
                  summary: Response with fallback applied
                  value:
                    rankings:
                      - districtId: "101"
                        districtName: "District 101"
                        aggregateScore: 342.0
                        clubsRank: 1
                        paymentsRank: 3
                        distinguishedRank: 2
                        overallRank: 1
                        region: "Region 10"
                    totalDistricts: 120
                    asOfDate: "2026-01-23"
                    programYear: "2025-2026"
                    _snapshot_metadata:
                      snapshot_id: "2026-01-23"
                      created_at: "2026-01-23T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: true
                      fallback_reason: no_snapshot_for_date
                      requested_date: "2026-01-24"
                      actual_date: "2026-01-23"
                      data_source: scraper
                      from_cache: true
        '400':
          description: Bad request - invalid date format or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DATE_FORMAT
                  message: Invalid date format
                  details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                  suggestions:
                    - Use ISO 8601 date format (YYYY-MM-DD)
                    - "Example: 2026-01-24"
        '404':
          description: No data available - no snapshot exists for the requested date (when fallback is disabled)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: SNAPSHOT_NOT_FOUND
                  message: Snapshot not found
                  details: No snapshot exists for date 2026-01-24
                  suggestions:
                    - Check available dates using the /districts/{districtId}/cached-dates endpoint
                    - Enable the fallback parameter to get the nearest available snapshot
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/statistics:
    get:
      tags:
        - Districts
      operationId: getDistrictStatistics
      summary: Get district statistics
      description: |
        Retrieves comprehensive statistics for a specific Toastmasters district.

        The response includes detailed performance metrics organized into several categories:

        - **Membership Metrics**: Total members, growth/decline, new members, renewals
        - **Club Metrics**: Total clubs, active/suspended/ineligible counts, distinguished clubs
        - **Education Metrics**: Educational awards by type, top-performing clubs
        - **Performance Metrics**: DCP goals progress, payment status
        - **Organizational Structure**: Division and area performance breakdowns

        ## Date Selection

        Use the optional `date` query parameter to retrieve statistics for a specific
        date. If not provided, the most recent available snapshot will be returned.

        The response includes `_snapshot_metadata` to indicate data freshness and
        whether any fallback behavior was applied.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/dateQueryParam'
      responses:
        '200':
          description: Successfully retrieved district statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictStatisticsResponse'
              example:
                statistics:
                  districtId: "57"
                  districtName: "District 57"
                  asOfDate: "2026-01-24"
                  membership:
                    total: 2500
                    change: 150
                    changePercent: 6.38
                    new: 200
                    renewed: 1800
                    dual: 45
                    byClub:
                      - clubId: "1234567"
                        clubName: "Downtown Speakers"
                        memberCount: 25
                  clubs:
                    total: 120
                    active: 105
                    suspended: 5
                    ineligible: 3
                    low: 7
                    distinguished: 45
                    chartered: 8
                  education:
                    totalAwards: 450
                    byType:
                      - type: "Level 1"
                        count: 120
                      - type: "Level 2"
                        count: 85
                    topClubs:
                      - clubId: "1234567"
                        clubName: "Downtown Speakers"
                        awards: 25
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID or date format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
        '404':
          description: Not found - district or snapshot not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                snapshotNotFound:
                  summary: No snapshot for requested date
                  value:
                    error:
                      code: SNAPSHOT_NOT_FOUND
                      message: Snapshot not found
                      details: No snapshot exists for date 2026-01-24
                      suggestions:
                        - Check available dates using the /districts/{districtId}/cached-dates endpoint
                        - Use the fallback parameter to get the nearest available snapshot
                noDataAvailable:
                  summary: No data available for district
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: No data available
                      details: No cached data exists for district 57
                      suggestions:
                        - Verify the district ID is correct
                        - Check if data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/clubs:
    get:
      tags:
        - Districts
      operationId: getDistrictClubs
      summary: Get clubs in a district
      description: |
        Retrieves a list of all clubs within a specific Toastmasters district.

        The response includes detailed information about each club including:

        - **Club Identity**: Club ID, name, division, and area
        - **Membership**: Current member count, active members, membership base
        - **Performance**: DCP goals achieved, goals list, distinguished status
        - **Status**: Active, suspended, low membership, or ineligible status
        - **History**: Charter date and educational awards count

        Clubs are sorted by division and area by default. The response also includes
        summary statistics for quick overview of club health across the district.

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
      responses:
        '200':
          description: Successfully retrieved clubs for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClubsResponse'
              example:
                clubs:
                  - clubId: "1234567"
                    clubName: "Downtown Speakers"
                    division: "A"
                    area: "12"
                    memberCount: 25
                    activeMembers: 22
                    membershipBase: 20
                    goalsAchieved: 7
                    goalsList:
                      - "2+ CCs or 2+ ACs or combination"
                      - "Add 4 new members"
                    status: active
                    distinguishedStatus: "Select Distinguished"
                    charterDate: "2015-03-15"
                    educationalAwards: 12
                  - clubId: "7654321"
                    clubName: "Morning Leaders"
                    division: "A"
                    area: "12"
                    memberCount: 32
                    activeMembers: 30
                    membershipBase: 28
                    goalsAchieved: 9
                    goalsList:
                      - "2+ CCs or 2+ ACs or combination"
                      - "Add 4 new members"
                      - "4 or more officers trained Round 1"
                    status: active
                    distinguishedStatus: "President's Distinguished"
                    charterDate: "2010-09-01"
                    educationalAwards: 18
                totalClubs: 120
                summary:
                  activeClubs: 105
                  suspendedClubs: 5
                  lowMembershipClubs: 7
                  distinguishedClubs: 45
                  selectDistinguishedClubs: 15
                  presidentsDistinguishedClubs: 8
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: Invalid district ID format
                  details: District ID must be alphanumeric
                  suggestions:
                    - Use a valid district ID like "57" or "F"
                    - Check the /districts endpoint for available district IDs
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No cached data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/membership-history:
    get:
      tags:
        - Districts
      operationId: getDistrictMembershipHistory
      summary: Get district membership history
      description: |
        Retrieves historical membership data for a specific Toastmasters district.

        The response includes a time series of membership data points showing how
        the district's membership has changed over time. Each data point includes
        the date, total membership count, and change metrics from the previous period.

        ## Time Range

        Use the optional `months` query parameter to specify how many months of
        historical data to retrieve. If not provided, defaults to 6 months.
        Maximum allowed is 24 months.

        This endpoint is useful for:
        - Visualizing membership growth or decline trends
        - Identifying seasonal patterns in membership
        - Comparing current performance to historical baselines
        - Supporting data-driven membership growth strategies

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/monthsParam'
      responses:
        '200':
          description: Successfully retrieved membership history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MembershipHistoryResponse'
              example:
                membershipHistory:
                  - date: "2026-01-24"
                    value: 2500
                    change: 15
                    changePercent: 0.6
                  - date: "2026-01-17"
                    value: 2485
                    change: 20
                    changePercent: 0.81
                  - date: "2026-01-10"
                    value: 2465
                    change: -5
                    changePercent: -0.2
                  - date: "2026-01-03"
                    value: 2470
                    change: 10
                    changePercent: 0.41
                districtId: "57"
                districtName: "District 57"
                months: 6
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID or months parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidMonths:
                  summary: Invalid months parameter
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid months parameter
                      details: Months must be between 1 and 24
                      suggestions:
                        - Provide a value between 1 and 24
                        - Omit the parameter to use the default of 6 months
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No membership history data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if historical data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/educational-awards:
    get:
      tags:
        - Districts
      operationId: getDistrictEducationalAwards
      summary: Get district educational awards
      description: |
        Retrieves educational awards data for a specific Toastmasters district.

        The response includes comprehensive educational achievement statistics showing
        awards earned by district members over time. Data includes:

        - **Total Awards**: Overall count of educational awards earned
        - **Awards by Type**: Breakdown by award type (Pathways levels, legacy awards)
        - **Top Clubs**: Clubs with the highest number of educational awards
        - **Monthly Trends**: Awards earned per month for trend analysis

        ## Time Range

        Use the optional `months` query parameter to specify how many months of
        historical data to retrieve. If not provided, defaults to 6 months.
        Maximum allowed is 24 months.

        This endpoint is useful for:
        - Tracking educational achievement progress across the district
        - Identifying high-performing clubs in education
        - Analyzing seasonal patterns in award completions
        - Supporting district education goals and initiatives

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/monthsParam'
      responses:
        '200':
          description: Successfully retrieved educational awards data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EducationalAwardsResponse'
              example:
                educationalAwards:
                  totalAwards: 450
                  byType:
                    - type: "Level 1"
                      count: 120
                    - type: "Level 2"
                      count: 85
                    - type: "Level 3"
                      count: 60
                    - type: "Level 4"
                      count: 35
                    - type: "Level 5"
                      count: 25
                    - type: "DTM"
                      count: 5
                  topClubs:
                    - clubId: "1234567"
                      clubName: "Downtown Speakers"
                      awards: 25
                    - clubId: "7654321"
                      clubName: "Morning Leaders"
                      awards: 22
                    - clubId: "9876543"
                      clubName: "Evening Orators"
                      awards: 18
                  byMonth:
                    - month: "2026-01"
                      count: 52
                    - month: "2025-12"
                      count: 48
                    - month: "2025-11"
                      count: 45
                    - month: "2025-10"
                      count: 38
                    - month: "2025-09"
                      count: 42
                    - month: "2025-08"
                      count: 55
                districtId: "57"
                districtName: "District 57"
                months: 6
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID or months parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidMonths:
                  summary: Invalid months parameter
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid months parameter
                      details: Months must be between 1 and 24
                      suggestions:
                        - Provide a value between 1 and 24
                        - Omit the parameter to use the default of 6 months
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No educational awards data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if educational data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/daily-reports:
    get:
      tags:
        - Districts
      operationId: getDistrictDailyReports
      summary: Get district daily reports
      description: |
        Retrieves daily activity reports for a specific Toastmasters district within a date range.

        The response includes a summary of daily activities including new members, renewals,
        club changes, and awards earned. Each report represents a single day's activity.

        ## Date Range Requirements

        Both `startDate` and `endDate` query parameters are **required** for this endpoint.
        The date range defines the period for which daily reports will be returned.

        **Validation Rules:**
        - Both startDate and endDate must be provided
        - Dates must be in ISO 8601 format (YYYY-MM-DD)
        - startDate must be before or equal to endDate
        - Date range cannot exceed 365 days

        This endpoint is useful for:
        - Tracking daily membership activity
        - Monitoring club changes and awards
        - Analyzing activity patterns over time
        - Generating activity reports for district leadership

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - name: startDate
          in: query
          required: true
          description: |
            Start date for the daily reports range in ISO 8601 format (YYYY-MM-DD).
            This parameter is required. Must be before or equal to endDate.
          schema:
            type: string
            format: date
          example: "2025-07-01"
        - name: endDate
          in: query
          required: true
          description: |
            End date for the daily reports range in ISO 8601 format (YYYY-MM-DD).
            This parameter is required. Must be after or equal to startDate.
          schema:
            type: string
            format: date
          example: "2026-01-24"
      responses:
        '200':
          description: Successfully retrieved daily reports for the date range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailyReportsResponse'
              example:
                reports:
                  - date: "2026-01-24"
                    newMembers: 5
                    renewals: 12
                    clubChanges:
                      - clubId: "1234567"
                        change: "New club chartered"
                    awards: 8
                  - date: "2026-01-23"
                    newMembers: 3
                    renewals: 8
                    clubChanges: []
                    awards: 5
                  - date: "2026-01-22"
                    newMembers: 7
                    renewals: 15
                    clubChanges:
                      - clubId: "7654321"
                        change: "Club suspended"
                    awards: 12
                districtId: "57"
                districtName: "District 57"
                dateRange:
                  startDate: "2025-07-01"
                  endDate: "2026-01-24"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - missing date parameters, invalid date format, or invalid date range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                missingDateParameters:
                  summary: Missing required date parameters
                  value:
                    error:
                      code: MISSING_DATE_PARAMETERS
                      message: Missing required date parameters
                      details: Both startDate and endDate query parameters are required
                      suggestions:
                        - Provide both startDate and endDate parameters
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: ?startDate=2025-07-01&endDate=2026-01-24"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
                invalidDateRange:
                  summary: Invalid date range (start after end)
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: Start date must be before or equal to end date
                      suggestions:
                        - Ensure startDate is before endDate
                        - Check that dates are in the correct order
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No daily reports data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/daily-reports/{date}:
    get:
      tags:
        - Districts
      operationId: getDistrictDailyReportByDate
      summary: Get district daily report for a specific date
      description: |
        Retrieves the daily activity report for a specific Toastmasters district on a specific date.

        The response includes a summary of daily activities including new members, renewals,
        club changes, and awards earned for the specified date.

        ## Date Parameter

        The `date` path parameter specifies the exact date for which to retrieve the daily report.
        The date must be in ISO 8601 format (YYYY-MM-DD).

        This endpoint is useful for:
        - Retrieving activity data for a specific day
        - Checking membership changes on a particular date
        - Monitoring club changes and awards for a specific date
        - Generating single-day activity reports for district leadership

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - name: date
          in: path
          required: true
          description: |
            The specific date for the daily report in ISO 8601 format (YYYY-MM-DD).
          schema:
            type: string
            format: date
          example: "2026-01-24"
      responses:
        '200':
          description: Successfully retrieved daily report for the specified date
          content:
            application/json:
              schema:
                type: object
                required:
                  - report
                properties:
                  report:
                    $ref: '#/components/schemas/DailyReportSummary'
                  districtId:
                    type: string
                    description: District identifier
                    example: "57"
                  districtName:
                    type: string
                    description: District name
                    example: "District 57"
                  _snapshot_metadata:
                    $ref: '#/components/schemas/SnapshotMetadata'
              example:
                report:
                  date: "2026-01-24"
                  newMembers: 5
                  renewals: 12
                  clubChanges:
                    - clubId: "1234567"
                      change: "New club chartered"
                  awards: 8
                districtId: "57"
                districtName: "District 57"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID or date format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
        '404':
          description: Not found - district not found, date not found, or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for district
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: No data available
                      details: No daily report data exists for district 57 on 2026-01-24
                      suggestions:
                        - Verify the district ID is correct
                        - Check if data has been collected for this district and date
                        - Use the /districts/{districtId}/cached-dates endpoint to find available dates
                snapshotNotFound:
                  summary: No snapshot for requested date
                  value:
                    error:
                      code: SNAPSHOT_NOT_FOUND
                      message: Snapshot not found
                      details: No snapshot exists for date 2026-01-24
                      suggestions:
                        - Check available dates using the /districts/{districtId}/cached-dates endpoint
                        - Try a different date
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/rank-history:
    get:
      tags:
        - Rankings
      operationId: getDistrictRankHistory
      summary: Get district rank history
      description: |
        Retrieves historical ranking data for a specific Toastmasters district over a date range.

        The response includes a time series of ranking data points showing how the district's
        rankings have changed over time. Each data point includes the date and ranking metrics
        (overall rank, clubs rank, payments rank, distinguished rank, and aggregate score).

        ## Date Range

        Use the optional `startDate` and `endDate` query parameters to specify the date range
        for historical data. If not provided, defaults to the current program year.

        This endpoint is useful for:
        - Visualizing ranking trends over time
        - Identifying periods of improvement or decline
        - Comparing ranking performance across different time periods
        - Supporting data-driven district leadership decisions

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully retrieved rank history for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RankHistoryResponse'
              example:
                history:
                  - date: "2026-01-24"
                    overallRank: 12
                    clubsRank: 15
                    paymentsRank: 22
                    distinguishedRank: 8
                    aggregateScore: 285.5
                  - date: "2026-01-17"
                    overallRank: 14
                    clubsRank: 16
                    paymentsRank: 24
                    distinguishedRank: 9
                    aggregateScore: 278.0
                  - date: "2026-01-10"
                    overallRank: 15
                    clubsRank: 18
                    paymentsRank: 23
                    distinguishedRank: 10
                    aggregateScore: 272.5
                  - date: "2026-01-03"
                    overallRank: 16
                    clubsRank: 19
                    paymentsRank: 25
                    distinguishedRank: 11
                    aggregateScore: 268.0
                districtId: "57"
                districtName: "District 57"
                programYear: "2025-2026"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID, date format, or date range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: Start date must be before or equal to end date
                      suggestions:
                        - Ensure startDate is before endDate
                        - Check that both dates are valid
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for district
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: No data available
                      details: No rank history data exists for district 57
                      suggestions:
                        - Verify the district ID is correct
                        - Check if historical data has been collected for this district
                snapshotNotFound:
                  summary: No snapshot for requested date range
                  value:
                    error:
                      code: SNAPSHOT_NOT_FOUND
                      message: Snapshot not found
                      details: No snapshots exist for the requested date range
                      suggestions:
                        - Check available dates using the /districts/{districtId}/cached-dates endpoint
                        - Try a different date range
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/available-ranking-years:
    get:
      tags:
        - Rankings
      operationId: getDistrictAvailableRankingYears
      summary: Get available ranking years for a district
      description: |
        Retrieves a list of Toastmasters program years for which ranking data is available
        for a specific district.

        The response includes an array of program years in descending order (most recent first).
        Each program year follows the Toastmasters fiscal year format (July 1 - June 30),
        represented as "YYYY-YYYY" (e.g., "2025-2026").

        This endpoint is useful for:
        - Populating year selection dropdowns in user interfaces
        - Determining the range of historical data available for analysis
        - Validating date range parameters before making other API calls
        - Understanding data coverage for a specific district

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
      responses:
        '200':
          description: Successfully retrieved available ranking years for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailableRankingYearsResponse'
              example:
                programYears:
                  - "2025-2026"
                  - "2024-2025"
                  - "2023-2024"
                districtId: "57"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: Invalid district ID format
                  details: District ID must be alphanumeric
                  suggestions:
                    - Use a valid district ID like "57" or "F"
                    - Check the /districts endpoint for available district IDs
        '404':
          description: Not found - district not found or no ranking data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No ranking data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if ranking data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/cached-dates:
    get:
      tags:
        - Cache
      operationId: getDistrictCachedDates
      summary: Get cached snapshot dates for a district
      description: |
        Retrieves a list of dates for which cached snapshot data is available
        for a specific district.

        The response includes:
        - **dates**: Array of ISO date strings (YYYY-MM-DD) representing available snapshots
        - **dateRange**: Object containing the earliest and latest available dates
        - **districtId**: The district identifier for which dates were retrieved

        This endpoint is useful for:
        - Determining which dates have cached data available
        - Populating date selection controls in user interfaces
        - Validating date parameters before making other API calls
        - Understanding data coverage and gaps for a specific district

        Dates are returned in descending order (most recent first).

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
      responses:
        '200':
          description: Successfully retrieved cached dates for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CachedDatesResponse'
              example:
                dates:
                  - "2026-01-24"
                  - "2026-01-23"
                  - "2026-01-22"
                  - "2026-01-21"
                  - "2026-01-20"
                dateRange:
                  startDate: "2025-07-01"
                  endDate: "2026-01-24"
                districtId: "57"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: Invalid district ID format
                  details: District ID must be alphanumeric
                  suggestions:
                    - Use a valid district ID like "57" or "F"
                    - Check the /districts endpoint for available district IDs
        '404':
          description: Not found - district not found or no cached data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No data available
                  details: No cached data exists for district 57
                  suggestions:
                    - Verify the district ID is correct
                    - Check if data has been collected for this district
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/cache/dates:
    get:
      tags:
        - Cache
      operationId: getGlobalCachedDates
      summary: Get all cached snapshot dates across all districts
      description: |
        Retrieves a list of dates for which cached snapshot data is available
        across all districts in the system.

        Unlike the district-specific `/districts/{districtId}/cached-dates` endpoint,
        this endpoint returns dates that have cached data for any district, providing
        a global view of data availability.

        The response includes:
        - **dates**: Array of ISO date strings (YYYY-MM-DD) for available snapshots
        - **dateRange**: Object with earliest and latest dates (optional)

        This endpoint is useful for:
        - Determining the overall data coverage across the system
        - Populating global date selection controls in user interfaces
        - Understanding system-wide data availability and gaps
        - Administrative monitoring of data collection status

        Dates are returned in descending order (most recent first).

        The response includes `_snapshot_metadata` to indicate data freshness and
        source information.
      responses:
        '200':
          description: Successfully retrieved global cached dates
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GlobalCachedDatesResponse'
              example:
                dates:
                  - "2026-01-24"
                  - "2026-01-23"
                  - "2026-01-22"
                  - "2026-01-21"
                  - "2026-01-20"
                dateRange:
                  startDate: "2025-07-01"
                  endDate: "2026-01-24"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '404':
          description: No cached dates available - no snapshots exist in the system
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: No cached dates available
                  details: No snapshots have been collected yet
                  suggestions:
                    - Initiate a backfill operation to collect historical data
                    - Check if the data collection service is running
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'

  /districts/{districtId}/analytics:
    get:
      tags:
        - Analytics
      operationId: getDistrictAnalytics
      summary: Get comprehensive analytics for a district
      description: |
        Retrieves comprehensive analytics data for a specific Toastmasters district
        over a specified date range.

        This endpoint provides aggregated insights including:
        - **Membership Metrics**: Total membership, net change, and percentage change
        - **Club Health Categorization**: Clubs categorized as thriving, vulnerable, or requiring intervention
        - **Distinguished Club Achievements**: Counts and breakdown by distinguished level
        - **Membership Trends**: Time series data showing membership changes over the period

        ## Date Range Parameters

        Both `startDate` and `endDate` are optional:
        - If neither is provided, defaults to the current program year (July 1 to present)
        - If only `startDate` is provided, `endDate` defaults to the most recent available date
        - If only `endDate` is provided, `startDate` defaults to the start of the program year

        ## Club Health Categories

        Clubs are categorized based on membership levels, goal achievement, and trends:
        - **Thriving**: Strong membership (20+), high goal achievement (5+ DCP goals), positive growth
        - **Vulnerable**: Warning signs such as declining membership (8-12 members), few goals achieved
        - **Intervention Required**: Critical condition with very low membership (<8), suspended status, or no goals

        ## Use Cases

        - District leadership dashboards and reporting
        - Identifying clubs that need support or recognition
        - Tracking district progress toward goals
        - Year-over-year performance comparisons

        The response includes `_snapshot_metadata` to indicate data freshness and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully retrieved district analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistrictAnalyticsResponse'
              example:
                analytics:
                  districtId: "57"
                  totalMembership: 2500
                  membershipChange: 150
                  membershipChangePercent: 6.38
                  totalClubs: 120
                  activeClubs: 105
                  thrivingClubs:
                    - clubId: "1234567"
                      clubName: "Downtown Speakers"
                      division: "A"
                      area: "12"
                      memberCount: 32
                      goalsAchieved: 8
                      status: active
                      distinguishedStatus: "Select Distinguished"
                    - clubId: "7654321"
                      clubName: "Morning Leaders"
                      division: "A"
                      area: "13"
                      memberCount: 28
                      goalsAchieved: 7
                      status: active
                      distinguishedStatus: "Distinguished"
                  vulnerableClubs:
                    - clubId: "2345678"
                      clubName: "Sunset Speakers"
                      division: "B"
                      area: "21"
                      memberCount: 10
                      goalsAchieved: 2
                      status: active
                  interventionRequiredClubs:
                    - clubId: "4567890"
                      clubName: "Evening Orators"
                      division: "D"
                      area: "41"
                      memberCount: 6
                      goalsAchieved: 0
                      status: low
                  distinguishedClubs:
                    total: 45
                    distinguished: 22
                    selectDistinguished: 15
                    presidentsDistinguished: 8
                    percentageOfTotal: 37.5
                  membershipTrend:
                    - date: "2025-07-01"
                      value: 2350
                      change: 0
                      changePercent: 0
                    - date: "2025-10-01"
                      value: 2420
                      change: 70
                      changePercent: 2.98
                    - date: "2026-01-24"
                      value: 2500
                      change: 80
                      changePercent: 3.31
                  dateRange:
                    startDate: "2025-07-01"
                    endDate: "2026-01-24"
                    daysInRange: 208
                  programYear: "2025-2026"
                  calculatedAt: "2026-01-24T10:30:00Z"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date format"
                      details: "Date must be in ISO 8601 format (YYYY-MM-DD)"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: "Invalid date range"
                      details: "Start date must be before or equal to end date"
        '404':
          description: District or data not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for the specified date range
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: "No data available for the specified date range"
                      details: "No cached snapshots exist for district 57 between 2025-07-01 and 2026-01-24"
                      suggestions:
                        - "Try a different date range"
                        - "Check available dates using GET /districts/{districtId}/cached-dates"
                        - "Initiate a backfill operation to collect historical data"
        '500':
          description: Internal server error - analytics generation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to generate analytics"
                  details: "An error occurred while calculating district analytics"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/membership-analytics:
    get:
      tags:
        - Analytics
      operationId: getDistrictMembershipAnalytics
      summary: Get detailed membership analytics for a district
      description: |
        Retrieves detailed membership analytics for a specific Toastmasters district
        over a specified date range.

        This endpoint provides in-depth membership analysis including:
        - **Membership Growth/Decline Trends**: Historical membership changes with trend analysis
        - **New Member Acquisition Rates**: Tracking of new member joins over time
        - **Retention Metrics**: Member retention rates and renewal patterns
        - **Membership by Club Breakdown**: Per-club membership distribution and changes

        ## Date Range Parameters

        Both `startDate` and `endDate` are optional:
        - If neither is provided, defaults to the current program year (July 1 to present)
        - If only `startDate` is provided, `endDate` defaults to the most recent available date
        - If only `endDate` is provided, `startDate` defaults to the start of the program year

        ## Trend Analysis

        The endpoint calculates trend direction and strength based on membership changes:
        - **Strong Growth**: Consistent positive growth exceeding 5% over the period
        - **Moderate Growth**: Positive growth between 2-5%
        - **Stable**: Changes within 2%
        - **Moderate Decline**: Negative change between 2-5%
        - **Strong Decline**: Consistent negative change exceeding 5%

        ## Use Cases

        - Membership committee planning and strategy
        - Identifying clubs with strong recruitment performance
        - Analyzing seasonal membership patterns
        - Supporting retention improvement initiatives
        - District goal tracking for membership growth

        The response includes `_snapshot_metadata` to indicate data freshness and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully retrieved membership analytics
          content:
            application/json:
              schema:
                type: object
                required:
                  - membershipAnalytics
                  - _snapshot_metadata
                properties:
                  membershipAnalytics:
                    type: object
                    description: Detailed membership analytics data for the district
                    required:
                      - districtId
                      - districtName
                      - dateRange
                      - summary
                      - trends
                      - acquisition
                      - retention
                      - byClub
                    properties:
                      districtId:
                        type: string
                        description: District identifier
                        example: "57"
                      districtName:
                        type: string
                        description: District name
                        example: "District 57"
                      dateRange:
                        type: object
                        description: The date range covered by this analytics report
                        required:
                          - startDate
                          - endDate
                          - daysInRange
                        properties:
                          startDate:
                            type: string
                            format: date
                            description: Start date of the analysis period
                            example: "2025-07-01"
                          endDate:
                            type: string
                            format: date
                            description: End date of the analysis period
                            example: "2026-01-24"
                          daysInRange:
                            type: integer
                            description: Number of days in the analysis period
                            example: 208
                      summary:
                        type: object
                        description: High-level membership summary statistics
                        required:
                          - startingMembership
                          - endingMembership
                          - netChange
                          - percentChange
                          - trendDirection
                        properties:
                          startingMembership:
                            type: integer
                            description: Total membership at the start of the period
                            example: 2350
                          endingMembership:
                            type: integer
                            description: Total membership at the end of the period
                            example: 2500
                          netChange:
                            type: integer
                            description: Net change in membership over the period
                            example: 150
                          percentChange:
                            type: number
                            format: float
                            description: Percentage change in membership
                            example: 6.38
                          trendDirection:
                            type: string
                            description: Overall trend direction based on membership changes
                            enum:
                              - strong_growth
                              - moderate_growth
                              - stable
                              - moderate_decline
                              - strong_decline
                            example: "moderate_growth"
                      trends:
                        type: object
                        description: Membership trend data over time
                        required:
                          - dataPoints
                          - averageWeeklyChange
                          - averageMonthlyChange
                        properties:
                          dataPoints:
                            type: array
                            description: Time series of membership data points
                            items:
                              type: object
                              required:
                                - date
                                - totalMembership
                                - change
                                - changePercent
                              properties:
                                date:
                                  type: string
                                  format: date
                                  description: Date of the data point
                                  example: "2026-01-24"
                                totalMembership:
                                  type: integer
                                  description: Total membership on this date
                                  example: 2500
                                change:
                                  type: integer
                                  description: Change from previous data point
                                  example: 15
                                changePercent:
                                  type: number
                                  format: float
                                  description: Percentage change from previous data point
                                  example: 0.6
                          averageWeeklyChange:
                            type: number
                            format: float
                            description: Average weekly membership change over the period
                            example: 5.2
                          averageMonthlyChange:
                            type: number
                            format: float
                            description: Average monthly membership change over the period
                            example: 21.4
                      acquisition:
                        type: object
                        description: New member acquisition metrics
                        required:
                          - totalNewMembers
                          - averageNewMembersPerMonth
                          - topAcquisitionClubs
                          - byMonth
                        properties:
                          totalNewMembers:
                            type: integer
                            description: Total new members acquired during the period
                            example: 320
                          averageNewMembersPerMonth:
                            type: number
                            format: float
                            description: Average new members per month
                            example: 45.7
                          topAcquisitionClubs:
                            type: array
                            description: Clubs with highest new member acquisition
                            items:
                              type: object
                              required:
                                - clubId
                                - clubName
                                - newMembers
                              properties:
                                clubId:
                                  type: string
                                  description: Club identifier
                                  example: "1234567"
                                clubName:
                                  type: string
                                  description: Club name
                                  example: "Downtown Speakers"
                                newMembers:
                                  type: integer
                                  description: Number of new members acquired
                                  example: 18
                          byMonth:
                            type: array
                            description: New member acquisition by month
                            items:
                              type: object
                              required:
                                - month
                                - newMembers
                              properties:
                                month:
                                  type: string
                                  description: Month in YYYY-MM format
                                  example: "2026-01"
                                newMembers:
                                  type: integer
                                  description: New members acquired in this month
                                  example: 52
                      retention:
                        type: object
                        description: Member retention metrics
                        required:
                          - retentionRate
                          - renewedMembers
                          - lapsedMembers
                          - atRiskMembers
                        properties:
                          retentionRate:
                            type: number
                            format: float
                            description: Percentage of members retained over the period
                            example: 85.5
                          renewedMembers:
                            type: integer
                            description: Number of members who renewed during the period
                            example: 1800
                          lapsedMembers:
                            type: integer
                            description: Number of members who did not renew
                            example: 170
                          atRiskMembers:
                            type: integer
                            description: Members approaching renewal deadline
                            example: 45
                      byClub:
                        type: array
                        description: Membership breakdown by club
                        items:
                          type: object
                          required:
                            - clubId
                            - clubName
                            - division
                            - area
                            - currentMembership
                            - startingMembership
                            - netChange
                            - percentChange
                            - newMembers
                            - retentionRate
                          properties:
                            clubId:
                              type: string
                              description: Club identifier
                              example: "1234567"
                            clubName:
                              type: string
                              description: Club name
                              example: "Downtown Speakers"
                            division:
                              type: string
                              description: Division the club belongs to
                              example: "A"
                            area:
                              type: string
                              description: Area the club belongs to
                              example: "12"
                            currentMembership:
                              type: integer
                              description: Current membership count
                              example: 25
                            startingMembership:
                              type: integer
                              description: Membership at start of period
                              example: 22
                            netChange:
                              type: integer
                              description: Net change in membership
                              example: 3
                            percentChange:
                              type: number
                              format: float
                              description: Percentage change in membership
                              example: 13.6
                            newMembers:
                              type: integer
                              description: New members acquired by this club
                              example: 5
                            retentionRate:
                              type: number
                              format: float
                              description: Member retention rate for this club
                              example: 90.0
                      programYear:
                        type: string
                        description: Toastmasters program year
                        example: "2025-2026"
                      calculatedAt:
                        type: string
                        format: date-time
                        description: Timestamp when analytics were calculated
                        example: "2026-01-24T10:30:00Z"
                  _snapshot_metadata:
                    $ref: '#/components/schemas/SnapshotMetadata'
              example:
                membershipAnalytics:
                  districtId: "57"
                  districtName: "District 57"
                  dateRange:
                    startDate: "2025-07-01"
                    endDate: "2026-01-24"
                    daysInRange: 208
                  summary:
                    startingMembership: 2350
                    endingMembership: 2500
                    netChange: 150
                    percentChange: 6.38
                    trendDirection: "moderate_growth"
                  trends:
                    dataPoints:
                      - date: "2025-07-01"
                        totalMembership: 2350
                        change: 0
                        changePercent: 0
                      - date: "2025-10-01"
                        totalMembership: 2420
                        change: 70
                        changePercent: 2.98
                      - date: "2026-01-24"
                        totalMembership: 2500
                        change: 80
                        changePercent: 3.31
                    averageWeeklyChange: 5.2
                    averageMonthlyChange: 21.4
                  acquisition:
                    totalNewMembers: 320
                    averageNewMembersPerMonth: 45.7
                    topAcquisitionClubs:
                      - clubId: "1234567"
                        clubName: "Downtown Speakers"
                        newMembers: 18
                      - clubId: "7654321"
                        clubName: "Morning Leaders"
                        newMembers: 15
                      - clubId: "9876543"
                        clubName: "Evening Orators"
                        newMembers: 12
                    byMonth:
                      - month: "2026-01"
                        newMembers: 52
                      - month: "2025-12"
                        newMembers: 48
                      - month: "2025-11"
                        newMembers: 45
                      - month: "2025-10"
                        newMembers: 38
                      - month: "2025-09"
                        newMembers: 42
                      - month: "2025-08"
                        newMembers: 55
                      - month: "2025-07"
                        newMembers: 40
                  retention:
                    retentionRate: 85.5
                    renewedMembers: 1800
                    lapsedMembers: 170
                    atRiskMembers: 45
                  byClub:
                    - clubId: "1234567"
                      clubName: "Downtown Speakers"
                      division: "A"
                      area: "12"
                      currentMembership: 25
                      startingMembership: 22
                      netChange: 3
                      percentChange: 13.6
                      newMembers: 5
                      retentionRate: 90.0
                    - clubId: "7654321"
                      clubName: "Morning Leaders"
                      division: "A"
                      area: "13"
                      currentMembership: 32
                      startingMembership: 28
                      netChange: 4
                      percentChange: 14.3
                      newMembers: 6
                      retentionRate: 92.5
                    - clubId: "2345678"
                      clubName: "Sunset Speakers"
                      division: "B"
                      area: "21"
                      currentMembership: 10
                      startingMembership: 14
                      netChange: -4
                      percentChange: -28.6
                      newMembers: 1
                      retentionRate: 64.3
                  programYear: "2025-2026"
                  calculatedAt: "2026-01-24T10:30:00Z"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                      suggestions:
                        - "Use a valid district ID like '57' or 'F'"
                        - "Check the /districts endpoint for available district IDs"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date format"
                      details: "Date must be in ISO 8601 format (YYYY-MM-DD)"
                      suggestions:
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                        - "Example: 2026-01-24"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: "Invalid date range"
                      details: "Start date must be before or equal to end date"
                      suggestions:
                        - "Ensure startDate is before endDate"
                        - "Check that dates are in the correct format"
        '404':
          description: District or data not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for the specified date range
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: "No membership data available for the specified date range"
                      details: "No cached snapshots exist for district 57 between 2025-07-01 and 2026-01-24"
                      suggestions:
                        - "Try a different date range"
                        - "Check available dates using GET /districts/{districtId}/cached-dates"
                        - "Initiate a backfill operation to collect historical data"
        '500':
          description: Internal server error - analytics generation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to generate membership analytics"
                  details: "An error occurred while calculating membership analytics for the district"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/clubs/{clubId}/trends:
    get:
      tags:
        - Analytics
      operationId: getClubTrends
      summary: Get trend data for a specific club
      description: |
        Retrieves comprehensive trend and analytics data for a specific club within a district.

        This endpoint provides detailed insights into a club's performance over time, including:

        - **Membership History**: Historical membership data showing how the club's membership
          has changed over time, useful for visualizing trends and identifying patterns
        - **Health Status**: Current health classification of the club:
          - `thriving`: Club is performing well with strong membership and engagement
          - `vulnerable`: Club shows signs of potential decline and may need attention
          - `intervention_required`: Club requires immediate support to prevent closure
        - **Trajectory**: Direction of club performance:
          - `growing`: Membership and/or performance is improving
          - `stable`: Club is maintaining consistent performance
          - `declining`: Club is experiencing membership loss or performance decline
        - **Goal Achievement**: DCP goals achieved and distinguished status

        ## Use Cases

        - Club health monitoring and early warning detection
        - Area/Division director oversight and support planning
        - Identifying clubs that need intervention or recognition
        - Historical performance analysis for club officers
        - Supporting data-driven club growth strategies

        ## Analysis Period

        The trend analysis covers the current program year by default (July 1 to present).
        The response includes `analysisStartDate` and `analysisEndDate` to indicate the
        period covered by the trend calculations.

        The response includes `_snapshot_metadata` to indicate data freshness and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/clubIdParam'
      responses:
        '200':
          description: Successfully retrieved club trend data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClubTrendResponse'
              example:
                trend:
                  clubId: "1234567"
                  clubName: "Downtown Speakers"
                  division: "A"
                  area: "12"
                  membershipHistory:
                    - date: "2025-07-01"
                      memberCount: 20
                    - date: "2025-08-01"
                      memberCount: 21
                    - date: "2025-09-01"
                      memberCount: 22
                    - date: "2025-10-01"
                      memberCount: 23
                    - date: "2025-11-01"
                      memberCount: 24
                    - date: "2025-12-01"
                      memberCount: 24
                    - date: "2026-01-01"
                      memberCount: 25
                    - date: "2026-01-24"
                      memberCount: 25
                  healthStatus: thriving
                  trajectory: growing
                  currentMemberCount: 25
                  membershipChange: 5
                  membershipChangePercent: 25.0
                  goalsAchieved: 7
                  distinguishedStatus: "Select Distinguished"
                  analysisStartDate: "2025-07-01"
                  analysisEndDate: "2026-01-24"
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid district ID or club ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                      suggestions:
                        - "Use a valid district ID like '57' or 'F'"
                        - "Check the /districts endpoint for available district IDs"
                invalidClubId:
                  summary: Invalid club ID format
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: "Invalid club ID format"
                      details: "Club ID must be a numeric string"
                      suggestions:
                        - "Use a valid club ID like '1234567'"
                        - "Check the /districts/{districtId}/clubs endpoint for available club IDs"
        '404':
          description: Club or district not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                clubNotFound:
                  summary: Club not found in district
                  value:
                    error:
                      code: CLUB_NOT_FOUND
                      message: "Club not found"
                      details: "Club 1234567 was not found in district 57"
                      suggestions:
                        - "Verify the club ID is correct"
                        - "Check the /districts/{districtId}/clubs endpoint for available clubs"
                        - "The club may have been suspended or transferred to another district"
                noDataAvailable:
                  summary: No trend data available
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: "No trend data available"
                      details: "No historical data exists for club 1234567 in district 57"
                      suggestions:
                        - "Trend data requires multiple snapshots over time"
                        - "Check if historical data has been collected for this district"
        '500':
          description: Internal server error - trend calculation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to calculate club trends"
                  details: "An error occurred while calculating trend data for the club"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/vulnerable-clubs:
    get:
      tags:
        - Analytics
      operationId: getVulnerableClubs
      summary: Get vulnerable clubs in a district
      description: |
        Retrieves a list of clubs within a district that are identified as vulnerable
        or requiring intervention based on various risk factors.

        This endpoint provides critical insights for district leadership to identify
        clubs that need attention and support. Clubs are classified based on:

        ## Vulnerability Criteria

        - **Low Membership**: Clubs with 8-12 members are at risk of falling below
          the minimum threshold for charter maintenance
        - **Declining Membership Trends**: Clubs showing consistent membership loss
          over recent months
        - **Few DCP Goals Achieved**: Clubs with minimal progress toward Distinguished
          Club Program goals
        - **Approaching Suspension Thresholds**: Clubs nearing the criteria for
          suspension or ineligibility

        ## Health Status Classifications

        Clubs in the response are classified into two categories:

        - **Vulnerable**: Clubs showing signs of potential decline that may need
          proactive support and monitoring
        - **Intervention Required**: Clubs in critical condition requiring immediate
          attention to prevent closure or suspension

        ## Use Cases

        - District leadership planning and resource allocation
        - Area/Division director support prioritization
        - Early warning system for club health monitoring
        - Targeted membership growth initiatives
        - Club coach assignment and mentorship programs

        ## Response Structure

        The response includes summary counts for quick assessment and a detailed
        list of affected clubs with their trend data and risk factors.

        **Note**: This endpoint was previously named `at-risk-clubs` and has been
        renamed to `vulnerable-clubs` to align with updated terminology.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
      responses:
        '200':
          description: Successfully retrieved vulnerable clubs for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VulnerableClubsResponse'
              examples:
                withVulnerableClubs:
                  summary: District with vulnerable clubs
                  value:
                    districtId: "57"
                    totalVulnerableClubs: 12
                    interventionRequiredClubs: 3
                    vulnerableClubs: 9
                    clubs:
                      - clubId: "1234567"
                        clubName: "Struggling Speakers"
                        divisionId: "A"
                        divisionName: "Division A"
                        areaId: "12"
                        areaName: "Area 12"
                        membershipTrend:
                          - date: "2025-10-01"
                            count: 12
                          - date: "2025-11-01"
                            count: 11
                          - date: "2025-12-01"
                            count: 10
                          - date: "2026-01-01"
                            count: 9
                        dcpGoalsTrend:
                          - date: "2025-10-01"
                            goalsAchieved: 1
                          - date: "2026-01-01"
                            goalsAchieved: 2
                        currentStatus: vulnerable
                        riskFactors:
                          - "Low membership (9 members)"
                          - "Declining membership trend"
                          - "Below minimum DCP goals for Distinguished status"
                        distinguishedLevel: "NotDistinguished"
                        clubStatus: "Low"
                      - clubId: "7654321"
                        clubName: "Critical Club"
                        divisionId: "B"
                        divisionName: "Division B"
                        areaId: "21"
                        areaName: "Area 21"
                        membershipTrend:
                          - date: "2025-10-01"
                            count: 10
                          - date: "2025-11-01"
                            count: 8
                          - date: "2025-12-01"
                            count: 7
                          - date: "2026-01-01"
                            count: 6
                        dcpGoalsTrend:
                          - date: "2025-10-01"
                            goalsAchieved: 0
                          - date: "2026-01-01"
                            goalsAchieved: 0
                        currentStatus: intervention-required
                        riskFactors:
                          - "Critical low membership (6 members)"
                          - "Severe declining membership trend"
                          - "No DCP goals achieved"
                          - "At risk of suspension"
                        distinguishedLevel: "NotDistinguished"
                        clubStatus: "Low"
                noVulnerableClubs:
                  summary: District with no vulnerable clubs
                  value:
                    districtId: "101"
                    totalVulnerableClubs: 0
                    interventionRequiredClubs: 0
                    vulnerableClubs: 0
                    clubs: []
        '400':
          description: Bad request - invalid district ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: "Invalid district ID format"
                  details: "District ID must be alphanumeric (e.g., '57', 'F')"
                  suggestions:
                    - "Use a valid district ID like '57' or 'F'"
                    - "Check the /districts endpoint for available district IDs"
        '404':
          description: No data available - no cached data exists for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: "No cached data available for district 57"
                  details: "Consider initiating a backfill to fetch historical data"
                  suggestions:
                    - "Verify the district ID is correct"
                    - "Use the backfill endpoint to collect data for this district"
                    - "Check if data collection has been configured for this district"
        '500':
          description: Internal server error - analytics calculation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to identify vulnerable clubs"
                  details: "An error occurred while analyzing club health data"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/leadership-insights:
    get:
      tags:
        - Analytics
      operationId: getLeadershipInsights
      summary: Get leadership effectiveness insights for a district
      description: |
        Retrieves comprehensive leadership-focused analytics for a specific district,
        providing insights into officer training completion, club officer role fulfillment,
        leadership development metrics, and actionable recommendations for district leadership.

        This endpoint is designed to help district leaders understand the effectiveness
        of their leadership team and identify areas for improvement across divisions and areas.

        ## Leadership Metrics

        The response includes several categories of leadership analytics:

        ### Leadership Effectiveness Scores
        - **Health Score**: Overall club health within each division
        - **Growth Score**: Membership and club growth metrics
        - **DCP Score**: Distinguished Club Program achievement rates
        - **Overall Score**: Composite score combining all metrics

        ### Best Practice Divisions
        Divisions that demonstrate exceptional performance across all metrics
        are identified as "best practice" divisions. These can serve as models
        for other divisions to emulate.

        ### Leadership Changes Impact
        Tracks performance changes associated with leadership transitions,
        showing how division performance changed before and after leadership
        changes during the analysis period. This helps identify:
        - Successful leadership transitions
        - Areas needing additional support during transitions
        - Patterns in leadership effectiveness

        ### Area Director Correlations
        Analyzes the relationship between area director activity levels and
        club performance within each area, helping identify:
        - High-activity areas with strong club performance
        - Areas where increased director engagement may help
        - Patterns in leadership-to-performance relationships

        ## Date Range Selection

        Use the `startDate` and `endDate` query parameters to specify the
        analysis period. The date range affects:
        - Leadership change tracking (changes within the period)
        - Performance trend calculations
        - Correlation analysis timeframes

        If not provided, defaults to the current program year.

        ## Use Cases

        - **District Leadership Planning**: Identify divisions needing support
        - **Training Prioritization**: Focus training resources on underperforming areas
        - **Recognition Programs**: Identify and recognize high-performing leaders
        - **Succession Planning**: Understand leadership transition impacts
        - **Best Practice Sharing**: Identify successful patterns to replicate

        The response includes `_snapshot_metadata` to indicate data freshness
        and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully retrieved leadership insights for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LeadershipInsightsResponse'
              examples:
                fullInsights:
                  summary: Complete leadership insights response
                  value:
                    insights:
                      leadershipScores:
                        - divisionId: "A"
                          divisionName: "Division A"
                          healthScore: 85.5
                          growthScore: 72.3
                          dcpScore: 68.0
                          overallScore: 76.2
                          rank: 1
                          isBestPractice: true
                        - divisionId: "B"
                          divisionName: "Division B"
                          healthScore: 78.0
                          growthScore: 65.5
                          dcpScore: 72.0
                          overallScore: 72.3
                          rank: 2
                          isBestPractice: false
                        - divisionId: "C"
                          divisionName: "Division C"
                          healthScore: 70.0
                          growthScore: 58.0
                          dcpScore: 62.5
                          overallScore: 63.5
                          rank: 3
                          isBestPractice: false
                      bestPracticeDivisions:
                        - divisionId: "A"
                          divisionName: "Division A"
                          healthScore: 85.5
                          growthScore: 72.3
                          dcpScore: 68.0
                          overallScore: 76.2
                          rank: 1
                          isBestPractice: true
                      leadershipChanges:
                        - divisionId: "B"
                          divisionName: "Division B"
                          changeDate: "2025-10-15"
                          performanceBeforeChange: 65.0
                          performanceAfterChange: 78.5
                          performanceDelta: 13.5
                          trend: improved
                        - divisionId: "C"
                          divisionName: "Division C"
                          changeDate: "2025-09-01"
                          performanceBeforeChange: 72.0
                          performanceAfterChange: 63.5
                          performanceDelta: -8.5
                          trend: declined
                      areaDirectorCorrelations:
                        - areaId: "A1"
                          areaName: "Area A1"
                          divisionId: "A"
                          clubPerformanceScore: 82.5
                          activityIndicator: high
                          correlation: positive
                        - areaId: "A2"
                          areaName: "Area A2"
                          divisionId: "A"
                          clubPerformanceScore: 78.0
                          activityIndicator: high
                          correlation: positive
                        - areaId: "B1"
                          areaName: "Area B1"
                          divisionId: "B"
                          clubPerformanceScore: 68.0
                          activityIndicator: medium
                          correlation: neutral
                      summary:
                        topPerformingDivisions:
                          - divisionId: "A"
                            divisionName: "Division A"
                            score: 76.2
                          - divisionId: "B"
                            divisionName: "Division B"
                            score: 72.3
                        topPerformingAreas:
                          - areaId: "A1"
                            areaName: "Area A1"
                            score: 82.5
                          - areaId: "A2"
                            areaName: "Area A2"
                            score: 78.0
                        averageLeadershipScore: 70.67
                        totalBestPracticeDivisions: 1
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
                minimalInsights:
                  summary: District with limited leadership data
                  value:
                    insights:
                      leadershipScores:
                        - divisionId: "A"
                          divisionName: "Division A"
                          healthScore: 65.0
                          growthScore: 55.0
                          dcpScore: 50.0
                          overallScore: 56.7
                          rank: 1
                          isBestPractice: false
                      bestPracticeDivisions: []
                      leadershipChanges: []
                      areaDirectorCorrelations:
                        - areaId: "A1"
                          areaName: "Area A1"
                          divisionId: "A"
                          clubPerformanceScore: 60.0
                          activityIndicator: low
                          correlation: neutral
                      summary:
                        topPerformingDivisions:
                          - divisionId: "A"
                            divisionName: "Division A"
                            score: 56.7
                        topPerformingAreas:
                          - areaId: "A1"
                            areaName: "Area A1"
                            score: 60.0
                        averageLeadershipScore: 56.7
                        totalBestPracticeDivisions: 0
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
        '400':
          description: Bad request - invalid district ID or date parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                      suggestions:
                        - "Use a valid district ID like '57' or 'F'"
                        - "Check the /districts endpoint for available district IDs"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: "Invalid date range"
                      details: "Start date must be before end date"
                      suggestions:
                        - "Ensure startDate is earlier than endDate"
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date format"
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                        - "Example: 2026-01-24"
        '404':
          description: No data available - no cached data exists for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: "No cached data available for district 57"
                  details: "Leadership insights require historical data for analysis"
                  suggestions:
                    - "Verify the district ID is correct"
                    - "Use the backfill endpoint to collect historical data for this district"
                    - "Ensure sufficient data exists for the requested date range"
        '500':
          description: Internal server error - analytics calculation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to generate leadership insights"
                  details: "An error occurred while calculating leadership effectiveness metrics"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/distinguished-club-analytics:
    get:
      tags:
        - Analytics
      operationId: getDistinguishedClubAnalytics
      summary: Get Distinguished Club Program analytics for a district
      description: |
        Retrieves comprehensive analytics about Distinguished Club Program (DCP) achievements
        for a specific Toastmasters district. This endpoint provides insights into current
        distinguished club counts, projections, clubs on track or at risk, goal distribution,
        and historical trends.

        The Distinguished Club Program is Toastmasters' recognition program that measures
        club success across 10 goals. Clubs can achieve three levels of recognition:

        - **Distinguished**: 5+ goals achieved
        - **Select Distinguished**: 7+ goals achieved
        - **President's Distinguished**: 9+ goals achieved (highest honor)

        ## Analytics Provided

        ### Current Status
        - Total clubs in the district
        - Breakdown by distinguished level (Distinguished, Select Distinguished, President's Distinguished)
        - Percentage of clubs achieving distinguished status

        ### Projections
        - Projected number of clubs to achieve each distinguished level by year end
        - Confidence level of projections based on historical patterns

        ### Clubs On Track
        - List of clubs showing positive trajectory toward distinguished status
        - Current goals achieved and goals remaining
        - Projected final status

        ### Clubs At Risk
        - List of clubs at risk of not achieving distinguished status
        - Risk factors identified (low membership, slow goal progress, etc.)
        - Intervention recommendations

        ### Goal Distribution
        - Distribution of clubs by number of goals achieved (0-10)
        - Average and median goals across the district
        - Clubs with zero goals vs. clubs with all goals

        ### Historical Trends
        - Time series data showing distinguished club counts over the analysis period
        - Useful for visualizing progress toward district goals

        ## Date Range Selection

        Use the `startDate` and `endDate` query parameters to specify the analysis period.
        The date range affects:
        - Trend calculations and historical comparisons
        - Projection confidence levels
        - Risk assessment accuracy

        If not provided, defaults to the current program year (July 1 - June 30).

        ## Use Cases

        - **District Goal Tracking**: Monitor progress toward distinguished district goals
        - **Club Support Planning**: Identify clubs needing intervention or support
        - **Recognition Programs**: Identify clubs close to achieving next level
        - **Leadership Reporting**: Generate reports for district leadership meetings
        - **Year-over-Year Comparison**: Compare DCP performance across program years

        The response includes `_snapshot_metadata` to indicate data freshness
        and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully retrieved distinguished club analytics for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistinguishedClubAnalyticsResponse'
              examples:
                fullAnalytics:
                  summary: Complete distinguished club analytics response
                  value:
                    analytics:
                      districtId: "57"
                      totalClubs: 120
                      distinguishedClubs:
                        total: 45
                        distinguished: 22
                        selectDistinguished: 15
                        presidentsDistinguished: 8
                      percentageDistinguished: 37.5
                      projectedDistinguished:
                        distinguished: 28
                        selectDistinguished: 18
                        presidentsDistinguished: 12
                        total: 58
                        confidence: medium
                      clubsOnTrack:
                        - clubId: "1234567"
                          clubName: "Downtown Speakers"
                          division: "A"
                          area: "12"
                          goalsAchieved: 4
                          goalsRequired: 5
                          goalsRemaining: 1
                          currentStatus: none
                          projectedStatus: distinguished
                          memberCount: 22
                          trajectory: on_track
                        - clubId: "7654321"
                          clubName: "Morning Leaders"
                          division: "A"
                          area: "13"
                          goalsAchieved: 6
                          goalsRequired: 7
                          goalsRemaining: 1
                          currentStatus: distinguished
                          projectedStatus: selectDistinguished
                          memberCount: 28
                          trajectory: on_track
                      clubsAtRisk:
                        - clubId: "2345678"
                          clubName: "Sunset Speakers"
                          division: "B"
                          area: "21"
                          goalsAchieved: 2
                          goalsRequired: 5
                          goalsRemaining: 3
                          currentStatus: none
                          projectedStatus: none
                          memberCount: 10
                          trajectory: at_risk
                          riskFactors:
                            - "Low membership (below 12)"
                            - "Only 2 goals achieved with 5 months remaining"
                        - clubId: "3456789"
                          clubName: "Midtown Toasters"
                          division: "C"
                          area: "31"
                          goalsAchieved: 3
                          goalsRequired: 5
                          goalsRemaining: 2
                          currentStatus: none
                          projectedStatus: none
                          memberCount: 11
                          trajectory: at_risk
                          riskFactors:
                            - "No educational awards this quarter"
                      goalDistribution:
                        distribution:
                          "0": 5
                          "1": 8
                          "2": 12
                          "3": 15
                          "4": 18
                          "5": 22
                          "6": 14
                          "7": 10
                          "8": 8
                          "9": 5
                          "10": 3
                        averageGoals: 4.8
                        medianGoals: 5
                        clubsWithZeroGoals: 5
                        clubsWithAllGoals: 3
                      trend:
                        - date: "2025-07-01"
                          total: 0
                          distinguished: 0
                          selectDistinguished: 0
                          presidentsDistinguished: 0
                          percentageOfTotal: 0
                        - date: "2025-10-01"
                          total: 15
                          distinguished: 10
                          selectDistinguished: 4
                          presidentsDistinguished: 1
                          percentageOfTotal: 12.5
                        - date: "2026-01-01"
                          total: 38
                          distinguished: 20
                          selectDistinguished: 12
                          presidentsDistinguished: 6
                          percentageOfTotal: 31.7
                        - date: "2026-01-24"
                          total: 45
                          distinguished: 22
                          selectDistinguished: 15
                          presidentsDistinguished: 8
                          percentageOfTotal: 37.5
                      dateRange:
                        startDate: "2025-07-01"
                        endDate: "2026-01-24"
                        daysInRange: 208
                      programYear: "2025-2026"
                      calculatedAt: "2026-01-24T10:30:00Z"
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
                earlySeasonAnalytics:
                  summary: Early season analytics with limited distinguished clubs
                  value:
                    analytics:
                      districtId: "57"
                      totalClubs: 120
                      distinguishedClubs:
                        total: 8
                        distinguished: 5
                        selectDistinguished: 2
                        presidentsDistinguished: 1
                      percentageDistinguished: 6.7
                      projectedDistinguished:
                        distinguished: 35
                        selectDistinguished: 20
                        presidentsDistinguished: 10
                        total: 65
                        confidence: low
                      clubsOnTrack:
                        - clubId: "1234567"
                          clubName: "Downtown Speakers"
                          division: "A"
                          area: "12"
                          goalsAchieved: 3
                          goalsRequired: 5
                          goalsRemaining: 2
                          currentStatus: none
                          projectedStatus: distinguished
                          memberCount: 24
                          trajectory: on_track
                      clubsAtRisk:
                        - clubId: "2345678"
                          clubName: "Sunset Speakers"
                          division: "B"
                          area: "21"
                          goalsAchieved: 0
                          goalsRequired: 5
                          goalsRemaining: 5
                          currentStatus: none
                          projectedStatus: none
                          memberCount: 8
                          trajectory: at_risk
                          riskFactors:
                            - "Low membership (below 12)"
                            - "No goals achieved"
                      goalDistribution:
                        distribution:
                          "0": 25
                          "1": 30
                          "2": 25
                          "3": 20
                          "4": 12
                          "5": 5
                          "6": 2
                          "7": 1
                          "8": 0
                          "9": 0
                          "10": 0
                        averageGoals: 1.8
                        medianGoals: 2
                        clubsWithZeroGoals: 25
                        clubsWithAllGoals: 0
                      trend:
                        - date: "2025-07-01"
                          total: 0
                          distinguished: 0
                          selectDistinguished: 0
                          presidentsDistinguished: 0
                          percentageOfTotal: 0
                        - date: "2025-09-01"
                          total: 8
                          distinguished: 5
                          selectDistinguished: 2
                          presidentsDistinguished: 1
                          percentageOfTotal: 6.7
                      dateRange:
                        startDate: "2025-07-01"
                        endDate: "2025-09-01"
                        daysInRange: 62
                      programYear: "2025-2026"
                      calculatedAt: "2025-09-01T10:30:00Z"
                    _snapshot_metadata:
                      snapshot_id: "2025-09-01"
                      created_at: "2025-09-01T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
        '400':
          description: Bad request - invalid district ID or date parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                      suggestions:
                        - "Use a valid district ID like '57' or 'F'"
                        - "Check the /districts endpoint for available district IDs"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: "Invalid date range"
                      details: "Start date must be before end date"
                      suggestions:
                        - "Ensure startDate is earlier than endDate"
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date format"
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                        - "Example: 2026-01-24"
        '404':
          description: No data available - no cached data exists for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: "No cached data available for district 57"
                  details: "Distinguished club analytics require historical data for analysis"
                  suggestions:
                    - "Verify the district ID is correct"
                    - "Use the backfill endpoint to collect historical data for this district"
                    - "Ensure sufficient data exists for the requested date range"
        '500':
          description: Internal server error - analytics calculation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to generate distinguished club analytics"
                  details: "An error occurred while calculating DCP analytics"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/year-over-year/{date}:
    get:
      tags:
        - Analytics
      operationId: getYearOverYearComparison
      summary: Get year-over-year performance comparison for a district
      description: |
        Retrieves a comprehensive year-over-year comparison of district performance,
        comparing the current program year against the previous program year at the
        same point in time.

        This endpoint is essential for district leadership to understand progress,
        identify trends, and make data-driven decisions about membership growth,
        club health, and Distinguished Club Program (DCP) achievement.

        ## Comparison Metrics

        The comparison includes the following key performance areas:

        ### Membership Comparison
        - Current vs. previous year total membership
        - Absolute change and percentage change
        - Trend direction (increasing, decreasing, stable)

        ### Distinguished Club Comparison
        - Total distinguished clubs: current vs. previous year
        - Breakdown by level (Distinguished, Select Distinguished, President's Distinguished, Smedley)
        - Change in each category

        ### Club Health Metrics
        - Thriving clubs comparison
        - Vulnerable clubs comparison
        - Clubs requiring intervention comparison
        - Percentage changes in each category

        ### DCP Goals Comparison
        - Total goals achieved: current vs. previous year
        - Average goals per club comparison
        - Goal achievement trends

        ### Club Count
        - Total clubs: current vs. previous year
        - Net club growth or decline

        ## Multi-Year Trends

        When sufficient historical data is available, the response includes
        multi-year trend data showing performance across multiple program years.
        This enables visualization of long-term district trajectory.

        ## Date Parameter

        The `date` path parameter specifies the reference date for the comparison.
        The API will compare data from this date against the equivalent date in
        the previous program year (approximately one year prior).

        For example:
        - If `date` is `2026-01-24`, the comparison will be against `2025-01-24`
        - The program years compared would be `2025-2026` vs. `2024-2025`

        ## Data Availability

        If data is not available for the previous year comparison, the response
        will indicate this with `dataAvailable: false` and include a message
        explaining why the comparison could not be completed.

        ## Use Cases

        - **Leadership Reporting**: Generate year-over-year progress reports for district meetings
        - **Goal Setting**: Use historical comparisons to set realistic district goals
        - **Trend Analysis**: Identify long-term patterns in district performance
        - **Intervention Planning**: Compare club health metrics to prioritize support efforts
        - **Recognition Programs**: Track distinguished club achievement progress

        The response includes `_snapshot_metadata` to indicate data freshness
        and source information.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/datePathParam'
      responses:
        '200':
          description: Successfully retrieved year-over-year comparison for the district
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YearOverYearComparisonResponse'
              examples:
                fullComparison:
                  summary: Complete year-over-year comparison with all metrics
                  value:
                    comparison:
                      districtId: "57"
                      currentDate: "2026-01-24"
                      previousYearDate: "2025-01-24"
                      dataAvailable: true
                      programYears:
                        currentYear: "2025-2026"
                        previousYear: "2024-2025"
                      metrics:
                        membership:
                          current: 2500
                          previous: 2350
                          change: 150
                          percentageChange: 6.38
                        distinguishedClubs:
                          current: 45
                          previous: 37
                          change: 8
                          percentageChange: 21.62
                          byLevel:
                            smedley:
                              current: 2
                              previous: 1
                              change: 1
                            presidents:
                              current: 8
                              previous: 6
                              change: 2
                            select:
                              current: 15
                              previous: 12
                              change: 3
                            distinguished:
                              current: 22
                              previous: 18
                              change: 4
                        clubHealth:
                          thrivingClubs:
                            current: 85
                            previous: 78
                            change: 7
                            percentageChange: 8.97
                          vulnerableClubs:
                            current: 12
                            previous: 18
                            change: -6
                            percentageChange: -33.33
                          interventionRequiredClubs:
                            current: 5
                            previous: 8
                            change: -3
                            percentageChange: -37.5
                        dcpGoals:
                          totalGoals:
                            current: 576
                            previous: 504
                            change: 72
                            percentageChange: 14.29
                          averagePerClub:
                            current: 4.8
                            previous: 4.2
                            change: 0.6
                            percentageChange: 14.29
                        clubCount:
                          current: 120
                          previous: 118
                          change: 2
                          percentageChange: 1.69
                      multiYearTrends:
                        available: true
                        years:
                          - year: 2024
                            date: "2025-01-24"
                            membership: 2350
                            distinguishedClubs: 37
                            totalDcpGoals: 504
                            clubCount: 118
                          - year: 2025
                            date: "2026-01-24"
                            membership: 2500
                            distinguishedClubs: 45
                            totalDcpGoals: 576
                            clubCount: 120
                        trends:
                          membershipTrend: increasing
                          distinguishedTrend: increasing
                          dcpGoalsTrend: increasing
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
                dataUnavailable:
                  summary: Comparison when previous year data is not available
                  value:
                    comparison:
                      districtId: "57"
                      currentDate: "2026-01-24"
                      previousYearDate: "2025-01-24"
                      dataAvailable: false
                      message: "No data for previous year (2024-2025). Historical collection may be required."
                      programYears:
                        currentYear: "2025-2026"
                        previousYear: "2024-2025"
                    _snapshot_metadata:
                      snapshot_id: "2026-01-24"
                      created_at: "2026-01-24T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
                earlySeasonComparison:
                  summary: Early season comparison with limited distinguished clubs
                  value:
                    comparison:
                      districtId: "57"
                      currentDate: "2025-09-15"
                      previousYearDate: "2024-09-15"
                      dataAvailable: true
                      programYears:
                        currentYear: "2025-2026"
                        previousYear: "2024-2025"
                      metrics:
                        membership:
                          current: 2420
                          previous: 2280
                          change: 140
                          percentageChange: 6.14
                        distinguishedClubs:
                          current: 5
                          previous: 3
                          change: 2
                          percentageChange: 66.67
                          byLevel:
                            smedley:
                              current: 0
                              previous: 0
                              change: 0
                            presidents:
                              current: 1
                              previous: 0
                              change: 1
                            select:
                              current: 2
                              previous: 1
                              change: 1
                            distinguished:
                              current: 2
                              previous: 2
                              change: 0
                        clubHealth:
                          thrivingClubs:
                            current: 75
                            previous: 70
                            change: 5
                            percentageChange: 7.14
                          vulnerableClubs:
                            current: 15
                            previous: 20
                            change: -5
                            percentageChange: -25.0
                          interventionRequiredClubs:
                            current: 8
                            previous: 10
                            change: -2
                            percentageChange: -20.0
                        dcpGoals:
                          totalGoals:
                            current: 180
                            previous: 150
                            change: 30
                            percentageChange: 20.0
                          averagePerClub:
                            current: 1.5
                            previous: 1.3
                            change: 0.2
                            percentageChange: 15.38
                        clubCount:
                          current: 120
                          previous: 116
                          change: 4
                          percentageChange: 3.45
                      multiYearTrends:
                        available: true
                        years:
                          - year: 2024
                            date: "2024-09-15"
                            membership: 2280
                            distinguishedClubs: 3
                            totalDcpGoals: 150
                            clubCount: 116
                          - year: 2025
                            date: "2025-09-15"
                            membership: 2420
                            distinguishedClubs: 5
                            totalDcpGoals: 180
                            clubCount: 120
                        trends:
                          membershipTrend: increasing
                          distinguishedTrend: increasing
                          dcpGoalsTrend: increasing
                    _snapshot_metadata:
                      snapshot_id: "2025-09-15"
                      created_at: "2025-09-15T06:00:00Z"
                      status: success
                      is_closing_period: false
                      is_fallback: false
                      data_source: scraper
                      from_cache: true
        '400':
          description: Bad request - invalid district ID or date format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: "Invalid district ID format"
                      details: "District ID must be alphanumeric (e.g., '57', 'F')"
                      suggestions:
                        - "Use a valid district ID like '57' or 'F'"
                        - "Check the /districts endpoint for available district IDs"
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date format"
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - "Use ISO 8601 date format (YYYY-MM-DD)"
                        - "Example: 2026-01-24"
                futureDate:
                  summary: Date is in the future
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: "Invalid date"
                      details: "Cannot request year-over-year comparison for a future date"
                      suggestions:
                        - "Use a date that is today or in the past"
                        - "Check the current date and adjust your request"
        '404':
          description: No data available - no cached data exists for the district or requested date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for district
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: "No cached data available for district 57"
                      details: "Year-over-year comparison requires data for the requested date"
                      suggestions:
                        - "Verify the district ID is correct"
                        - "Use the backfill endpoint to collect historical data for this district"
                        - "Check available dates using the /districts/{districtId}/cached-dates endpoint"
                snapshotNotFound:
                  summary: No snapshot for requested date
                  value:
                    error:
                      code: SNAPSHOT_NOT_FOUND
                      message: "Snapshot not found"
                      details: "No snapshot exists for date 2026-01-24"
                      suggestions:
                        - "Check available dates using the /districts/{districtId}/cached-dates endpoint"
                        - "Use a different date that has available data"
        '500':
          description: Internal server error - analytics calculation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: ANALYTICS_ERROR
                  message: "Failed to generate year-over-year comparison"
                  details: "An error occurred while calculating year-over-year analytics"
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: "Storage service temporarily unavailable"
                  details: "The data storage service is currently unavailable. Please try again later."

  /districts/{districtId}/export:
    get:
      tags:
        - Analytics
      operationId: exportDistrictData
      summary: Export district data in various formats
      description: |
        Exports district data in the specified format for external analysis,
        reporting, or integration with other tools.

        ## Supported Formats

        - **CSV**: Comma-separated values format suitable for spreadsheet applications
          and data analysis tools. Returns `text/csv` content type.
        - **JSON**: Standard JSON format for programmatic access. Returns
          `application/json` content type.

        ## Data Included

        The export includes comprehensive district data:

        - **Club Information**: All clubs with their current status, membership counts,
          and performance metrics
        - **Performance Metrics**: DCP goals achieved, distinguished status, educational awards
        - **Membership Data**: Member counts, growth metrics, and trends
        - **Organizational Structure**: Division and area assignments

        ## Date Range Filtering

        Use the optional `startDate` and `endDate` parameters to filter the exported
        data to a specific date range. This is useful for:

        - Generating periodic reports (monthly, quarterly, yearly)
        - Comparing performance across specific time periods
        - Extracting data for external analysis tools

        If no date range is specified, the export includes data from the most recent
        available snapshot.

        ## Use Cases

        - **Spreadsheet Analysis**: Export to CSV for analysis in Excel or Google Sheets
        - **Data Integration**: Export to JSON for integration with other systems
        - **Reporting**: Generate data exports for district leadership reports
        - **Archival**: Create periodic snapshots of district data for historical records
        - **Custom Dashboards**: Feed data into custom visualization tools

        ## CSV Format Details

        The CSV export includes a header row with column names followed by data rows.
        Columns include:
        - Club ID, Club Name, Division, Area
        - Member Count, Active Members, Membership Base
        - Goals Achieved, Distinguished Status
        - Charter Date, Educational Awards

        ## Response Headers

        For CSV format, the response includes:
        - `Content-Type: text/csv`
        - `Content-Disposition: attachment; filename="district-{districtId}-export-{date}.csv"`

        For JSON format, the response includes:
        - `Content-Type: application/json`
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/formatParam'
        - $ref: '#/components/parameters/startDateParam'
        - $ref: '#/components/parameters/endDateParam'
      responses:
        '200':
          description: Successfully exported district data
          content:
            text/csv:
              schema:
                type: string
                description: |
                  CSV formatted data with header row and data rows.
                  Each row represents a club in the district.
              example: |
                Club ID,Club Name,Division,Area,Members,Active,Base,Goals,Status,Charter,Awards
                1234567,Downtown Speakers,A,12,25,22,20,7,Select Distinguished,2015-03-15,12
                7654321,Morning Leaders,A,12,32,30,28,9,President's Distinguished,2010-09-01,18
                9876543,Evening Orators,B,21,18,15,14,5,Distinguished,2018-06-20,8
                5555555,Lunchtime Talkers,B,22,20,18,16,6,Select Distinguished,2012-11-10,10
            application/json:
              schema:
                $ref: '#/components/schemas/ExportResponse'
              example:
                export:
                  districtId: "57"
                  districtName: "District 57"
                  exportDate: "2026-01-24"
                  dateRange:
                    startDate: "2025-07-01"
                    endDate: "2026-01-24"
                  clubs:
                    - clubId: "1234567"
                      clubName: "Downtown Speakers"
                      division: "A"
                      area: "12"
                      memberCount: 25
                      activeMembers: 22
                      membershipBase: 20
                      goalsAchieved: 7
                      distinguishedStatus: "Select Distinguished"
                      charterDate: "2015-03-15"
                      educationalAwards: 12
                    - clubId: "7654321"
                      clubName: "Morning Leaders"
                      division: "A"
                      area: "12"
                      memberCount: 32
                      activeMembers: 30
                      membershipBase: 28
                      goalsAchieved: 9
                      distinguishedStatus: "President's Distinguished"
                      charterDate: "2010-09-01"
                      educationalAwards: 18
                  summary:
                    totalClubs: 120
                    totalMembers: 2500
                    averageGoalsAchieved: 6.2
                    distinguishedClubs: 45
                _snapshot_metadata:
                  snapshot_id: "2026-01-24"
                  created_at: "2026-01-24T06:00:00Z"
                  status: success
                  is_closing_period: false
                  is_fallback: false
                  data_source: scraper
                  from_cache: true
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID format
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: Start date must be before or equal to end date
                      suggestions:
                        - Ensure startDate is before endDate
                        - Check that both dates are valid
                invalidFormat:
                  summary: Invalid export format
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid export format
                      details: "Format must be 'csv' or 'json', received: 'xml'"
                      suggestions:
                        - Use 'csv' for spreadsheet-compatible output
                        - Use 'json' for programmatic access
        '404':
          description: Not found - district not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                noDataAvailable:
                  summary: No data available for district
                  value:
                    error:
                      code: NO_DATA_AVAILABLE
                      message: No data available
                      details: No cached data exists for district 57
                      suggestions:
                        - Verify the district ID is correct
                        - Check if data has been collected for this district
                snapshotNotFound:
                  summary: No snapshot for requested date range
                  value:
                    error:
                      code: SNAPSHOT_NOT_FOUND
                      message: Snapshot not found
                      details: No snapshot exists for the requested date range
                      suggestions:
                        - Check available dates using the /districts/{districtId}/cached-dates endpoint
                        - Adjust the date range to include available data
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Export generation failed
                  details: An unexpected error occurred while generating the export
        '503':
          description: Service unavailable - storage service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /districts/backfill:
    post:
      tags:
        - Backfill
      operationId: initiateBackfill
      summary: Initiate a backfill operation for historical data collection
      description: |
        Initiates an asynchronous backfill operation to collect historical district
        data for the specified date range and districts.

        ## Overview

        Backfill operations retrieve and store snapshot data from the Toastmasters
        data source for historical dates. This is useful for:

        - **Historical Analysis**: Collecting past data for trend analysis and reporting
        - **Data Recovery**: Filling gaps in cached data after system issues
        - **Initial Setup**: Populating the cache with historical data for new deployments
        - **Cross-District Comparisons**: Gathering data across multiple districts for benchmarking

        ## Asynchronous Processing

        The backfill operation runs asynchronously in the background. This endpoint
        returns immediately with a `202 Accepted` response containing a `backfillId`
        that can be used to:

        - Monitor progress via `GET /districts/backfill/{backfillId}`
        - Cancel the operation via `DELETE /districts/backfill/{backfillId}`

        ## Collection Strategies

        Two collection strategies are available:

        - **per-district**: Collects all dates for one district before moving to the next.
          This approach is better for focused district analysis and reduces memory usage.
        - **all-districts**: Collects data for all districts for each date before moving
          to the next date. This approach is better for cross-district comparisons on
          specific dates.

        ## Concurrency Control

        The `concurrency` parameter controls how many data collection operations run
        in parallel. Higher values speed up collection but increase load on source
        systems. Recommended range is 1-5 for most use cases.

        ## Date Range Considerations

        - The date range should be within the current Toastmasters program year or
          recent historical years for best data availability
        - Very large date ranges may take significant time to complete
        - Progress can be monitored via the status endpoint

        ## Error Handling

        If the backfill encounters errors during collection:
        - Individual date/district failures are tracked in the progress metrics
        - The overall job continues unless a critical error occurs
        - Failed items may be retried depending on the error type
        - Final status will indicate `complete` (with possible partial failures) or `error`
      requestBody:
        required: true
        description: |
          Configuration for the backfill operation including target districts,
          date range, collection strategy, and concurrency settings.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BackfillRequest'
            examples:
              allDistricts:
                summary: Backfill all districts for a date range
                description: |
                  Initiates a backfill for all available districts over a 6-month period.
                  Uses the default per-district collection strategy.
                value:
                  startDate: "2025-07-01"
                  endDate: "2025-12-31"
                  collectionType: per-district
                  concurrency: 3
              specificDistricts:
                summary: Backfill specific districts
                description: |
                  Initiates a backfill for only the specified districts.
                  Useful for targeted data collection or recovery.
                value:
                  targetDistricts:
                    - "57"
                    - "F"
                    - "101"
                  startDate: "2025-10-01"
                  endDate: "2025-12-31"
                  collectionType: per-district
                  concurrency: 3
              crossDistrictComparison:
                summary: Backfill for cross-district comparison
                description: |
                  Uses all-districts collection strategy to gather data for
                  cross-district comparisons on specific dates.
                value:
                  targetDistricts:
                    - "57"
                    - "F"
                    - "101"
                    - "102"
                  startDate: "2025-12-01"
                  endDate: "2025-12-31"
                  collectionType: all-districts
                  concurrency: 5
              minimalRequest:
                summary: Minimal backfill request
                description: |
                  Only the required fields are provided. Defaults will be used
                  for targetDistricts (all), collectionType (per-district),
                  and concurrency (3).
                value:
                  startDate: "2025-11-01"
                  endDate: "2025-11-30"
      responses:
        '202':
          description: |
            Backfill operation accepted and started. The response includes the
            backfill job ID and initial status information. Use the backfillId
            to monitor progress via `GET /districts/backfill/{backfillId}`.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                accepted:
                  summary: Backfill job accepted
                  description: |
                    The backfill operation has been accepted and is now processing.
                    Initial progress shows 0% completion.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: processing
                    progress:
                      total: 180
                      completed: 0
                      failed: 0
                      percentage: 0.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:30:00Z"
                allDistrictsAccepted:
                  summary: All-districts backfill accepted
                  description: |
                    A backfill targeting all districts has been accepted.
                    The scope shows all-districts type.
                  value:
                    backfillId: "bf-2026-01-24-def456"
                    status: processing
                    progress:
                      total: 3600
                      completed: 0
                      failed: 0
                      percentage: 0.0
                    scope:
                      scopeType: all-districts
                      targetDistricts: []
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:30:00Z"
        '400':
          description: |
            Bad request - the request body contains invalid parameters.
            Common validation errors include:
            - Invalid date format (must be YYYY-MM-DD)
            - Invalid date range (startDate must be before or equal to endDate)
            - Date range too large (exceeds maximum allowed range)
            - Invalid district ID format
            - Invalid collection type
            - Concurrency out of allowed range (1-10)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "Date must be in YYYY-MM-DD format, received: '2025/07/01'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2025-07-01"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: Start date must be before or equal to end date
                      suggestions:
                        - Ensure startDate is before endDate
                        - Check that both dates are valid
                dateRangeTooLarge:
                  summary: Date range too large
                  value:
                    error:
                      code: DATE_RANGE_TOO_LARGE
                      message: Date range exceeds maximum allowed
                      details: The requested date range spans 400 days, maximum allowed is 365 days
                      suggestions:
                        - Reduce the date range to 365 days or less
                        - Split the backfill into multiple smaller operations
                missingDateParameters:
                  summary: Missing required date parameters
                  value:
                    error:
                      code: MISSING_DATE_PARAMETERS
                      message: Missing required date parameters
                      details: Both startDate and endDate are required
                      suggestions:
                        - Provide both startDate and endDate in the request body
                        - Use ISO 8601 date format (YYYY-MM-DD)
                invalidDistrictId:
                  summary: Invalid district ID in targetDistricts
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: "District ID 'invalid!' contains invalid characters"
                      suggestions:
                        - District IDs must be alphanumeric
                        - Use valid district IDs like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                validationError:
                  summary: General validation error
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Request validation failed
                      details: "collectionType must be 'per-district' or 'all-districts'"
                      suggestions:
                        - Use 'per-district' for focused district analysis
                        - Use 'all-districts' for cross-district comparisons
        '500':
          description: |
            Internal server error - an unexpected error occurred while initiating
            the backfill operation. This may indicate a system configuration issue
            or temporary service disruption.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: BACKFILL_ERROR
                  message: Failed to initiate backfill operation
                  details: An unexpected error occurred while starting the backfill job
        '503':
          description: |
            Service unavailable - the storage service or data source is temporarily
            unavailable. The backfill operation cannot be started at this time.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /districts/backfill/{backfillId}:
    get:
      tags:
        - Backfill
      operationId: getBackfillStatus
      summary: Get the status of a backfill operation
      description: |
        Retrieves the current status and progress of a backfill operation.

        ## Overview

        After initiating a backfill operation via `POST /districts/backfill`, use this
        endpoint to monitor its progress. The response includes:

        - **Status**: Current state of the operation (pending, processing, complete, error, cancelled)
        - **Progress**: Detailed progress metrics including total items, completed, failed, and percentage
        - **Scope**: Information about which districts and date range are being processed
        - **Collection Strategy**: The strategy being used (per-district or all-districts) and concurrency level

        ## Status Values

        The backfill operation can be in one of the following states:

        - **processing**: The operation is actively collecting data
        - **complete**: The operation has finished successfully (may include partial failures)
        - **error**: The operation encountered a critical error and stopped
        - **cancelled**: The operation was cancelled via `DELETE /districts/backfill/{backfillId}`

        ## Progress Tracking

        The `progress` object provides real-time metrics:

        - `total`: Total number of data collection tasks (districts  dates)
        - `completed`: Number of tasks successfully completed
        - `failed`: Number of tasks that failed (data may be partially collected)
        - `percentage`: Completion percentage (0.0 to 100.0)

        ## Polling Recommendations

        For long-running backfill operations, consider polling this endpoint at
        reasonable intervals (e.g., every 5-10 seconds) to monitor progress without
        overwhelming the server.

        ## Error Information

        When the status is `error`, additional error information may be available
        in the response to help diagnose the issue.
      parameters:
        - $ref: '#/components/parameters/backfillIdParam'
      responses:
        '200':
          description: |
            Successfully retrieved backfill status. The response includes the current
            state, progress metrics, scope information, and collection strategy details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                processing:
                  summary: Backfill in progress
                  description: |
                    The backfill operation is actively processing. Progress shows
                    partial completion with some items completed and none failed.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: processing
                    progress:
                      total: 180
                      completed: 45
                      failed: 0
                      percentage: 25.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:45:00Z"
                complete:
                  summary: Backfill completed successfully
                  description: |
                    The backfill operation has completed. All items were processed
                    successfully with no failures.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: complete
                    progress:
                      total: 180
                      completed: 180
                      failed: 0
                      percentage: 100.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T11:15:00Z"
                completeWithFailures:
                  summary: Backfill completed with partial failures
                  description: |
                    The backfill operation has completed but some items failed.
                    The failed count indicates how many data collection tasks
                    encountered errors.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: complete
                    progress:
                      total: 180
                      completed: 175
                      failed: 5
                      percentage: 100.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T11:15:00Z"
                pending:
                  summary: Backfill just started (initial state)
                  description: |
                    The backfill operation has just been accepted and is beginning
                    to process. Progress shows 0% completion as no items have been
                    processed yet.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: processing
                    progress:
                      total: 180
                      completed: 0
                      failed: 0
                      percentage: 0.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:30:00Z"
                error:
                  summary: Backfill encountered an error
                  description: |
                    The backfill operation encountered a critical error and stopped.
                    Partial data may have been collected before the error occurred.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: error
                    progress:
                      total: 180
                      completed: 67
                      failed: 1
                      percentage: 37.8
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:52:00Z"
                cancelled:
                  summary: Backfill was cancelled
                  description: |
                    The backfill operation was cancelled by the user via the
                    DELETE endpoint. Partial data collected before cancellation
                    is retained.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: cancelled
                    progress:
                      total: 180
                      completed: 90
                      failed: 0
                      percentage: 50.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:55:00Z"
        '404':
          description: |
            Backfill not found - no backfill operation exists with the specified ID.
            This may occur if:
            - The backfill ID is incorrect or malformed
            - The backfill operation has been cleaned up after completion
            - The backfill was never created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: BACKFILL_NOT_FOUND
                  message: Backfill operation not found
                  details: "No backfill operation exists with ID: bf-2026-01-24-abc123"
                  suggestions:
                    - Verify the backfill ID is correct
                    - Check if the backfill operation was recently initiated
                    - Initiate a new backfill operation if needed
        '500':
          description: |
            Internal server error - an unexpected error occurred while retrieving
            the backfill status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to retrieve backfill status
                  details: An unexpected error occurred while fetching the backfill operation status
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

    delete:
      tags:
        - Backfill
      operationId: cancelBackfill
      summary: Cancel a running backfill operation
      description: |
        Cancels a backfill operation that is currently in progress.

        ## Overview

        Use this endpoint to stop a running backfill operation before it completes.
        This is useful when:

        - The backfill was started with incorrect parameters
        - Resources need to be freed for other operations
        - The backfill is taking longer than expected and needs to be restarted with different settings

        ## Cancellation Behavior

        When a backfill is cancelled:

        - The operation stops processing new items immediately
        - Any data already collected is retained (partial data is preserved)
        - The backfill status changes to `cancelled`
        - The operation cannot be resumed; a new backfill must be initiated if needed

        ## Cancellation Constraints

        Only backfill operations in the `processing` status can be cancelled.
        Attempting to cancel a backfill in any other state will result in a 409 Conflict error.

        Non-cancellable states include:

        - **complete**: The operation has already finished successfully
        - **cancelled**: The operation was already cancelled
        - **error**: The operation has already stopped due to an error

        ## Response

        On successful cancellation, the response includes the final status of the
        backfill operation with `status: cancelled` and progress information showing
        how much data was collected before cancellation.
      parameters:
        - $ref: '#/components/parameters/backfillIdParam'
      responses:
        '200':
          description: |
            Backfill operation successfully cancelled. The response includes the
            final status showing the operation was cancelled and progress metrics
            indicating how much data was collected before cancellation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                cancelled:
                  summary: Backfill successfully cancelled
                  description: |
                    The backfill operation was successfully cancelled. The status
                    shows `cancelled` and progress indicates partial completion.
                    Data collected before cancellation is retained.
                  value:
                    backfillId: "bf-2026-01-24-abc123"
                    status: cancelled
                    progress:
                      total: 180
                      completed: 90
                      failed: 0
                      percentage: 50.0
                    scope:
                      scopeType: specific-districts
                      targetDistricts:
                        - "57"
                        - "F"
                        - "101"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:55:00Z"
                cancelledEarly:
                  summary: Backfill cancelled early in processing
                  description: |
                    The backfill operation was cancelled shortly after starting,
                    with minimal data collected.
                  value:
                    backfillId: "bf-2026-01-24-def456"
                    status: cancelled
                    progress:
                      total: 360
                      completed: 12
                      failed: 0
                      percentage: 3.3
                    scope:
                      scopeType: all-districts
                      startDate: "2025-01-01"
                      endDate: "2025-06-30"
                    collectionStrategy:
                      type: all-districts
                      concurrency: 5
                    createdAt: "2026-01-24T14:00:00Z"
                    updatedAt: "2026-01-24T14:02:00Z"
        '404':
          description: |
            Backfill not found - no backfill operation exists with the specified ID.
            This may occur if:
            - The backfill ID is incorrect or malformed
            - The backfill operation has been cleaned up after completion
            - The backfill was never created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: BACKFILL_NOT_FOUND
                  message: Backfill operation not found
                  details: "No backfill operation exists with ID: bf-2026-01-24-xyz789"
                  suggestions:
                    - Verify the backfill ID is correct
                    - Check if the backfill operation was recently initiated
                    - Use GET /districts/backfill/{backfillId} to verify the backfill exists
        '409':
          description: |
            Conflict - the backfill operation cannot be cancelled because it is not
            in a cancellable state. Only backfill operations with `status: processing`
            can be cancelled.

            This error occurs when attempting to cancel a backfill that is:
            - **complete**: Already finished successfully
            - **cancelled**: Already cancelled
            - **error**: Already stopped due to an error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictErrorResponse'
              examples:
                alreadyComplete:
                  summary: Backfill already complete
                  description: |
                    The backfill operation has already completed successfully and
                    cannot be cancelled.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-2026-01-24-abc123 is already complete and cannot be cancelled"
                      suggestions:
                        - Only backfill operations in 'processing' status can be cancelled
                        - Initiate a new backfill operation if different data is needed
                alreadyCancelled:
                  summary: Backfill already cancelled
                  description: |
                    The backfill operation was already cancelled and cannot be
                    cancelled again.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-2026-01-24-abc123 is already cancelled"
                      suggestions:
                        - The backfill operation was previously cancelled
                        - Initiate a new backfill operation if needed
                alreadyErrored:
                  summary: Backfill already in error state
                  description: |
                    The backfill operation has already stopped due to an error
                    and cannot be cancelled.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-2026-01-24-abc123 is in error state and cannot be cancelled"
                      suggestions:
                        - The backfill operation has already stopped due to an error
                        - Review the error details using GET /districts/backfill/{backfillId}
                        - Initiate a new backfill operation to retry
        '500':
          description: |
            Internal server error - an unexpected error occurred while attempting
            to cancel the backfill operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to cancel backfill operation
                  details: An unexpected error occurred while attempting to cancel the backfill
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /districts/{districtId}/backfill:
    post:
      tags:
        - Backfill
      operationId: initiateDistrictBackfill
      summary: Initiate backfill for a specific district
      description: |
        Initiates a historical data collection (backfill) operation for a single
        specific Toastmasters district.

        This endpoint is a simplified alternative to the global backfill endpoint
        (`POST /districts/backfill`) when you only need to collect historical data
        for one district. The district is specified in the URL path, and the request
        body only requires the date range.

        ## How It Works

        1. **Submit Request**: Provide the date range for data collection
        2. **Receive Job ID**: The API returns a backfill job ID immediately
        3. **Monitor Progress**: Use `GET /districts/{districtId}/backfill/{backfillId}` to track progress
        4. **Cancel if Needed**: Use `DELETE /districts/{districtId}/backfill/{backfillId}` to cancel

        ## Date Range

        - **startDate**: The earliest date to collect data for (inclusive)
        - **endDate**: The latest date to collect data for (inclusive)
        - The date range should not exceed 365 days
        - Dates must be in ISO 8601 format (YYYY-MM-DD)

        ## Use Cases

        - Collecting historical data for a newly added district
        - Filling gaps in data for a specific district
        - Re-collecting data after a data quality issue
        - Testing backfill functionality on a single district before running globally

        ## Response

        The endpoint returns HTTP 202 Accepted with a `BackfillStatus` object containing:
        - The unique backfill job ID for tracking
        - Initial status (`processing`)
        - Scope information showing the single district and date range
        - Progress tracking (initially 0%)

        The backfill operation runs asynchronously. Use the returned `backfillId` to
        monitor progress via the status endpoint.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
      requestBody:
        required: true
        description: |
          Date range configuration for the district backfill operation.
          Specifies the start and end dates for historical data collection.
        content:
          application/json:
            schema:
              type: object
              description: |
                Request body for initiating a district-specific backfill operation.
                Contains only the date range since the district is specified in the URL path.
              required:
                - startDate
                - endDate
              properties:
                startDate:
                  type: string
                  format: date
                  description: |
                    Start date for the backfill operation (inclusive).
                    Data collection will begin from this date.
                    Must be in ISO 8601 format (YYYY-MM-DD).
                  example: "2025-07-01"
                endDate:
                  type: string
                  format: date
                  description: |
                    End date for the backfill operation (inclusive).
                    Data collection will continue through this date.
                    Must be in ISO 8601 format (YYYY-MM-DD).
                    Must be on or after startDate.
                  example: "2025-12-31"
            examples:
              sixMonthBackfill:
                summary: Six-month historical backfill
                description: Collect data for the first half of the program year
                value:
                  startDate: "2025-07-01"
                  endDate: "2025-12-31"
              recentBackfill:
                summary: Recent data backfill
                description: Collect data for the past month
                value:
                  startDate: "2026-01-01"
                  endDate: "2026-01-24"
              quarterBackfill:
                summary: Quarterly backfill
                description: Collect data for Q1 of the program year
                value:
                  startDate: "2025-07-01"
                  endDate: "2025-09-30"
      responses:
        '202':
          description: |
            Backfill operation accepted and started. The response includes the
            backfill job ID and initial status information. Use the backfillId
            to monitor progress via `GET /districts/{districtId}/backfill/{backfillId}`.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                accepted:
                  summary: Backfill job accepted
                  description: Initial response when backfill is successfully initiated
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: processing
                    progress:
                      total: 184
                      completed: 0
                      failed: 0
                      percentage: 0.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:30:00Z"
        '400':
          description: |
            Bad request - the request contains invalid parameters.
            Common causes include:
            - Invalid district ID format
            - Invalid date format (must be YYYY-MM-DD)
            - Invalid date range (startDate after endDate)
            - Date range exceeds maximum allowed (365 days)
            - Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDistrictId:
                  summary: Invalid district ID
                  value:
                    error:
                      code: INVALID_DISTRICT_ID
                      message: Invalid district ID format
                      details: District ID must be alphanumeric
                      suggestions:
                        - Use a valid district ID like "57" or "F"
                        - Check the /districts endpoint for available district IDs
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "startDate must be in YYYY-MM-DD format, received: '2025/07/01'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2025-07-01"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: startDate (2025-12-31) must be before or equal to endDate (2025-07-01)
                      suggestions:
                        - Ensure startDate is before endDate
                        - Swap the date values if they are reversed
                dateRangeTooLarge:
                  summary: Date range too large
                  value:
                    error:
                      code: DATE_RANGE_TOO_LARGE
                      message: Date range exceeds maximum allowed
                      details: "Date range of 400 days exceeds maximum of 365 days"
                      suggestions:
                        - Reduce the date range to 365 days or less
                        - Split the backfill into multiple smaller operations
                missingDates:
                  summary: Missing required dates
                  value:
                    error:
                      code: MISSING_DATE_PARAMETERS
                      message: Missing required date parameters
                      details: Both startDate and endDate are required
                      suggestions:
                        - Provide both startDate and endDate in the request body
                        - Use ISO 8601 date format (YYYY-MM-DD)
        '404':
          description: |
            Not found - the specified district does not exist or has no data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: NO_DATA_AVAILABLE
                  message: District not found
                  details: No data exists for district XYZ
                  suggestions:
                    - Verify the district ID is correct
                    - Check the /districts endpoint for available district IDs
        '500':
          description: |
            Internal server error - an unexpected error occurred while initiating
            the backfill operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: BACKFILL_ERROR
                  message: Failed to initiate backfill operation
                  details: An unexpected error occurred while starting the backfill job
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /districts/{districtId}/backfill/{backfillId}:
    get:
      tags:
        - Backfill
      operationId: getDistrictBackfillStatus
      summary: Get the status of a district-specific backfill operation
      description: |
        Retrieves the current status and progress of a backfill operation for a specific district.

        ## Overview

        After initiating a district-specific backfill operation via `POST /districts/{districtId}/backfill`,
        use this endpoint to monitor its progress. This endpoint is scoped to a specific district,
        meaning it will only return status for backfill operations that were initiated for that district.

        The response includes:

        - **Status**: Current state of the operation (processing, complete, error, cancelled)
        - **Progress**: Detailed progress metrics including total items, completed, failed, and percentage
        - **Scope**: Information about the district and date range being processed
        - **Collection Strategy**: The strategy being used and concurrency level

        ## Status Values

        The backfill operation can be in one of the following states:

        - **processing**: The operation is actively collecting data
        - **complete**: The operation has finished successfully (may include partial failures)
        - **error**: The operation encountered a critical error and stopped
        - **cancelled**: The operation was cancelled via `DELETE /districts/{districtId}/backfill/{backfillId}`

        ## Progress Tracking

        The `progress` object provides real-time metrics:

        - `total`: Total number of data collection tasks (dates to process)
        - `completed`: Number of tasks successfully completed
        - `failed`: Number of tasks that failed (data may be partially collected)
        - `percentage`: Completion percentage (0.0 to 100.0)

        ## District Scope Validation

        This endpoint validates that the backfill operation belongs to the specified district.
        If the backfill ID exists but was initiated for a different district, a 404 error
        will be returned. Use the global endpoint `GET /districts/backfill/{backfillId}` if
        you need to check a backfill without knowing its associated district.

        ## Polling Recommendations

        For long-running backfill operations, consider polling this endpoint at
        reasonable intervals (e.g., every 5-10 seconds) to monitor progress without
        overwhelming the server.

        ## Error Information

        When the status is `error`, additional error information may be available
        in the response to help diagnose the issue.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/backfillIdParam'
      responses:
        '200':
          description: |
            Successfully retrieved backfill status. The response includes the current
            state, progress metrics, scope information, and collection strategy details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                processing:
                  summary: Backfill in progress
                  description: |
                    The backfill operation is actively processing. Progress shows
                    partial completion with some items completed and none failed.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: processing
                    progress:
                      total: 184
                      completed: 92
                      failed: 0
                      percentage: 50.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:45:00Z"
                complete:
                  summary: Backfill completed successfully
                  description: |
                    The backfill operation has completed. All items were processed
                    successfully with no failures.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: complete
                    progress:
                      total: 184
                      completed: 184
                      failed: 0
                      percentage: 100.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T11:15:00Z"
                completeWithFailures:
                  summary: Backfill completed with partial failures
                  description: |
                    The backfill operation has completed but some items failed.
                    The failed count indicates how many data collection tasks
                    encountered errors.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: complete
                    progress:
                      total: 184
                      completed: 180
                      failed: 4
                      percentage: 100.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T11:15:00Z"
                error:
                  summary: Backfill encountered an error
                  description: |
                    The backfill operation encountered a critical error and stopped.
                    Partial data may have been collected before the error occurred.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: error
                    progress:
                      total: 184
                      completed: 67
                      failed: 1
                      percentage: 36.4
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:52:00Z"
                cancelled:
                  summary: Backfill was cancelled
                  description: |
                    The backfill operation was cancelled by the user via the
                    DELETE endpoint. Partial data collected before cancellation
                    is retained.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: cancelled
                    progress:
                      total: 184
                      completed: 92
                      failed: 0
                      percentage: 50.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:55:00Z"
        '400':
          description: |
            Bad request - the district ID format is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: Invalid district ID format
                  details: District ID must be alphanumeric
                  suggestions:
                    - Use a valid district ID like "57" or "F"
                    - Check the /districts endpoint for available district IDs
        '404':
          description: |
            Not found - the backfill operation does not exist or does not belong
            to the specified district. This may occur if:
            - The backfill ID is incorrect or malformed
            - The backfill operation was initiated for a different district
            - The backfill operation has been cleaned up after completion
            - The backfill was never created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                backfillNotFound:
                  summary: Backfill operation not found
                  value:
                    error:
                      code: BACKFILL_NOT_FOUND
                      message: Backfill operation not found
                      details: "No backfill operation exists with ID: bf-57-2026-01-24-xyz789"
                      suggestions:
                        - Verify the backfill ID is correct
                        - Check if the backfill operation was recently initiated
                        - Initiate a new backfill operation if needed
                wrongDistrict:
                  summary: Backfill belongs to different district
                  value:
                    error:
                      code: BACKFILL_NOT_FOUND
                      message: Backfill operation not found for this district
                      details: "Backfill bf-101-2026-01-24-abc123 does not belong to district 57"
                      suggestions:
                        - Verify the district ID matches the backfill operation
                        - Use the global endpoint GET /districts/backfill/{backfillId} to check any backfill
        '500':
          description: |
            Internal server error - an unexpected error occurred while retrieving
            the backfill status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to retrieve backfill status
                  details: An unexpected error occurred while fetching the backfill operation status
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

    delete:
      tags:
        - Backfill
      operationId: cancelDistrictBackfill
      summary: Cancel a district-specific backfill operation
      description: |
        Cancels a backfill operation that is currently in progress for a specific district.

        ## Overview

        Use this endpoint to stop a running district-specific backfill operation before it completes.
        This is useful when:

        - The backfill was started with incorrect parameters
        - Resources need to be freed for other operations
        - The backfill is taking longer than expected and needs to be restarted with different settings

        ## Cancellation Behavior

        When a backfill is cancelled:

        - The operation stops processing new items immediately
        - Any data already collected is retained (partial data is preserved)
        - The backfill status changes to `cancelled`
        - The operation cannot be resumed; a new backfill must be initiated if needed

        ## Cancellation Constraints

        Only backfill operations in the `processing` status can be cancelled.
        Attempting to cancel a backfill in any other state will result in a 409 Conflict error.

        Non-cancellable states include:

        - **complete**: The operation has already finished successfully
        - **cancelled**: The operation was already cancelled
        - **error**: The operation has already stopped due to an error

        ## District Scope Validation

        This endpoint validates that the backfill operation belongs to the specified district.
        If the backfill ID exists but was initiated for a different district, a 404 error
        will be returned. Use the global endpoint `DELETE /districts/backfill/{backfillId}` if
        you need to cancel a backfill without knowing its associated district.

        ## Response

        On successful cancellation, the response includes the final status of the
        backfill operation with `status: cancelled` and progress information showing
        how much data was collected before cancellation.
      parameters:
        - $ref: '#/components/parameters/districtIdParam'
        - $ref: '#/components/parameters/backfillIdParam'
      responses:
        '200':
          description: |
            Backfill operation successfully cancelled. The response includes the
            final status showing the operation was cancelled and progress metrics
            indicating how much data was collected before cancellation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackfillStatus'
              examples:
                cancelled:
                  summary: Backfill successfully cancelled
                  description: |
                    The backfill operation was successfully cancelled. The status
                    shows `cancelled` and progress indicates partial completion.
                    Data collected before cancellation is retained.
                  value:
                    backfillId: "bf-57-2026-01-24-xyz789"
                    status: cancelled
                    progress:
                      total: 184
                      completed: 92
                      failed: 0
                      percentage: 50.0
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T10:30:00Z"
                    updatedAt: "2026-01-24T10:55:00Z"
                cancelledEarly:
                  summary: Backfill cancelled early in processing
                  description: |
                    The backfill operation was cancelled shortly after starting,
                    with minimal data collected.
                  value:
                    backfillId: "bf-57-2026-01-24-abc123"
                    status: cancelled
                    progress:
                      total: 184
                      completed: 8
                      failed: 0
                      percentage: 4.3
                    scope:
                      scopeType: single-district
                      targetDistricts:
                        - "57"
                      startDate: "2025-07-01"
                      endDate: "2025-12-31"
                    collectionStrategy:
                      type: per-district
                      concurrency: 3
                    createdAt: "2026-01-24T14:00:00Z"
                    updatedAt: "2026-01-24T14:02:00Z"
        '400':
          description: |
            Bad request - the district ID format is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DISTRICT_ID
                  message: Invalid district ID format
                  details: District ID must be alphanumeric
                  suggestions:
                    - Use a valid district ID like "57" or "F"
                    - Check the /districts endpoint for available district IDs
        '404':
          description: |
            Not found - the backfill operation does not exist or does not belong
            to the specified district. This may occur if:
            - The backfill ID is incorrect or malformed
            - The backfill operation was initiated for a different district
            - The backfill operation has been cleaned up after completion
            - The backfill was never created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              examples:
                backfillNotFound:
                  summary: Backfill operation not found
                  value:
                    error:
                      code: BACKFILL_NOT_FOUND
                      message: Backfill operation not found
                      details: "No backfill operation exists with ID: bf-57-2026-01-24-xyz789"
                      suggestions:
                        - Verify the backfill ID is correct
                        - Check if the backfill operation was recently initiated
                        - Initiate a new backfill operation if needed
                wrongDistrict:
                  summary: Backfill belongs to different district
                  value:
                    error:
                      code: BACKFILL_NOT_FOUND
                      message: Backfill operation not found for this district
                      details: "Backfill bf-101-2026-01-24-abc123 does not belong to district 57"
                      suggestions:
                        - Verify the district ID matches the backfill operation
                        - Use the global endpoint DELETE /districts/backfill/{backfillId} to cancel any backfill
        '409':
          description: |
            Conflict - the backfill operation cannot be cancelled because it is not
            in a cancellable state. Only backfill operations with `status: processing`
            can be cancelled.

            This error occurs when attempting to cancel a backfill that is:
            - **complete**: Already finished successfully
            - **cancelled**: Already cancelled
            - **error**: Already stopped due to an error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictErrorResponse'
              examples:
                alreadyComplete:
                  summary: Backfill already complete
                  description: |
                    The backfill operation has already completed successfully and
                    cannot be cancelled.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-57-2026-01-24-xyz789 is already complete and cannot be cancelled"
                      suggestions:
                        - Only backfill operations in 'processing' status can be cancelled
                        - Initiate a new backfill operation if different data is needed
                alreadyCancelled:
                  summary: Backfill already cancelled
                  description: |
                    The backfill operation was already cancelled and cannot be
                    cancelled again.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-57-2026-01-24-xyz789 is already cancelled"
                      suggestions:
                        - The backfill operation was previously cancelled
                        - Initiate a new backfill operation if needed
                alreadyErrored:
                  summary: Backfill already in error state
                  description: |
                    The backfill operation has already stopped due to an error
                    and cannot be cancelled.
                  value:
                    error:
                      code: CANNOT_CANCEL_JOB
                      message: Cannot cancel backfill operation
                      details: "Backfill bf-57-2026-01-24-xyz789 is in error state and cannot be cancelled"
                      suggestions:
                        - The backfill operation has already stopped due to an error
                        - Review the error details using GET /districts/{districtId}/backfill/{backfillId}
                        - Initiate a new backfill operation to retry
        '500':
          description: |
            Internal server error - an unexpected error occurred while attempting
            to cancel the backfill operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to cancel backfill operation
                  details: An unexpected error occurred while attempting to cancel the backfill
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  # ============================================================================
  # Admin Endpoints
  # ============================================================================

  /admin/snapshots:
    get:
      tags:
        - Admin
      operationId: listSnapshots
      summary: List all snapshots
      description: |
        Retrieves a list of all available snapshots with optional filtering.

        Snapshots represent complete, normalized views of the source data at specific
        points in time. This endpoint provides administrative access to browse and
        filter the snapshot inventory.

        ## Filtering Options

        Multiple filter parameters can be combined to narrow down results:

        - **status**: Filter by snapshot collection status (success, partial, failed)
        - **schema_version**: Filter by data schema version
        - **calculation_version**: Filter by calculation/scoring version
        - **created_after/created_before**: Filter by creation date range
        - **min_district_count**: Filter by minimum number of districts in snapshot

        ## Pagination

        Use the `limit` parameter to control the maximum number of results returned.
        Results are ordered by creation date (most recent first).

        ## Use Cases

        This endpoint is useful for:
        - Auditing snapshot collection history
        - Identifying gaps in data collection
        - Finding snapshots with specific characteristics
        - Monitoring data collection health over time
        - Debugging data quality issues
      parameters:
        - name: limit
          in: query
          required: false
          description: |
            Maximum number of snapshots to return.
            Results are ordered by creation date (most recent first).
            If not specified, returns all matching snapshots.
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
          example: 50
        - name: status
          in: query
          required: false
          description: |
            Filter snapshots by collection status.
            - `success`: Only snapshots where all data was collected successfully
            - `partial`: Only snapshots with some data gaps or errors
            - `failed`: Only snapshots where data collection failed
          schema:
            type: string
            enum:
              - success
              - partial
              - failed
          example: success
        - name: schema_version
          in: query
          required: false
          description: |
            Filter snapshots by schema version.
            Schema version indicates the structural definition of the normalized
            data contained in the snapshot. Useful for finding snapshots compatible
            with specific data processing logic.
          schema:
            type: string
          example: "1.0.0"
        - name: calculation_version
          in: query
          required: false
          description: |
            Filter snapshots by calculation/scoring version.
            Calculation version indicates the specific set of computation or
            scoring rules applied to the snapshot. Useful for comparing results
            across different algorithm versions.
          schema:
            type: string
          example: "2.1.0"
        - name: created_after
          in: query
          required: false
          description: |
            Filter snapshots created after this date (inclusive).
            Date must be in ISO 8601 format (YYYY-MM-DD).
          schema:
            type: string
            format: date
          example: "2026-01-01"
        - name: created_before
          in: query
          required: false
          description: |
            Filter snapshots created before this date (inclusive).
            Date must be in ISO 8601 format (YYYY-MM-DD).
          schema:
            type: string
            format: date
          example: "2026-01-31"
        - name: min_district_count
          in: query
          required: false
          description: |
            Filter snapshots that contain at least this many districts.
            Useful for finding snapshots with comprehensive data coverage.
          schema:
            type: integer
            minimum: 1
          example: 100
      responses:
        '200':
          description: Successfully retrieved list of snapshots
          content:
            application/json:
              schema:
                type: object
                properties:
                  snapshots:
                    type: array
                    description: List of snapshots matching the filter criteria
                    items:
                      $ref: '#/components/schemas/SnapshotMetadata'
                  total:
                    type: integer
                    description: Total number of snapshots matching the filter criteria
                    example: 150
                  limit:
                    type: integer
                    description: Maximum number of results requested
                    example: 50
                  filters_applied:
                    type: object
                    description: Summary of filters that were applied to the query
                    properties:
                      status:
                        type: string
                        description: Status filter applied, if any
                        example: success
                      schema_version:
                        type: string
                        description: Schema version filter applied, if any
                        example: "1.0.0"
                      calculation_version:
                        type: string
                        description: Calculation version filter applied, if any
                        example: "2.1.0"
                      created_after:
                        type: string
                        format: date
                        description: Created after filter applied, if any
                        example: "2026-01-01"
                      created_before:
                        type: string
                        format: date
                        description: Created before filter applied, if any
                        example: "2026-01-31"
                      min_district_count:
                        type: integer
                        description: Minimum district count filter applied, if any
                        example: 100
              examples:
                allSnapshots:
                  summary: List of all snapshots (no filters)
                  value:
                    snapshots:
                      - snapshot_id: "2026-01-24"
                        created_at: "2026-01-24T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                      - snapshot_id: "2026-01-23"
                        created_at: "2026-01-23T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                      - snapshot_id: "2026-01-22"
                        created_at: "2026-01-22T06:00:00Z"
                        status: partial
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                    total: 150
                    limit: 100
                    filters_applied: {}
                filteredByStatus:
                  summary: Snapshots filtered by status
                  value:
                    snapshots:
                      - snapshot_id: "2026-01-24"
                        created_at: "2026-01-24T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                      - snapshot_id: "2026-01-23"
                        created_at: "2026-01-23T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                    total: 120
                    limit: 50
                    filters_applied:
                      status: success
                filteredByDateRange:
                  summary: Snapshots filtered by date range
                  value:
                    snapshots:
                      - snapshot_id: "2026-01-15"
                        created_at: "2026-01-15T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                      - snapshot_id: "2026-01-10"
                        created_at: "2026-01-10T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                    total: 15
                    limit: 100
                    filters_applied:
                      created_after: "2026-01-01"
                      created_before: "2026-01-20"
                multipleFilters:
                  summary: Snapshots with multiple filters applied
                  value:
                    snapshots:
                      - snapshot_id: "2026-01-24"
                        created_at: "2026-01-24T06:00:00Z"
                        status: success
                        is_closing_period: false
                        data_source: scraper
                        from_cache: true
                    total: 45
                    limit: 50
                    filters_applied:
                      status: success
                      min_district_count: 100
                      created_after: "2026-01-01"
        '400':
          description: |
            Bad request - invalid query parameters.
            This may occur if:
            - Date format is invalid (must be YYYY-MM-DD)
            - Status value is not one of: success, partial, failed
            - Limit is out of range (must be 1-1000)
            - min_district_count is less than 1
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              examples:
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error:
                      code: INVALID_DATE_FORMAT
                      message: Invalid date format
                      details: "created_after must be in YYYY-MM-DD format, received: '01-24-2026'"
                      suggestions:
                        - Use ISO 8601 date format (YYYY-MM-DD)
                        - "Example: 2026-01-24"
                invalidStatus:
                  summary: Invalid status value
                  value:
                    error:
                      code: VALIDATION_ERROR
                      message: Invalid status parameter
                      details: "Status must be one of: success, partial, failed"
                      suggestions:
                        - Use 'success' for fully successful snapshots
                        - Use 'partial' for snapshots with some data gaps
                        - Use 'failed' for failed snapshot attempts
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error:
                      code: INVALID_DATE_RANGE
                      message: Invalid date range
                      details: "created_after (2026-02-01) must be before created_before (2026-01-01)"
                      suggestions:
                        - Ensure created_after is earlier than created_before
                        - Swap the date values if they are reversed
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to retrieve snapshots
                  details: An unexpected error occurred while querying the snapshot inventory
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /admin/snapshots/{snapshotId}:
    get:
      tags:
        - Admin
      operationId: getSnapshotInspection
      summary: Get snapshot inspection data
      description: |
        Retrieves detailed inspection data for a specific snapshot.

        This endpoint provides comprehensive metadata and quality information about
        a snapshot without returning the full payload data. It is designed for
        administrative inspection and debugging purposes.

        ## Response Contents

        The inspection response includes:

        - **Core Metadata**: Snapshot ID, creation timestamp, status, and source information
        - **Version Information**: Schema version and calculation version used
        - **District Coverage**: Count and list of districts included in the snapshot
        - **Data Quality Metrics**: Completeness percentage, error counts, and quality indicators
        - **Collection Timing**: Duration, start/end times, and performance metrics
        - **Closing Period Info**: Whether this is a month-end or year-end snapshot

        ## Use Cases

        This endpoint is useful for:
        - Inspecting snapshot metadata before retrieving full payload
        - Auditing data quality and completeness
        - Debugging data collection issues
        - Verifying schema and calculation versions
        - Understanding snapshot coverage and timing

        ## Related Endpoints

        - `GET /admin/snapshots` - List all snapshots with filtering
        - `GET /admin/snapshots/{snapshotId}/payload` - Retrieve full snapshot data

        **Note**: This endpoint returns inspection metadata only. To retrieve the
        actual snapshot data, use the `/admin/snapshots/{snapshotId}/payload` endpoint.
      parameters:
        - $ref: '#/components/parameters/snapshotIdParam'
      responses:
        '200':
          description: Successfully retrieved snapshot inspection data
          content:
            application/json:
              schema:
                type: object
                description: |
                  Detailed inspection data for a specific snapshot, including
                  metadata, quality metrics, and coverage information.
                required:
                  - snapshot_id
                  - created_at
                  - status
                  - schema_version
                  - calculation_version
                  - district_count
                  - districts
                  - data_quality
                  - collection_timing
                properties:
                  snapshot_id:
                    type: string
                    description: |
                      Unique identifier for the snapshot, typically an ISO date string
                      (YYYY-MM-DD) representing when the data was collected.
                    example: "2026-01-24"
                  created_at:
                    type: string
                    format: date-time
                    description: |
                      Timestamp when the snapshot was created.
                    example: "2026-01-24T06:00:00Z"
                  status:
                    type: string
                    description: |
                      Status of the snapshot data collection.
                      - `success`: All data was collected successfully
                      - `partial`: Some data was collected but with gaps or errors
                      - `failed`: Data collection failed
                    enum:
                      - success
                      - partial
                      - failed
                    example: success
                  schema_version:
                    type: string
                    description: |
                      Version of the data schema used for this snapshot.
                      Schema version indicates the structural definition of the
                      normalized data contained in the snapshot.
                    example: "1.0.0"
                  calculation_version:
                    type: string
                    description: |
                      Version of the calculation/scoring rules applied to this snapshot.
                      Calculation version indicates the specific set of computation
                      or scoring rules used to derive metrics and rankings.
                    example: "2.1.0"
                  data_source:
                    type: string
                    description: |
                      Source of the snapshot data, indicating how the data was obtained.
                      Common values include 'scraper', 'backfill', or 'manual'.
                    example: scraper
                  is_closing_period:
                    type: boolean
                    description: |
                      Indicates whether this snapshot represents a closing period
                      (month-end or year-end) which may have special significance
                      for reporting and analytics.
                    example: false
                  closing_period_type:
                    type: string
                    description: |
                      Type of closing period, if applicable.
                      Only present when `is_closing_period` is true.
                    enum:
                      - month-end
                      - year-end
                    example: month-end
                  district_count:
                    type: integer
                    description: |
                      Total number of districts included in this snapshot.
                      Useful for quickly assessing data coverage.
                    minimum: 0
                    example: 120
                  districts:
                    type: array
                    description: |
                      List of district identifiers included in this snapshot.
                      Provides visibility into which districts have data in this snapshot.
                    items:
                      type: string
                      description: District identifier
                    example:
                      - "1"
                      - "2"
                      - "57"
                      - "101"
                      - "F"
                  data_quality:
                    type: object
                    description: |
                      Data quality metrics for this snapshot, providing insight into
                      the completeness and reliability of the collected data.
                    required:
                      - completeness_percent
                      - error_count
                      - warning_count
                    properties:
                      completeness_percent:
                        type: number
                        format: float
                        description: |
                          Percentage of expected data that was successfully collected.
                          100% indicates all expected data was collected without gaps.
                        minimum: 0
                        maximum: 100
                        example: 98.5
                      error_count:
                        type: integer
                        description: |
                          Number of errors encountered during data collection.
                          Errors indicate data that could not be collected or processed.
                        minimum: 0
                        example: 2
                      warning_count:
                        type: integer
                        description: |
                          Number of warnings generated during data collection.
                          Warnings indicate potential issues that did not prevent collection.
                        minimum: 0
                        example: 5
                      missing_districts:
                        type: array
                        description: |
                          List of district identifiers that were expected but not collected.
                          Only present if there are missing districts.
                        items:
                          type: string
                        example:
                          - "99"
                          - "100"
                      quality_notes:
                        type: array
                        description: |
                          Additional notes about data quality issues or anomalies.
                          Provides human-readable context for quality metrics.
                        items:
                          type: string
                        example:
                          - "District 99 returned empty response"
                          - "District 100 had timeout during collection"
                  collection_timing:
                    type: object
                    description: |
                      Timing information about the data collection process.
                      Useful for performance monitoring and debugging.
                    required:
                      - started_at
                      - completed_at
                      - duration_seconds
                    properties:
                      started_at:
                        type: string
                        format: date-time
                        description: |
                          Timestamp when data collection started.
                        example: "2026-01-24T05:45:00Z"
                      completed_at:
                        type: string
                        format: date-time
                        description: |
                          Timestamp when data collection completed.
                        example: "2026-01-24T06:00:00Z"
                      duration_seconds:
                        type: integer
                        description: |
                          Total duration of the data collection process in seconds.
                        minimum: 0
                        example: 900
                      districts_per_second:
                        type: number
                        format: float
                        description: |
                          Average rate of district data collection.
                          Useful for performance benchmarking.
                        example: 0.13
              examples:
                successfulSnapshot:
                  summary: Successful snapshot with complete data
                  value:
                    snapshot_id: "2026-01-24"
                    created_at: "2026-01-24T06:00:00Z"
                    status: success
                    schema_version: "1.0.0"
                    calculation_version: "2.1.0"
                    data_source: scraper
                    is_closing_period: false
                    district_count: 120
                    districts:
                      - "1"
                      - "2"
                      - "3"
                      - "57"
                      - "101"
                      - "F"
                    data_quality:
                      completeness_percent: 100.0
                      error_count: 0
                      warning_count: 0
                    collection_timing:
                      started_at: "2026-01-24T05:45:00Z"
                      completed_at: "2026-01-24T06:00:00Z"
                      duration_seconds: 900
                      districts_per_second: 0.13
                partialSnapshot:
                  summary: Partial snapshot with some data gaps
                  value:
                    snapshot_id: "2026-01-22"
                    created_at: "2026-01-22T06:15:00Z"
                    status: partial
                    schema_version: "1.0.0"
                    calculation_version: "2.1.0"
                    data_source: scraper
                    is_closing_period: false
                    district_count: 118
                    districts:
                      - "1"
                      - "2"
                      - "3"
                      - "57"
                      - "101"
                    data_quality:
                      completeness_percent: 98.3
                      error_count: 2
                      warning_count: 3
                      missing_districts:
                        - "99"
                        - "100"
                      quality_notes:
                        - "District 99 returned empty response"
                        - "District 100 had timeout during collection"
                    collection_timing:
                      started_at: "2026-01-22T05:45:00Z"
                      completed_at: "2026-01-22T06:15:00Z"
                      duration_seconds: 1800
                      districts_per_second: 0.07
                closingPeriodSnapshot:
                  summary: Month-end closing period snapshot
                  value:
                    snapshot_id: "2025-12-31"
                    created_at: "2025-12-31T23:59:00Z"
                    status: success
                    schema_version: "1.0.0"
                    calculation_version: "2.1.0"
                    data_source: scraper
                    is_closing_period: true
                    closing_period_type: month-end
                    district_count: 120
                    districts:
                      - "1"
                      - "2"
                      - "57"
                      - "101"
                      - "F"
                    data_quality:
                      completeness_percent: 100.0
                      error_count: 0
                      warning_count: 1
                      quality_notes:
                        - "Closing period snapshot - data finalized"
                    collection_timing:
                      started_at: "2025-12-31T23:30:00Z"
                      completed_at: "2025-12-31T23:59:00Z"
                      duration_seconds: 1740
                      districts_per_second: 0.07
        '400':
          description: |
            Bad request - invalid snapshot ID format.
            The snapshot ID must be a valid ISO date string (YYYY-MM-DD).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DATE_FORMAT
                  message: Invalid snapshot ID format
                  details: "Snapshot ID must be in YYYY-MM-DD format, received: '01-24-2026'"
                  suggestions:
                    - Use ISO 8601 date format (YYYY-MM-DD)
                    - "Example: 2026-01-24"
        '404':
          description: |
            Not found - the requested snapshot does not exist.
            Use `GET /admin/snapshots` to discover available snapshot IDs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: SNAPSHOT_NOT_FOUND
                  message: Snapshot not found
                  details: "No snapshot exists for ID: 2026-01-24"
                  suggestions:
                    - Verify the snapshot ID is correct
                    - Use GET /admin/snapshots to list available snapshots
                    - Check if data collection has run for this date
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to retrieve snapshot inspection data
                  details: An unexpected error occurred while reading snapshot metadata
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

  /admin/snapshots/{snapshotId}/payload:
    get:
      tags:
        - Admin
      operationId: getSnapshotPayload
      summary: Get full snapshot data payload
      description: |
        Retrieves the complete raw data payload for a specific snapshot.

        This endpoint returns the full snapshot data including all district data,
        club information, rankings, and derived metrics. The response can be large
        (potentially several megabytes) depending on the number of districts and
        clubs included in the snapshot.

        ## Response Contents

        The payload includes the complete normalized data for all districts in the
        snapshot:

        - **District Data**: Full statistics for each district including membership,
          clubs, education, and performance metrics
        - **Club Data**: Complete club information for all clubs in each district
        - **Rankings**: Pre-calculated district rankings and scores
        - **Derived Metrics**: All computed analytics and derived values
        - **Metadata**: Snapshot metadata including schema and calculation versions

        ## Use Cases

        This endpoint is useful for:
        - **Data Export**: Exporting complete snapshot data for external analysis
        - **Backup**: Creating backups of snapshot data
        - **Detailed Analysis**: Accessing raw data for custom analytics
        - **Data Migration**: Moving data between systems
        - **Debugging**: Investigating data issues at the raw data level

        ## Performance Considerations

        **Warning**: This endpoint returns potentially large payloads. Consider:
        - Response size may be several megabytes
        - Network transfer time may be significant
        - Client memory requirements for parsing large JSON responses
        - Use `GET /admin/snapshots/{snapshotId}` for metadata-only inspection

        ## Related Endpoints

        - `GET /admin/snapshots` - List all snapshots with filtering
        - `GET /admin/snapshots/{snapshotId}` - Get snapshot inspection metadata only
      parameters:
        - $ref: '#/components/parameters/snapshotIdParam'
      responses:
        '200':
          description: |
            Successfully retrieved the full snapshot payload.
            The response contains the complete raw data for all districts
            included in the snapshot.
          content:
            application/json:
              schema:
                type: object
                description: |
                  Complete snapshot payload containing all district data,
                  club information, rankings, and metadata. This is the full
                  raw data representation of the snapshot.
                required:
                  - snapshot_id
                  - created_at
                  - status
                  - schema_version
                  - calculation_version
                  - districts
                properties:
                  snapshot_id:
                    type: string
                    description: |
                      Unique identifier for the snapshot, typically an ISO date string
                      (YYYY-MM-DD) representing when the data was collected.
                    example: "2026-01-24"
                  created_at:
                    type: string
                    format: date-time
                    description: |
                      Timestamp when the snapshot was created.
                    example: "2026-01-24T06:00:00Z"
                  status:
                    type: string
                    description: |
                      Status of the snapshot data collection.
                      - `success`: All data was collected successfully
                      - `partial`: Some data was collected but with gaps or errors
                      - `failed`: Data collection failed
                    enum:
                      - success
                      - partial
                      - failed
                    example: success
                  schema_version:
                    type: string
                    description: |
                      Version of the data schema used for this snapshot.
                      Schema version indicates the structural definition of the
                      normalized data contained in the snapshot.
                    example: "1.0.0"
                  calculation_version:
                    type: string
                    description: |
                      Version of the calculation/scoring rules applied to this snapshot.
                      Calculation version indicates the specific set of computation
                      or scoring rules used to derive metrics and rankings.
                    example: "2.1.0"
                  data_source:
                    type: string
                    description: |
                      Source of the snapshot data, indicating how the data was obtained.
                      Common values include 'scraper', 'backfill', or 'manual'.
                    example: scraper
                  is_closing_period:
                    type: boolean
                    description: |
                      Indicates whether this snapshot represents a closing period
                      (month-end or year-end) which may have special significance
                      for reporting and analytics.
                    example: false
                  closing_period_type:
                    type: string
                    description: |
                      Type of closing period, if applicable.
                      Only present when `is_closing_period` is true.
                    enum:
                      - month-end
                      - year-end
                    example: month-end
                  districts:
                    type: array
                    description: |
                      Complete data for all districts included in this snapshot.
                      Each district object contains full statistics, club data,
                      and derived metrics.
                    items:
                      type: object
                      description: |
                        Complete district data including all statistics, clubs,
                        and derived metrics for a single district.
                      required:
                        - district_id
                        - district_name
                        - statistics
                        - clubs
                      properties:
                        district_id:
                          type: string
                          description: District identifier
                          example: "57"
                        district_name:
                          type: string
                          description: Full district name
                          example: "District 57"
                        statistics:
                          type: object
                          description: |
                            Comprehensive district statistics including membership,
                            club counts, education metrics, and performance data.
                          properties:
                            membership:
                              type: object
                              description: Membership statistics for the district
                              properties:
                                total:
                                  type: integer
                                  description: Total member count
                                  example: 2500
                                active:
                                  type: integer
                                  description: Active member count
                                  example: 2350
                                new:
                                  type: integer
                                  description: New members this period
                                  example: 200
                                renewed:
                                  type: integer
                                  description: Renewed members
                                  example: 1800
                                growth:
                                  type: number
                                  format: float
                                  description: Membership growth percentage
                                  example: 6.38
                            clubs:
                              type: object
                              description: Club statistics for the district
                              properties:
                                total:
                                  type: integer
                                  description: Total club count
                                  example: 120
                                active:
                                  type: integer
                                  description: Active clubs
                                  example: 105
                                suspended:
                                  type: integer
                                  description: Suspended clubs
                                  example: 5
                                ineligible:
                                  type: integer
                                  description: Ineligible clubs
                                  example: 3
                                low:
                                  type: integer
                                  description: Low membership clubs
                                  example: 7
                                distinguished:
                                  type: integer
                                  description: Distinguished clubs
                                  example: 45
                            education:
                              type: object
                              description: Educational achievement statistics
                              properties:
                                total_awards:
                                  type: integer
                                  description: Total educational awards earned
                                  example: 450
                                by_type:
                                  type: array
                                  description: Awards breakdown by type
                                  items:
                                    type: object
                                    properties:
                                      type:
                                        type: string
                                        example: "Level 1"
                                      count:
                                        type: integer
                                        example: 120
                            performance:
                              type: object
                              description: Performance metrics and DCP goals
                              properties:
                                dcp_goals:
                                  type: integer
                                  description: DCP goals achieved
                                  example: 7
                                payments_received:
                                  type: number
                                  format: float
                                  description: Total payments received
                                  example: 45000.00
                        clubs:
                          type: array
                          description: |
                            Complete list of all clubs in the district with
                            full details for each club.
                          items:
                            type: object
                            description: Complete club data
                            required:
                              - club_id
                              - club_name
                            properties:
                              club_id:
                                type: string
                                description: Unique club identifier
                                example: "1234567"
                              club_name:
                                type: string
                                description: Club name
                                example: "Downtown Speakers"
                              division:
                                type: string
                                description: Division assignment
                                example: "A"
                              area:
                                type: string
                                description: Area assignment
                                example: "12"
                              member_count:
                                type: integer
                                description: Current member count
                                example: 25
                              active_members:
                                type: integer
                                description: Active member count
                                example: 22
                              goals_achieved:
                                type: integer
                                description: DCP goals achieved
                                example: 7
                              status:
                                type: string
                                description: Club status
                                enum:
                                  - active
                                  - suspended
                                  - ineligible
                                  - low
                                example: active
                              distinguished_status:
                                type: string
                                description: Distinguished club status if achieved
                                example: "Select Distinguished"
                              charter_date:
                                type: string
                                format: date
                                description: Club charter date
                                example: "2015-03-15"
                        rankings:
                          type: object
                          description: |
                            Pre-calculated ranking data for this district
                            relative to other districts.
                          properties:
                            overall_rank:
                              type: integer
                              description: Overall district ranking
                              example: 12
                            clubs_rank:
                              type: integer
                              description: Ranking by club growth
                              example: 15
                            payments_rank:
                              type: integer
                              description: Ranking by payment growth
                              example: 22
                            distinguished_rank:
                              type: integer
                              description: Ranking by distinguished clubs
                              example: 8
                            aggregate_score:
                              type: number
                              format: float
                              description: Aggregate Borda count score
                              example: 285.5
                  rankings_summary:
                    type: object
                    description: |
                      Summary of global rankings across all districts in the snapshot.
                    properties:
                      total_districts:
                        type: integer
                        description: Total number of districts ranked
                        example: 120
                      as_of_date:
                        type: string
                        format: date
                        description: Date the rankings were calculated
                        example: "2026-01-24"
                      program_year:
                        type: string
                        description: Toastmasters program year
                        example: "2025-2026"
              examples:
                completePayload:
                  summary: Complete snapshot payload with district data
                  value:
                    snapshot_id: "2026-01-24"
                    created_at: "2026-01-24T06:00:00Z"
                    status: success
                    schema_version: "1.0.0"
                    calculation_version: "2.1.0"
                    data_source: scraper
                    is_closing_period: false
                    districts:
                      - district_id: "57"
                        district_name: "District 57"
                        statistics:
                          membership:
                            total: 2500
                            active: 2350
                            new: 200
                            renewed: 1800
                            growth: 6.38
                          clubs:
                            total: 120
                            active: 105
                            suspended: 5
                            ineligible: 3
                            low: 7
                            distinguished: 45
                          education:
                            total_awards: 450
                            by_type:
                              - type: "Level 1"
                                count: 120
                              - type: "Level 2"
                                count: 85
                          performance:
                            dcp_goals: 7
                            payments_received: 45000.00
                        clubs:
                          - club_id: "1234567"
                            club_name: "Downtown Speakers"
                            division: "A"
                            area: "12"
                            member_count: 25
                            active_members: 22
                            goals_achieved: 7
                            status: active
                            distinguished_status: "Select Distinguished"
                            charter_date: "2015-03-15"
                          - club_id: "7654321"
                            club_name: "Morning Leaders"
                            division: "A"
                            area: "12"
                            member_count: 32
                            active_members: 30
                            goals_achieved: 9
                            status: active
                            distinguished_status: "President's Distinguished"
                            charter_date: "2010-09-01"
                        rankings:
                          overall_rank: 12
                          clubs_rank: 15
                          payments_rank: 22
                          distinguished_rank: 8
                          aggregate_score: 285.5
                    rankings_summary:
                      total_districts: 120
                      as_of_date: "2026-01-24"
                      program_year: "2025-2026"
                minimalPayload:
                  summary: Minimal payload structure (truncated for brevity)
                  value:
                    snapshot_id: "2026-01-24"
                    created_at: "2026-01-24T06:00:00Z"
                    status: success
                    schema_version: "1.0.0"
                    calculation_version: "2.1.0"
                    data_source: scraper
                    is_closing_period: false
                    districts: []
                    rankings_summary:
                      total_districts: 0
                      as_of_date: "2026-01-24"
                      program_year: "2025-2026"
        '400':
          description: |
            Bad request - invalid snapshot ID format.
            The snapshot ID must be a valid ISO date string (YYYY-MM-DD).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequestErrorResponse'
              example:
                error:
                  code: INVALID_DATE_FORMAT
                  message: Invalid snapshot ID format
                  details: "Snapshot ID must be in YYYY-MM-DD format, received: '01-24-2026'"
                  suggestions:
                    - Use ISO 8601 date format (YYYY-MM-DD)
                    - "Example: 2026-01-24"
        '404':
          description: |
            Not found - the requested snapshot does not exist.
            Use `GET /admin/snapshots` to discover available snapshot IDs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundErrorResponse'
              example:
                error:
                  code: SNAPSHOT_NOT_FOUND
                  message: Snapshot not found
                  details: "No snapshot exists for ID: 2026-01-24"
                  suggestions:
                    - Verify the snapshot ID is correct
                    - Use GET /admin/snapshots to list available snapshots
                    - Check if data collection has run for this date
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerErrorResponse'
              example:
                error:
                  code: INTERNAL_ERROR
                  message: Failed to retrieve snapshot payload
                  details: An unexpected error occurred while reading snapshot data
        '503':
          description: |
            Service unavailable - the storage service is temporarily unavailable.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceUnavailableErrorResponse'
              example:
                error:
                  code: SERVICE_UNAVAILABLE
                  message: Storage service temporarily unavailable
                  details: The data storage service is currently unavailable. Please try again later.

components:
  schemas:
    # Error Response Schemas
    ErrorCode:
      type: string
      description: |
        Machine-readable error codes returned by the API.
        Each code corresponds to a specific error condition and HTTP status.
      enum:
        # 400 Bad Request errors
        - INVALID_DISTRICT_ID
        - INVALID_DATE_FORMAT
        - INVALID_DATE_RANGE
        - DATE_RANGE_TOO_LARGE
        - MISSING_DATE_PARAMETERS
        - VALIDATION_ERROR
        # 404 Not Found errors
        - SNAPSHOT_NOT_FOUND
        - BACKFILL_NOT_FOUND
        - CLUB_NOT_FOUND
        - NO_DATA_AVAILABLE
        # 409 Conflict errors
        - CANNOT_CANCEL_JOB
        # 500 Internal Server errors
        - ANALYTICS_ERROR
        - BACKFILL_ERROR
        - INTERNAL_ERROR
        # 503 Service Unavailable errors
        - SERVICE_UNAVAILABLE
      example: INVALID_DISTRICT_ID

    ErrorDetail:
      type: object
      description: |
        Detailed error information returned by the API.
        Contains machine-readable code, human-readable message,
        and optional additional context.
      required:
        - code
        - message
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        message:
          type: string
          description: Human-readable error message describing what went wrong.
          example: Invalid district ID format
        details:
          type: string
          description: |
            Additional context about the error, such as which field
            failed validation or what value was invalid.
          example: District ID must be alphanumeric
        suggestions:
          type: array
          description: |
            List of suggested actions the client can take to resolve the error.
            May include valid values, format examples, or alternative approaches.
          items:
            type: string
          example:
            - Use a valid district ID like "57" or "F"
            - Check the /districts endpoint for available district IDs

    ErrorResponse:
      type: object
      description: |
        Standard error response format used by all API endpoints.
        All errors are wrapped in an `error` object for consistency.
      required:
        - error
      properties:
        error:
          $ref: '#/components/schemas/ErrorDetail'
      example:
        error:
          code: INVALID_DISTRICT_ID
          message: Invalid district ID format
          details: District ID must be alphanumeric
          suggestions:
            - Use a valid district ID like "57" or "F"
            - Check the /districts endpoint for available district IDs

    # Error Response Examples for Different HTTP Status Codes
    BadRequestErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      description: |
        400 Bad Request error response.
        Returned when the request contains invalid parameters or malformed data.
      example:
        error:
          code: INVALID_DATE_FORMAT
          message: Invalid date format
          details: "Date must be in YYYY-MM-DD format, received: '2026/01/24'"
          suggestions:
            - Use ISO 8601 date format (YYYY-MM-DD)
            - "Example: 2026-01-24"

    NotFoundErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      description: |
        404 Not Found error response.
        Returned when the requested resource does not exist.
      example:
        error:
          code: SNAPSHOT_NOT_FOUND
          message: Snapshot not found
          details: No snapshot exists for date 2026-01-24
          suggestions:
            - Check available dates using the /districts/{districtId}/cached-dates endpoint
            - Use the fallback parameter to get the nearest available snapshot

    ConflictErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      description: |
        409 Conflict error response.
        Returned when the request conflicts with the current state of the resource.
      example:
        error:
          code: CANNOT_CANCEL_JOB
          message: Cannot cancel job
          details: Job is already complete and cannot be cancelled
          suggestions:
            - Only jobs in 'processing' status can be cancelled

    InternalServerErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      description: |
        500 Internal Server Error response.
        Returned when an unexpected error occurs during request processing.
      example:
        error:
          code: INTERNAL_ERROR
          message: An unexpected error occurred
          details: Failed to process request due to internal error
          suggestions:
            - Retry the request after a short delay
            - Contact support if the problem persists

    ServiceUnavailableErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ErrorResponse'
      description: |
        503 Service Unavailable error response.
        Returned when a required service is temporarily unavailable.
      example:
        error:
          code: SERVICE_UNAVAILABLE
          message: Storage service temporarily unavailable
          details: Unable to connect to data storage
          suggestions:
            - Retry the request after a short delay
            - Check service status page for outage information

    # Snapshot Metadata Schema
    SnapshotMetadata:
      type: object
      description: |
        Metadata about the snapshot used to generate the response data.
        Included in API responses as `_snapshot_metadata` to provide information
        about data freshness, source, and any fallback behavior applied.
      properties:
        snapshot_id:
          type: string
          description: |
            Unique identifier for the snapshot, typically an ISO date string (YYYY-MM-DD)
            representing when the data was collected.
          example: "2026-01-24"
        created_at:
          type: string
          format: date-time
          description: |
            Timestamp when the snapshot was created.
          example: "2026-01-24T06:00:00Z"
        status:
          type: string
          description: |
            Status of the snapshot data collection.
            - `success`: All data was collected successfully
            - `partial`: Some data was collected but with gaps or errors
            - `failed`: Data collection failed
          enum:
            - success
            - partial
            - failed
          example: success
        is_closing_period:
          type: boolean
          description: |
            Indicates whether this snapshot represents a closing period
            (month-end or year-end) which may have special significance
            for reporting and analytics.
          example: false
        closing_period_type:
          type: string
          description: |
            Type of closing period, if applicable.
            Only present when `is_closing_period` is true.
          enum:
            - month-end
            - year-end
          example: month-end
        is_fallback:
          type: boolean
          description: |
            Indicates whether the response used fallback logic to return
            data from a different date than originally requested.
          example: false
        fallback_reason:
          type: string
          description: |
            Reason why fallback was applied, if applicable.
            - `no_snapshot_for_date`: No snapshot exists for the requested date
            - `closing_period_gap`: Gap in closing period data
            - `future_date`: Requested date is in the future
          enum:
            - no_snapshot_for_date
            - closing_period_gap
            - future_date
          example: no_snapshot_for_date
        requested_date:
          type: string
          format: date
          description: |
            The date originally requested by the client.
            Useful for understanding fallback behavior when `is_fallback` is true.
          example: "2026-01-25"
        actual_date:
          type: string
          format: date
          description: |
            The actual date of the snapshot data returned.
            May differ from `requested_date` when fallback is applied.
          example: "2026-01-24"
        data_source:
          type: string
          description: |
            Source of the snapshot data, indicating how the data was obtained.
            Common values include 'scraper', 'backfill', or 'manual'.
          example: scraper
        from_cache:
          type: boolean
          description: |
            Indicates whether the response was served from cache
            rather than freshly computed.
          example: true
      example:
        snapshot_id: "2026-01-24"
        created_at: "2026-01-24T06:00:00Z"
        status: success
        is_closing_period: false
        is_fallback: false
        data_source: scraper
        from_cache: true

    # District Schemas
    District:
      type: object
      description: |
        Represents a Toastmasters district with basic identification
        and status information.
      required:
        - id
        - name
        - status
      properties:
        id:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        name:
          type: string
          description: |
            Official name of the district as registered with Toastmasters International.
          example: "District 57"
        status:
          type: string
          description: |
            Current operational status of the district.
            - `active`: District is currently operating
            - `inactive`: District is not currently operating
          enum:
            - active
            - inactive
          example: active
        lastUpdated:
          type: string
          format: date-time
          description: |
            Timestamp of the last data update for this district.
            Indicates when the district information was last refreshed from the source.
          example: "2026-01-24T10:30:00Z"
      example:
        id: "57"
        name: "District 57"
        status: active
        lastUpdated: "2026-01-24T10:30:00Z"

    DistrictsResponse:
      type: object
      description: |
        Response containing a list of districts with snapshot metadata.
        Used by the GET /districts endpoint to return all available districts.
      required:
        - districts
      properties:
        districts:
          type: array
          description: |
            Array of district objects representing all available Toastmasters districts.
          items:
            $ref: '#/components/schemas/District'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        districts:
          - id: "57"
            name: "District 57"
            status: active
            lastUpdated: "2026-01-24T10:30:00Z"
          - id: "F"
            name: "District F"
            status: active
            lastUpdated: "2026-01-24T10:30:00Z"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # District Statistics Schemas
    ClubMembership:
      type: object
      description: |
        Membership information for a single club within a district.
      required:
        - clubId
        - clubName
        - memberCount
      properties:
        clubId:
          type: string
          description: Unique identifier for the club.
          example: "1234567"
        clubName:
          type: string
          description: Official name of the club.
          example: "Downtown Speakers"
        memberCount:
          type: integer
          description: Current number of active members in the club.
          minimum: 0
          example: 25

    MembershipMetrics:
      type: object
      description: |
        Comprehensive membership statistics for a district, including
        totals, changes, and per-club breakdowns.
      required:
        - total
        - change
        - changePercent
        - byClub
      properties:
        total:
          type: integer
          description: Total number of members across all clubs in the district.
          minimum: 0
          example: 2500
        change:
          type: integer
          description: |
            Net change in membership since the beginning of the program year.
            Positive values indicate growth, negative values indicate decline.
          example: 150
        changePercent:
          type: number
          format: float
          description: |
            Percentage change in membership since the beginning of the program year.
          example: 6.38
        new:
          type: integer
          description: Number of new members added during the current period.
          minimum: 0
          example: 200
        renewed:
          type: integer
          description: Number of members who renewed their membership.
          minimum: 0
          example: 1800
        dual:
          type: integer
          description: Number of members with dual club memberships.
          minimum: 0
          example: 45
        byClub:
          type: array
          description: Membership breakdown by individual club.
          items:
            $ref: '#/components/schemas/ClubMembership'
      example:
        total: 2500
        change: 150
        changePercent: 6.38
        new: 200
        renewed: 1800
        dual: 45
        byClub:
          - clubId: "1234567"
            clubName: "Downtown Speakers"
            memberCount: 25
          - clubId: "7654321"
            clubName: "Morning Leaders"
            memberCount: 32

    ClubMetrics:
      type: object
      description: |
        Statistics about clubs within a district, including counts by status
        and distinguished achievement levels.
      required:
        - total
        - active
        - suspended
        - ineligible
        - low
        - distinguished
      properties:
        total:
          type: integer
          description: Total number of clubs in the district.
          minimum: 0
          example: 120
        active:
          type: integer
          description: Number of clubs in good standing with active status.
          minimum: 0
          example: 105
        suspended:
          type: integer
          description: Number of clubs currently suspended.
          minimum: 0
          example: 5
        ineligible:
          type: integer
          description: Number of clubs that are ineligible for recognition.
          minimum: 0
          example: 3
        low:
          type: integer
          description: |
            Number of clubs with low membership (below minimum threshold).
          minimum: 0
          example: 7
        distinguished:
          type: integer
          description: |
            Number of clubs that have achieved Distinguished status or higher.
          minimum: 0
          example: 45
        chartered:
          type: integer
          description: Number of newly chartered clubs in the current program year.
          minimum: 0
          example: 8
      example:
        total: 120
        active: 105
        suspended: 5
        ineligible: 3
        low: 7
        distinguished: 45
        chartered: 8

    AwardTypeCount:
      type: object
      description: |
        Count of educational awards by type (e.g., Pathways levels, legacy awards).
      required:
        - type
        - count
      properties:
        type:
          type: string
          description: |
            Type of educational award (e.g., "Level 1", "Level 2", "DTM", "CC", "CL").
          example: "Level 2"
        count:
          type: integer
          description: Number of awards of this type earned.
          minimum: 0
          example: 45

    ClubAwards:
      type: object
      description: |
        Educational awards summary for a single club.
      required:
        - clubId
        - clubName
        - awards
      properties:
        clubId:
          type: string
          description: Unique identifier for the club.
          example: "1234567"
        clubName:
          type: string
          description: Official name of the club.
          example: "Downtown Speakers"
        awards:
          type: integer
          description: Total number of educational awards earned by club members.
          minimum: 0
          example: 12

    MonthlyAwards:
      type: object
      description: |
        Educational awards earned during a specific month.
      required:
        - month
        - count
      properties:
        month:
          type: string
          description: Month identifier in YYYY-MM format.
          example: "2026-01"
        count:
          type: integer
          description: Number of awards earned during this month.
          minimum: 0
          example: 35

    EducationMetrics:
      type: object
      description: |
        Educational achievement statistics for a district, including
        award counts by type, top-performing clubs, and monthly trends.
      required:
        - totalAwards
        - byType
        - topClubs
      properties:
        totalAwards:
          type: integer
          description: Total number of educational awards earned in the district.
          minimum: 0
          example: 450
        byType:
          type: array
          description: Breakdown of awards by type/level.
          items:
            $ref: '#/components/schemas/AwardTypeCount'
        topClubs:
          type: array
          description: |
            Clubs with the highest number of educational awards.
            Typically limited to top 10 clubs.
          items:
            $ref: '#/components/schemas/ClubAwards'
        byMonth:
          type: array
          description: Monthly breakdown of awards earned.
          items:
            $ref: '#/components/schemas/MonthlyAwards'
      example:
        totalAwards: 450
        byType:
          - type: "Level 1"
            count: 120
          - type: "Level 2"
            count: 85
          - type: "Level 3"
            count: 60
          - type: "DTM"
            count: 5
        topClubs:
          - clubId: "1234567"
            clubName: "Downtown Speakers"
            awards: 25
          - clubId: "7654321"
            clubName: "Morning Leaders"
            awards: 22
        byMonth:
          - month: "2025-07"
            count: 45
          - month: "2025-08"
            count: 52

    DistrictGoals:
      type: object
      description: |
        Target goals for the district's Distinguished District Program (DDP).
      properties:
        clubsGoal:
          type: integer
          description: Target number of paid clubs for the program year.
          minimum: 0
          example: 125
        membershipGoal:
          type: integer
          description: Target total membership for the program year.
          minimum: 0
          example: 2750
        distinguishedGoal:
          type: integer
          description: Target number of Distinguished clubs.
          minimum: 0
          example: 50
      example:
        clubsGoal: 125
        membershipGoal: 2750
        distinguishedGoal: 50

    PerformanceMetrics:
      type: object
      description: |
        Current performance metrics showing progress toward district goals.
      properties:
        membershipNet:
          type: integer
          description: |
            Net membership change (positive or negative) for the program year.
          example: 150
        clubsNet:
          type: integer
          description: |
            Net change in number of clubs (positive or negative) for the program year.
          example: 5
        distinguishedPercent:
          type: number
          format: float
          description: |
            Percentage of clubs that have achieved Distinguished status or higher.
          minimum: 0
          maximum: 100
          example: 37.5
      example:
        membershipNet: 150
        clubsNet: 5
        distinguishedPercent: 37.5

    DistrictRankingData:
      type: object
      description: |
        Comprehensive ranking data for a district, including individual category
        ranks, aggregate scores, and the underlying metrics used for calculations.
      properties:
        clubsRank:
          type: integer
          description: |
            District's rank for club growth (1 = best performing district).
          minimum: 1
          example: 15
        paymentsRank:
          type: integer
          description: |
            District's rank for payment growth (1 = best performing district).
          minimum: 1
          example: 22
        distinguishedRank:
          type: integer
          description: |
            District's rank for distinguished club percentage (1 = best).
          minimum: 1
          example: 8
        aggregateScore:
          type: number
          format: float
          description: |
            Aggregate Borda count score combining all ranking categories.
            Higher scores indicate better overall performance.
          example: 285.5
        clubGrowthPercent:
          type: number
          format: float
          description: Percentage growth in paid clubs.
          example: 5.2
        paymentGrowthPercent:
          type: number
          format: float
          description: Percentage growth in membership payments.
          example: 8.7
        distinguishedPercent:
          type: number
          format: float
          description: Percentage of clubs achieving Distinguished status.
          example: 42.5
        paidClubBase:
          type: integer
          description: Base number of paid clubs at start of program year.
          minimum: 0
          example: 115
        paymentBase:
          type: integer
          description: Base payment count at start of program year.
          minimum: 0
          example: 2350
        paidClubs:
          type: integer
          description: Current number of paid clubs.
          minimum: 0
          example: 121
        totalPayments:
          type: integer
          description: Total membership payments received.
          minimum: 0
          example: 2555
        distinguishedClubs:
          type: integer
          description: Number of Distinguished clubs.
          minimum: 0
          example: 45
        activeClubs:
          type: integer
          description: Number of active clubs.
          minimum: 0
          example: 118
        selectDistinguished:
          type: integer
          description: Number of Select Distinguished clubs.
          minimum: 0
          example: 15
        presidentsDistinguished:
          type: integer
          description: Number of President's Distinguished clubs.
          minimum: 0
          example: 8
        region:
          type: string
          description: Toastmasters region the district belongs to.
          example: "Region 7"
        districtName:
          type: string
          description: Full name of the district.
          example: "District 57"
        rankingVersion:
          type: string
          description: Version of the ranking algorithm used.
          example: "1.0.0"
        calculatedAt:
          type: string
          format: date-time
          description: Timestamp when the ranking was calculated.
          example: "2026-01-24T06:00:00Z"
      example:
        clubsRank: 15
        paymentsRank: 22
        distinguishedRank: 8
        aggregateScore: 285.5
        clubGrowthPercent: 5.2
        paymentGrowthPercent: 8.7
        distinguishedPercent: 42.5
        paidClubBase: 115
        paymentBase: 2350
        paidClubs: 121
        totalPayments: 2555
        distinguishedClubs: 45
        activeClubs: 118
        selectDistinguished: 15
        presidentsDistinguished: 8
        region: "Region 7"
        districtName: "District 57"
        rankingVersion: "1.0.0"
        calculatedAt: "2026-01-24T06:00:00Z"

    DivisionPerformance:
      type: object
      description: |
        Performance data for a division within a district.
        Divisions are organizational units containing multiple areas.
      additionalProperties: true
      properties:
        Division:
          type: string
          description: Division identifier (typically a letter A-Z).
          example: "A"
        'Total Clubs':
          type: string
          description: Total number of clubs in the division.
          example: "15"
        'Total Members':
          type: string
          description: Total membership across all clubs in the division.
          example: "320"
        'Goals Met':
          type: string
          description: Number of DCP goals met by clubs in the division.
          example: "45"
      example:
        Division: "A"
        'Total Clubs': "15"
        'Total Members': "320"
        'Goals Met': "45"

    ClubPerformance:
      type: object
      description: |
        Performance data for a club within a district.
        Contains membership, goals, and status information.
      additionalProperties: true
      properties:
        'Club Number':
          type: string
          description: Unique club identifier.
          example: "1234567"
        'Club Name':
          type: string
          description: Official name of the club.
          example: "Downtown Speakers"
        Division:
          type: string
          description: Division the club belongs to.
          example: "A"
        Area:
          type: string
          description: Area the club belongs to within its division.
          example: "12"
        'Active Members':
          type: string
          description: Number of active members in the club.
          example: "25"
        'Goals Met':
          type: string
          description: Number of DCP goals achieved by the club.
          example: "7"
        'Club Status':
          type: string
          description: Current operational status of the club.
          example: "Active"
        'Club Distinguished Status':
          type: string
          description: Distinguished achievement level if any.
          example: "Select Distinguished"
      example:
        'Club Number': "1234567"
        'Club Name': "Downtown Speakers"
        Division: "A"
        Area: "12"
        'Active Members': "25"
        'Goals Met': "7"
        'Club Status': "Active"
        'Club Distinguished Status': "Select Distinguished"

    DistrictStatistics:
      type: object
      description: |
        Comprehensive statistics for a Toastmasters district, including
        membership data, club metrics, educational achievements, goals,
        performance indicators, and ranking information.

        This is the primary response type for the district statistics endpoint
        and provides a complete view of district performance at a point in time.
      required:
        - districtId
        - asOfDate
        - membership
        - clubs
        - education
      properties:
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        asOfDate:
          type: string
          format: date
          description: |
            Date the statistics represent, in ISO 8601 format (YYYY-MM-DD).
            This indicates when the data was collected from the source.
          example: "2026-01-24"
        membership:
          $ref: '#/components/schemas/MembershipMetrics'
        clubs:
          $ref: '#/components/schemas/ClubMetrics'
        education:
          $ref: '#/components/schemas/EducationMetrics'
        goals:
          $ref: '#/components/schemas/DistrictGoals'
        performance:
          $ref: '#/components/schemas/PerformanceMetrics'
        ranking:
          $ref: '#/components/schemas/DistrictRankingData'
        districtPerformance:
          type: array
          description: |
            Raw district-level performance data from the Toastmasters dashboard.
            Contains scraped CSV records with dynamic fields.
          items:
            type: object
            additionalProperties: true
        divisionPerformance:
          type: array
          description: |
            Raw division-level performance data from the Toastmasters dashboard.
            Contains performance metrics for each division in the district.
          items:
            $ref: '#/components/schemas/DivisionPerformance'
        clubPerformance:
          type: array
          description: |
            Raw club-level performance data from the Toastmasters dashboard.
            Contains detailed performance metrics for each club in the district.
          items:
            $ref: '#/components/schemas/ClubPerformance'
      example:
        districtId: "57"
        asOfDate: "2026-01-24"
        membership:
          total: 2500
          change: 150
          changePercent: 6.38
          new: 200
          renewed: 1800
          dual: 45
          byClub:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              memberCount: 25
        clubs:
          total: 120
          active: 105
          suspended: 5
          ineligible: 3
          low: 7
          distinguished: 45
          chartered: 8
        education:
          totalAwards: 450
          byType:
            - type: "Level 1"
              count: 120
            - type: "Level 2"
              count: 85
          topClubs:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              awards: 25
          byMonth:
            - month: "2025-07"
              count: 45
        goals:
          clubsGoal: 125
          membershipGoal: 2750
          distinguishedGoal: 50
        performance:
          membershipNet: 150
          clubsNet: 5
          distinguishedPercent: 37.5
        ranking:
          clubsRank: 15
          paymentsRank: 22
          distinguishedRank: 8
          aggregateScore: 285.5
          clubGrowthPercent: 5.2
          paymentGrowthPercent: 8.7
          distinguishedPercent: 42.5
          paidClubBase: 115
          paymentBase: 2350
          paidClubs: 121
          totalPayments: 2555
          distinguishedClubs: 45
          activeClubs: 118
          selectDistinguished: 15
          presidentsDistinguished: 8
          region: "Region 7"
          districtName: "District 57"
          rankingVersion: "1.0.0"
          calculatedAt: "2026-01-24T06:00:00Z"
        divisionPerformance:
          - Division: "A"
            'Total Clubs': "15"
            'Total Members': "320"
            'Goals Met': "45"
        clubPerformance:
          - 'Club Number': "1234567"
            'Club Name': "Downtown Speakers"
            Division: "A"
            Area: "12"
            'Active Members': "25"
            'Goals Met': "7"
            'Club Status': "Active"
            'Club Distinguished Status': "Select Distinguished"

    DistrictStatisticsResponse:
      type: object
      description: |
        Response containing district statistics with snapshot metadata.
        Used by the GET /districts/{districtId}/statistics endpoint.
      required:
        - statistics
      properties:
        statistics:
          $ref: '#/components/schemas/DistrictStatistics'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        statistics:
          districtId: "57"
          asOfDate: "2026-01-24"
          membership:
            total: 2500
            change: 150
            changePercent: 6.38
            byClub: []
          clubs:
            total: 120
            active: 105
            suspended: 5
            ineligible: 3
            low: 7
            distinguished: 45
          education:
            totalAwards: 450
            byType: []
            topClubs: []
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Club Schemas
    Club:
      type: object
      description: |
        Detailed information about a Toastmasters club within a district.
        Includes identification, organizational placement, membership data,
        DCP goal progress, and distinguished status.
      required:
        - clubId
        - clubName
        - division
        - area
        - memberCount
        - status
      properties:
        clubId:
          type: string
          description: |
            Unique identifier for the club assigned by Toastmasters International.
            This is a numeric string that uniquely identifies the club globally.
          example: "1234567"
        clubName:
          type: string
          description: |
            Official name of the club as registered with Toastmasters International.
          example: "Downtown Speakers"
        division:
          type: string
          description: |
            Division identifier within the district. Divisions are organizational
            units that contain multiple areas. Typically a single letter (A-Z).
          example: "A"
        area:
          type: string
          description: |
            Area identifier within the division. Areas are the smallest organizational
            unit and typically contain 4-6 clubs. Usually a two-digit number.
          example: "12"
        memberCount:
          type: integer
          description: |
            Total number of members currently registered in the club.
            Includes both active and inactive members.
          minimum: 0
          example: 25
        activeMembers:
          type: integer
          description: |
            Number of active members in the club. Active members are those
            who have paid dues and are in good standing.
          minimum: 0
          example: 22
        membershipBase:
          type: integer
          description: |
            Base membership count at the start of the program year (July 1).
            Used for calculating membership growth.
          minimum: 0
          example: 20
        goalsAchieved:
          type: integer
          description: |
            Number of Distinguished Club Program (DCP) goals achieved by the club.
            Clubs can achieve up to 10 goals per program year.
          minimum: 0
          maximum: 10
          example: 7
        goalsList:
          type: array
          description: |
            List of specific DCP goals achieved by the club.
            Each goal represents a specific achievement in education, membership,
            training, or administration.
          items:
            type: string
            description: Name or identifier of the achieved goal.
          example:
            - "2+ CCs or 2+ ACs or combination"
            - "Add 4 new members"
            - "4 or more officers trained Round 1"
            - "4 or more officers trained Round 2"
            - "Club has 20+ members OR net growth of 5+"
            - "Club has 3+ officers with DTM"
            - "Minimum 8 members by Oct 1"
        status:
          type: string
          description: |
            Current operational status of the club.
            - `active`: Club is in good standing and operating normally
            - `suspended`: Club has been suspended due to non-compliance
            - `ineligible`: Club is ineligible for recognition or awards
            - `low`: Club has low membership (below minimum threshold of 8 members)
          enum:
            - active
            - suspended
            - ineligible
            - low
          example: active
        distinguishedStatus:
          type: string
          description: |
            Distinguished achievement level of the club based on DCP goals achieved.
            - `Distinguished`: 5+ goals achieved
            - `Select Distinguished`: 7+ goals achieved
            - `President's Distinguished`: 9+ goals achieved
            - `null` or absent: Club has not achieved Distinguished status
          enum:
            - Distinguished
            - Select Distinguished
            - President's Distinguished
          nullable: true
          example: "Select Distinguished"
        charterDate:
          type: string
          format: date
          description: |
            Date when the club was chartered (officially established).
            Format: YYYY-MM-DD
          example: "2015-03-15"
        educationalAwards:
          type: integer
          description: |
            Total number of educational awards earned by club members
            during the current program year.
          minimum: 0
          example: 12
      example:
        clubId: "1234567"
        clubName: "Downtown Speakers"
        division: "A"
        area: "12"
        memberCount: 25
        activeMembers: 22
        membershipBase: 20
        goalsAchieved: 7
        goalsList:
          - "2+ CCs or 2+ ACs or combination"
          - "Add 4 new members"
          - "4 or more officers trained Round 1"
          - "4 or more officers trained Round 2"
          - "Club has 20+ members OR net growth of 5+"
          - "Club has 3+ officers with DTM"
          - "Minimum 8 members by Oct 1"
        status: active
        distinguishedStatus: "Select Distinguished"
        charterDate: "2015-03-15"
        educationalAwards: 12

    ClubsResponse:
      type: object
      description: |
        Response containing a list of clubs within a district with snapshot metadata.
        Used by the GET /districts/{districtId}/clubs endpoint to return all clubs
        in the specified district.
      required:
        - clubs
      properties:
        clubs:
          type: array
          description: |
            Array of club objects representing all clubs within the district.
            Clubs are sorted by division and area by default.
          items:
            $ref: '#/components/schemas/Club'
        totalClubs:
          type: integer
          description: |
            Total number of clubs in the response.
            Useful for pagination and summary displays.
          minimum: 0
          example: 120
        summary:
          type: object
          description: |
            Summary statistics for clubs in the district.
          properties:
            activeClubs:
              type: integer
              description: Number of clubs with active status.
              minimum: 0
              example: 105
            suspendedClubs:
              type: integer
              description: Number of clubs with suspended status.
              minimum: 0
              example: 5
            lowMembershipClubs:
              type: integer
              description: Number of clubs with low membership.
              minimum: 0
              example: 7
            distinguishedClubs:
              type: integer
              description: Number of clubs that achieved Distinguished status or higher.
              minimum: 0
              example: 45
            selectDistinguishedClubs:
              type: integer
              description: Number of clubs that achieved Select Distinguished status.
              minimum: 0
              example: 15
            presidentsDistinguishedClubs:
              type: integer
              description: Number of clubs that achieved President's Distinguished status.
              minimum: 0
              example: 8
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        clubs:
          - clubId: "1234567"
            clubName: "Downtown Speakers"
            division: "A"
            area: "12"
            memberCount: 25
            activeMembers: 22
            membershipBase: 20
            goalsAchieved: 7
            goalsList:
              - "2+ CCs or 2+ ACs or combination"
              - "Add 4 new members"
            status: active
            distinguishedStatus: "Select Distinguished"
            charterDate: "2015-03-15"
            educationalAwards: 12
          - clubId: "7654321"
            clubName: "Morning Leaders"
            division: "A"
            area: "12"
            memberCount: 32
            activeMembers: 30
            membershipBase: 28
            goalsAchieved: 9
            goalsList:
              - "2+ CCs or 2+ ACs or combination"
              - "Add 4 new members"
              - "4 or more officers trained Round 1"
            status: active
            distinguishedStatus: "President's Distinguished"
            charterDate: "2010-09-01"
            educationalAwards: 18
          - clubId: "9876543"
            clubName: "Evening Orators"
            division: "B"
            area: "21"
            memberCount: 8
            activeMembers: 7
            membershipBase: 12
            goalsAchieved: 2
            goalsList:
              - "Minimum 8 members by Oct 1"
            status: low
            charterDate: "2018-06-20"
            educationalAwards: 3
        totalClubs: 120
        summary:
          activeClubs: 105
          suspendedClubs: 5
          lowMembershipClubs: 7
          distinguishedClubs: 45
          selectDistinguishedClubs: 15
          presidentsDistinguishedClubs: 8
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Membership History Response Schema
    MembershipHistoryResponse:
      type: object
      description: |
        Response containing historical membership data for a district with snapshot metadata.
        Used by the GET /districts/{districtId}/membership-history endpoint to return
        time series membership data for trend analysis.
      required:
        - membershipHistory
        - districtId
      properties:
        membershipHistory:
          type: array
          description: |
            Array of membership data points ordered by date (most recent first).
            Each point represents the membership count at a specific point in time.
          items:
            $ref: '#/components/schemas/MembershipTrendPoint'
        districtId:
          type: string
          description: |
            Unique district identifier for which the history was retrieved.
          example: "57"
        districtName:
          type: string
          description: |
            Official name of the district.
          example: "District 57"
        months:
          type: integer
          description: |
            Number of months of history included in the response.
          minimum: 1
          maximum: 24
          example: 6
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        membershipHistory:
          - date: "2026-01-24"
            value: 2500
            change: 15
            changePercent: 0.6
          - date: "2026-01-17"
            value: 2485
            change: 20
            changePercent: 0.81
          - date: "2026-01-10"
            value: 2465
            change: -5
            changePercent: -0.2
          - date: "2026-01-03"
            value: 2470
            change: 10
            changePercent: 0.41
        districtId: "57"
        districtName: "District 57"
        months: 6
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Educational Awards Response Schema
    EducationalAwardsResponse:
      type: object
      description: |
        Response containing educational awards data for a district with snapshot metadata.
        Used by the GET /districts/{districtId}/educational-awards endpoint to return
        comprehensive educational achievement statistics for trend analysis.
      required:
        - educationalAwards
        - districtId
      properties:
        educationalAwards:
          $ref: '#/components/schemas/EducationMetrics'
        districtId:
          type: string
          description: |
            Unique district identifier for which the awards data was retrieved.
          example: "57"
        districtName:
          type: string
          description: |
            Official name of the district.
          example: "District 57"
        months:
          type: integer
          description: |
            Number of months of data included in the response.
          minimum: 1
          maximum: 24
          example: 6
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        educationalAwards:
          totalAwards: 450
          byType:
            - type: "Level 1"
              count: 120
            - type: "Level 2"
              count: 85
            - type: "Level 3"
              count: 60
            - type: "Level 4"
              count: 35
            - type: "Level 5"
              count: 25
            - type: "DTM"
              count: 5
          topClubs:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              awards: 25
            - clubId: "7654321"
              clubName: "Morning Leaders"
              awards: 22
          byMonth:
            - month: "2026-01"
              count: 52
            - month: "2025-12"
              count: 48
            - month: "2025-11"
              count: 45
        districtId: "57"
        districtName: "District 57"
        months: 6
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Daily Reports Response Schema
    DailyReportsResponse:
      type: object
      description: |
        Response containing daily activity reports for a district within a date range.
        Used by the GET /districts/{districtId}/daily-reports endpoint to return
        daily summaries of membership activity, club changes, and awards.
      required:
        - reports
        - districtId
      properties:
        reports:
          type: array
          description: |
            Array of daily report summaries ordered by date (most recent first).
            Each report represents a single day's activity within the district.
          items:
            $ref: '#/components/schemas/DailyReportSummary'
        districtId:
          type: string
          description: |
            Unique district identifier for which the reports were retrieved.
          example: "57"
        districtName:
          type: string
          description: |
            Official name of the district.
          example: "District 57"
        dateRange:
          type: object
          description: |
            The date range for which reports were requested.
          properties:
            startDate:
              type: string
              format: date
              description: Start date of the requested range.
              example: "2025-07-01"
            endDate:
              type: string
              format: date
              description: End date of the requested range.
              example: "2026-01-24"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        reports:
          - date: "2026-01-24"
            newMembers: 5
            renewals: 12
            clubChanges:
              - clubId: "1234567"
                change: "New club chartered"
            awards: 8
          - date: "2026-01-23"
            newMembers: 3
            renewals: 8
            clubChanges: []
            awards: 5
          - date: "2026-01-22"
            newMembers: 7
            renewals: 15
            clubChanges:
              - clubId: "7654321"
                change: "Club suspended"
            awards: 12
        districtId: "57"
        districtName: "District 57"
        dateRange:
          startDate: "2025-07-01"
          endDate: "2026-01-24"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Daily Report Summary Schema
    DailyReportSummary:
      type: object
      description: |
        Summary of daily activity for a single day within a district.
        Contains counts of new members, renewals, club changes, and awards.
      required:
        - date
        - newMembers
        - renewals
        - awards
      properties:
        date:
          type: string
          format: date
          description: |
            The date for this daily report in ISO 8601 format (YYYY-MM-DD).
          example: "2026-01-24"
        newMembers:
          type: integer
          description: |
            Number of new members who joined clubs in the district on this date.
          minimum: 0
          example: 5
        renewals:
          type: integer
          description: |
            Number of membership renewals processed on this date.
          minimum: 0
          example: 12
        clubChanges:
          type: array
          description: |
            List of club status changes that occurred on this date.
            Includes chartering, suspension, and other status changes.
          items:
            type: object
            properties:
              clubId:
                type: string
                description: Unique identifier of the club.
                example: "1234567"
              change:
                type: string
                description: Description of the change that occurred.
                example: "New club chartered"
        awards:
          type: integer
          description: |
            Number of educational awards earned by district members on this date.
          minimum: 0
          example: 8
      example:
        date: "2026-01-24"
        newMembers: 5
        renewals: 12
        clubChanges:
          - clubId: "1234567"
            change: "New club chartered"
        awards: 8

    # District Ranking Schemas (for Rankings Endpoint)
    DistrictRanking:
      type: object
      description: |
        Ranking information for a single district in the global rankings list.
        This schema is used in the rankings endpoint response to show how each
        district compares to others across multiple performance categories.

        Note: This differs from DistrictRankingData which contains more detailed
        metrics for a single district's statistics response.
      required:
        - districtId
        - districtName
        - aggregateScore
        - overallRank
      properties:
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        districtName:
          type: string
          description: |
            Official name of the district as registered with Toastmasters International.
          example: "District 57"
        aggregateScore:
          type: number
          format: float
          description: |
            Aggregate Borda count score combining all ranking categories.
            Higher scores indicate better overall performance across all metrics.
            This score is used to determine the overall rank.
          example: 285.5
        clubsRank:
          type: integer
          description: |
            District's rank for club growth compared to all other districts.
            Rank 1 indicates the best performing district in this category.
          minimum: 1
          example: 15
        paymentsRank:
          type: integer
          description: |
            District's rank for membership payment growth compared to all other districts.
            Rank 1 indicates the best performing district in this category.
          minimum: 1
          example: 22
        distinguishedRank:
          type: integer
          description: |
            District's rank for distinguished club percentage compared to all other districts.
            Rank 1 indicates the highest percentage of distinguished clubs.
          minimum: 1
          example: 8
        overallRank:
          type: integer
          description: |
            District's overall rank based on the aggregate score.
            Rank 1 indicates the best overall performing district.
          minimum: 1
          example: 12
        region:
          type: string
          description: |
            Toastmasters region the district belongs to.
            Regions are geographic groupings of districts.
          example: "Region 7"
      example:
        districtId: "57"
        districtName: "District 57"
        aggregateScore: 285.5
        clubsRank: 15
        paymentsRank: 22
        distinguishedRank: 8
        overallRank: 12
        region: "Region 7"

    RankingsResponse:
      type: object
      description: |
        Response containing global district rankings with snapshot metadata.
        Used by the GET /districts/rankings endpoint to return comparative
        rankings for all districts.

        Rankings are calculated using a Borda count methodology that combines
        performance across multiple categories (club growth, payment growth,
        and distinguished club percentage) into an aggregate score.
      required:
        - rankings
        - totalDistricts
      properties:
        rankings:
          type: array
          description: |
            Array of district ranking objects sorted by overall rank (best first).
            Each entry contains the district's performance metrics and ranks
            across all categories.
          items:
            $ref: '#/components/schemas/DistrictRanking'
        totalDistricts:
          type: integer
          description: |
            Total number of districts included in the rankings.
            This represents all active districts with sufficient data for ranking.
          minimum: 0
          example: 120
        asOfDate:
          type: string
          format: date
          description: |
            Date the rankings represent, in ISO 8601 format (YYYY-MM-DD).
            Rankings are calculated based on snapshot data from this date.
          example: "2026-01-24"
        programYear:
          type: string
          description: |
            Toastmasters program year for the rankings (July 1 - June 30).
            Format: "YYYY-YYYY" (e.g., "2025-2026").
          example: "2025-2026"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        rankings:
          - districtId: "101"
            districtName: "District 101"
            aggregateScore: 342.0
            clubsRank: 1
            paymentsRank: 3
            distinguishedRank: 2
            overallRank: 1
            region: "Region 10"
          - districtId: "57"
            districtName: "District 57"
            aggregateScore: 285.5
            clubsRank: 15
            paymentsRank: 22
            distinguishedRank: 8
            overallRank: 12
            region: "Region 7"
          - districtId: "F"
            districtName: "District F"
            aggregateScore: 198.0
            clubsRank: 45
            paymentsRank: 38
            distinguishedRank: 52
            overallRank: 48
            region: "Region 2"
        totalDistricts: 120
        asOfDate: "2026-01-24"
        programYear: "2025-2026"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    RankHistoryResponse:
      type: object
      description: |
        Response containing historical ranking data for a specific district.
        Used by the GET /districts/{districtId}/rank-history endpoint to return
        a time series of ranking data points showing how the district's rankings
        have changed over time.
      required:
        - history
        - districtId
        - districtName
      properties:
        history:
          type: array
          description: |
            Array of rank history data points sorted by date (most recent first).
            Each entry contains the district's ranking metrics for a specific date.
          items:
            $ref: '#/components/schemas/RankHistoryDataPoint'
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        districtName:
          type: string
          description: |
            Official name of the district as registered with Toastmasters International.
          example: "District 57"
        programYear:
          type: string
          description: |
            Toastmasters program year for the rank history (July 1 - June 30).
            Format: "YYYY-YYYY" (e.g., "2025-2026").
          example: "2025-2026"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        history:
          - date: "2026-01-24"
            overallRank: 12
            clubsRank: 15
            paymentsRank: 22
            distinguishedRank: 8
            aggregateScore: 285.5
          - date: "2026-01-17"
            overallRank: 14
            clubsRank: 16
            paymentsRank: 24
            distinguishedRank: 9
            aggregateScore: 278.0
          - date: "2026-01-10"
            overallRank: 15
            clubsRank: 18
            paymentsRank: 23
            distinguishedRank: 10
            aggregateScore: 272.5
        districtId: "57"
        districtName: "District 57"
        programYear: "2025-2026"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    RankHistoryDataPoint:
      type: object
      description: |
        A single data point in the rank history time series.
        Contains the district's ranking metrics for a specific date.
      required:
        - date
        - overallRank
        - aggregateScore
      properties:
        date:
          type: string
          format: date
          description: |
            Date of the ranking data point in ISO 8601 format (YYYY-MM-DD).
          example: "2026-01-24"
        overallRank:
          type: integer
          description: |
            District's overall rank based on the aggregate score on this date.
            Rank 1 indicates the best overall performing district.
          minimum: 1
          example: 12
        clubsRank:
          type: integer
          description: |
            District's rank for club growth compared to all other districts on this date.
            Rank 1 indicates the best performing district in this category.
          minimum: 1
          example: 15
        paymentsRank:
          type: integer
          description: |
            District's rank for membership payment growth compared to all other districts on this date.
            Rank 1 indicates the best performing district in this category.
          minimum: 1
          example: 22
        distinguishedRank:
          type: integer
          description: |
            District's rank for distinguished club percentage compared to all other districts on this date.
            Rank 1 indicates the highest percentage of distinguished clubs.
          minimum: 1
          example: 8
        aggregateScore:
          type: number
          format: float
          description: |
            Aggregate Borda count score combining all ranking categories on this date.
            Higher scores indicate better overall performance across all metrics.
          example: 285.5
      example:
        date: "2026-01-24"
        overallRank: 12
        clubsRank: 15
        paymentsRank: 22
        distinguishedRank: 8
        aggregateScore: 285.5

    AvailableRankingYearsResponse:
      type: object
      description: |
        Response containing the list of Toastmasters program years for which
        ranking data is available for a specific district.
        Used by the GET /districts/{districtId}/available-ranking-years endpoint
        to return available years for historical ranking queries.
      required:
        - programYears
        - districtId
      properties:
        programYears:
          type: array
          description: |
            Array of program years for which ranking data is available,
            sorted in descending order (most recent first).
            Each program year follows the Toastmasters fiscal year format
            (July 1 - June 30), represented as "YYYY-YYYY".
          items:
            type: string
            description: |
              Program year in "YYYY-YYYY" format representing the Toastmasters
              fiscal year (July 1 - June 30).
            pattern: '^\d{4}-\d{4}$'
            example: "2025-2026"
          example:
            - "2025-2026"
            - "2024-2025"
            - "2023-2024"
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        programYears:
          - "2025-2026"
          - "2024-2025"
          - "2023-2024"
        districtId: "57"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    CachedDatesResponse:
      type: object
      description: |
        Response containing the list of dates for which cached snapshot data
        is available for a specific district.
        Used by the GET /districts/{districtId}/cached-dates endpoint
        to return available dates for data queries.
      required:
        - dates
        - dateRange
        - districtId
      properties:
        dates:
          type: array
          description: |
            Array of ISO date strings (YYYY-MM-DD) representing dates for which
            cached snapshot data is available. Sorted in descending order
            (most recent first).
          items:
            type: string
            format: date
            description: |
              Date in ISO format (YYYY-MM-DD) for which a cached snapshot exists.
            example: "2026-01-24"
          example:
            - "2026-01-24"
            - "2026-01-23"
            - "2026-01-22"
        dateRange:
          type: object
          description: |
            Object containing the earliest and latest dates for which
            cached data is available.
          required:
            - startDate
            - endDate
          properties:
            startDate:
              type: string
              format: date
              description: |
                The earliest date for which cached snapshot data is available.
              example: "2025-07-01"
            endDate:
              type: string
              format: date
              description: |
                The latest (most recent) date for which cached snapshot data is available.
              example: "2026-01-24"
          example:
            startDate: "2025-07-01"
            endDate: "2026-01-24"
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        dates:
          - "2026-01-24"
          - "2026-01-23"
          - "2026-01-22"
          - "2026-01-21"
          - "2026-01-20"
        dateRange:
          startDate: "2025-07-01"
          endDate: "2026-01-24"
        districtId: "57"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    GlobalCachedDatesResponse:
      type: object
      description: |
        Response containing the list of dates for which cached snapshot data
        is available across all districts in the system.
        Used by the GET /districts/cache/dates endpoint
        to return globally available dates for data queries.
      required:
        - dates
      properties:
        dates:
          type: array
          description: |
            Array of ISO date strings (YYYY-MM-DD) representing dates for which
            cached snapshot data is available across all districts. Sorted in
            descending order (most recent first).
          items:
            type: string
            format: date
            description: |
              Date in ISO format (YYYY-MM-DD) for which a cached snapshot exists.
            example: "2026-01-24"
          example:
            - "2026-01-24"
            - "2026-01-23"
            - "2026-01-22"
        dateRange:
          type: object
          description: |
            Object containing the earliest and latest dates for which
            cached data is available. This field is optional and may be
            absent if no dates are available.
          properties:
            startDate:
              type: string
              format: date
              description: |
                The earliest date for which cached snapshot data is available.
              example: "2025-07-01"
            endDate:
              type: string
              format: date
              description: |
                The latest (most recent) date for which cached snapshot data is available.
              example: "2026-01-24"
          example:
            startDate: "2025-07-01"
            endDate: "2026-01-24"
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        dates:
          - "2026-01-24"
          - "2026-01-23"
          - "2026-01-22"
          - "2026-01-21"
          - "2026-01-20"
        dateRange:
          startDate: "2025-07-01"
          endDate: "2026-01-24"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Backfill Schemas
    BackfillRequest:
      type: object
      description: |
        Request body for initiating a backfill operation to collect historical
        district data. Backfill operations retrieve and store snapshot data for
        specified date ranges and districts.

        The operation runs asynchronously and returns a backfill job ID that can
        be used to monitor progress via the backfill status endpoint.
      required:
        - startDate
        - endDate
      properties:
        targetDistricts:
          type: array
          description: |
            List of district IDs to include in the backfill operation.
            If not provided or empty, all available districts will be targeted.
            District IDs can be numeric (e.g., "57") or alphabetic (e.g., "F").
          items:
            type: string
            description: District identifier.
          example:
            - "57"
            - "F"
            - "101"
        startDate:
          type: string
          format: date
          description: |
            Start date for the backfill date range in ISO 8601 format (YYYY-MM-DD).
            The backfill will collect data starting from this date (inclusive).
            Must be before or equal to endDate.
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          description: |
            End date for the backfill date range in ISO 8601 format (YYYY-MM-DD).
            The backfill will collect data up to and including this date.
            Must be after or equal to startDate.
          example: "2025-12-31"
        collectionType:
          type: string
          description: |
            Strategy for collecting data across districts.
            - `per-district`: Collect all dates for one district before moving to the next.
              Better for focused district analysis and reduces memory usage.
            - `all-districts`: Collect data for all districts for each date before moving
              to the next date. Better for cross-district comparisons on specific dates.
          enum:
            - per-district
            - all-districts
          default: per-district
          example: per-district
        concurrency:
          type: integer
          description: |
            Maximum number of concurrent data collection operations.
            Higher values speed up collection but increase load on source systems.
            Recommended range is 1-5 for most use cases.
          minimum: 1
          maximum: 10
          default: 3
          example: 3
      example:
        targetDistricts:
          - "57"
          - "F"
        startDate: "2025-07-01"
        endDate: "2025-12-31"
        collectionType: per-district
        concurrency: 3

    BackfillStatus:
      type: object
      description: |
        Status information for a backfill operation, including progress tracking,
        scope details, and collection strategy. Returned by backfill status endpoints
        to monitor the progress of asynchronous data collection jobs.
      required:
        - backfillId
        - status
        - progress
        - scope
        - collectionStrategy
        - createdAt
        - updatedAt
      properties:
        backfillId:
          type: string
          description: |
            Unique identifier for the backfill job. Used to query status,
            monitor progress, and cancel the operation if needed.
          example: "bf-2026-01-24-abc123"
        status:
          type: string
          description: |
            Current status of the backfill operation.
            - `processing`: Job is actively collecting data
            - `complete`: Job finished successfully
            - `error`: Job encountered an unrecoverable error
            - `cancelled`: Job was cancelled by user request
          enum:
            - processing
            - complete
            - error
            - cancelled
          example: processing
        progress:
          type: object
          description: |
            Progress tracking information showing how much of the backfill
            operation has been completed.
          required:
            - total
            - completed
            - failed
            - percentage
          properties:
            total:
              type: integer
              description: |
                Total number of data collection tasks in this backfill job.
                Calculated as (number of districts)  (number of dates in range).
              minimum: 0
              example: 180
            completed:
              type: integer
              description: |
                Number of tasks that have completed successfully.
              minimum: 0
              example: 45
            failed:
              type: integer
              description: |
                Number of tasks that failed during collection.
                Failed tasks may be retried depending on the error type.
              minimum: 0
              example: 2
            percentage:
              type: number
              format: float
              description: |
                Percentage of total tasks completed (including failed).
                Calculated as ((completed + failed) / total)  100.
              minimum: 0
              maximum: 100
              example: 26.1
          example:
            total: 180
            completed: 45
            failed: 2
            percentage: 26.1
        scope:
          type: object
          description: |
            Defines the scope of the backfill operation, including which
            districts and date range are being processed.
          required:
            - scopeType
          properties:
            scopeType:
              type: string
              description: |
                Type of scope for the backfill operation.
                - `all-districts`: Backfill targets all available districts
                - `specific-districts`: Backfill targets only specified districts
                - `single-district`: Backfill targets a single district
              enum:
                - all-districts
                - specific-districts
                - single-district
              example: specific-districts
            targetDistricts:
              type: array
              description: |
                List of district IDs included in this backfill operation.
                Empty or null for all-districts scope type.
              items:
                type: string
              example:
                - "57"
                - "F"
                - "101"
            startDate:
              type: string
              format: date
              description: |
                Start date of the backfill date range (inclusive).
              example: "2025-07-01"
            endDate:
              type: string
              format: date
              description: |
                End date of the backfill date range (inclusive).
              example: "2025-12-31"
          example:
            scopeType: specific-districts
            targetDistricts:
              - "57"
              - "F"
            startDate: "2025-07-01"
            endDate: "2025-12-31"
        collectionStrategy:
          type: object
          description: |
            Configuration for how data is collected during the backfill operation.
          required:
            - type
            - concurrency
          properties:
            type:
              type: string
              description: |
                Strategy for collecting data across districts and dates.
                - `per-district`: Collect all dates for one district before moving to the next
                - `all-districts`: Collect data for all districts for each date
              enum:
                - per-district
                - all-districts
              example: per-district
            concurrency:
              type: integer
              description: |
                Maximum number of concurrent data collection operations.
              minimum: 1
              maximum: 10
              example: 3
          example:
            type: per-district
            concurrency: 3
        createdAt:
          type: string
          format: date-time
          description: |
            Timestamp when the backfill job was created.
          example: "2026-01-24T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: |
            Timestamp when the backfill job status was last updated.
          example: "2026-01-24T10:35:00Z"
        completedAt:
          type: string
          format: date-time
          description: |
            Timestamp when the backfill job completed (successfully, with error, or cancelled).
            Only present when status is not `processing`.
          example: "2026-01-24T12:45:00Z"
        errorMessage:
          type: string
          description: |
            Error message if the backfill job failed.
            Only present when status is `error`.
          example: "Failed to connect to data source after multiple retries"
      example:
        backfillId: "bf-2026-01-24-abc123"
        status: processing
        progress:
          total: 180
          completed: 45
          failed: 2
          percentage: 26.1
        scope:
          scopeType: specific-districts
          targetDistricts:
            - "57"
            - "F"
          startDate: "2025-07-01"
          endDate: "2025-12-31"
        collectionStrategy:
          type: per-district
          concurrency: 3
        createdAt: "2026-01-24T10:30:00Z"
        updatedAt: "2026-01-24T10:35:00Z"

    # Analytics Schemas
    ClubSummary:
      type: object
      description: |
        Summary information about a club used in analytics responses.
        Provides essential identification and status information for
        categorizing clubs in analytics views.
      required:
        - clubId
        - clubName
        - memberCount
      properties:
        clubId:
          type: string
          description: |
            Unique identifier for the club assigned by Toastmasters International.
          example: "1234567"
        clubName:
          type: string
          description: |
            Official name of the club as registered with Toastmasters International.
          example: "Downtown Speakers"
        division:
          type: string
          description: |
            Division identifier within the district (typically a single letter A-Z).
          example: "A"
        area:
          type: string
          description: |
            Area identifier within the division (typically a two-digit number).
          example: "12"
        memberCount:
          type: integer
          description: |
            Current number of members in the club.
          minimum: 0
          example: 25
        goalsAchieved:
          type: integer
          description: |
            Number of Distinguished Club Program (DCP) goals achieved.
          minimum: 0
          maximum: 10
          example: 7
        status:
          type: string
          description: |
            Current operational status of the club.
          enum:
            - active
            - suspended
            - ineligible
            - low
          example: active
        distinguishedStatus:
          type: string
          description: |
            Distinguished achievement level of the club, if any.
          enum:
            - Distinguished
            - Select Distinguished
            - President's Distinguished
          nullable: true
          example: "Select Distinguished"
      example:
        clubId: "1234567"
        clubName: "Downtown Speakers"
        division: "A"
        area: "12"
        memberCount: 25
        goalsAchieved: 7
        status: active
        distinguishedStatus: "Select Distinguished"

    DistinguishedClubCounts:
      type: object
      description: |
        Counts of clubs at each Distinguished achievement level.
        Used to summarize the distribution of distinguished clubs
        within a district.
      required:
        - total
        - distinguished
        - selectDistinguished
        - presidentsDistinguished
      properties:
        total:
          type: integer
          description: |
            Total number of clubs that have achieved any Distinguished level.
            This is the sum of distinguished, selectDistinguished, and presidentsDistinguished.
          minimum: 0
          example: 45
        distinguished:
          type: integer
          description: |
            Number of clubs that achieved Distinguished status (5+ DCP goals).
          minimum: 0
          example: 22
        selectDistinguished:
          type: integer
          description: |
            Number of clubs that achieved Select Distinguished status (7+ DCP goals).
          minimum: 0
          example: 15
        presidentsDistinguished:
          type: integer
          description: |
            Number of clubs that achieved President's Distinguished status (9+ DCP goals).
          minimum: 0
          example: 8
        percentageOfTotal:
          type: number
          format: float
          description: |
            Percentage of all clubs in the district that have achieved
            any Distinguished level.
          minimum: 0
          maximum: 100
          example: 37.5
      example:
        total: 45
        distinguished: 22
        selectDistinguished: 15
        presidentsDistinguished: 8
        percentageOfTotal: 37.5

    MembershipTrendPoint:
      type: object
      description: |
        A single data point in a membership trend series.
        Represents the membership count at a specific point in time.
      required:
        - date
        - value
      properties:
        date:
          type: string
          format: date
          description: |
            Date of the data point in ISO 8601 format (YYYY-MM-DD).
          example: "2026-01-24"
        value:
          type: integer
          description: |
            Membership count on this date.
          minimum: 0
          example: 2500
        change:
          type: integer
          description: |
            Change in membership from the previous data point.
            Positive values indicate growth, negative values indicate decline.
          example: 15
        changePercent:
          type: number
          format: float
          description: |
            Percentage change from the previous data point.
          example: 0.6
      example:
        date: "2026-01-24"
        value: 2500
        change: 15
        changePercent: 0.6

    DateRange:
      type: object
      description: |
        Represents a date range used for analytics queries and responses.
        Defines the time period over which analytics data was calculated.
      required:
        - startDate
        - endDate
      properties:
        startDate:
          type: string
          format: date
          description: |
            Start date of the range in ISO 8601 format (YYYY-MM-DD).
            Data is included from this date (inclusive).
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          description: |
            End date of the range in ISO 8601 format (YYYY-MM-DD).
            Data is included up to and including this date.
          example: "2026-01-24"
        daysInRange:
          type: integer
          description: |
            Total number of days in the date range.
          minimum: 1
          example: 208
      example:
        startDate: "2025-07-01"
        endDate: "2026-01-24"
        daysInRange: 208

    DistrictAnalytics:
      type: object
      description: |
        Comprehensive analytics data for a Toastmasters district.
        Provides insights into membership trends, club health categorization,
        distinguished club achievements, and overall district performance
        over a specified date range.

        This schema is used by the GET /districts/{districtId}/analytics endpoint
        to return aggregated analytics and insights for district leadership.
      required:
        - districtId
        - totalMembership
        - membershipChange
        - membershipChangePercent
        - thrivingClubs
        - vulnerableClubs
        - interventionRequiredClubs
        - distinguishedClubs
        - membershipTrend
        - dateRange
      properties:
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        totalMembership:
          type: integer
          description: |
            Total number of members across all clubs in the district
            as of the end date of the analytics period.
          minimum: 0
          example: 2500
        membershipChange:
          type: integer
          description: |
            Net change in membership over the analytics date range.
            Positive values indicate growth, negative values indicate decline.
            Calculated as (end membership - start membership).
          example: 150
        membershipChangePercent:
          type: number
          format: float
          description: |
            Percentage change in membership over the analytics date range.
            Calculated as ((end - start) / start)  100.
          example: 6.38
        totalClubs:
          type: integer
          description: |
            Total number of clubs in the district.
          minimum: 0
          example: 120
        activeClubs:
          type: integer
          description: |
            Number of clubs with active status.
          minimum: 0
          example: 105
        thrivingClubs:
          type: array
          description: |
            List of clubs that are performing well and thriving.
            Thriving clubs typically have strong membership growth,
            high goal achievement, and active engagement.
            Criteria may include: 20+ members, 5+ DCP goals, positive growth.
          items:
            $ref: '#/components/schemas/ClubSummary'
        vulnerableClubs:
          type: array
          description: |
            List of clubs that are at risk and may need attention.
            Vulnerable clubs show warning signs such as declining membership,
            low goal achievement, or approaching minimum thresholds.
            Criteria may include: 8-12 members, declining trend, few goals achieved.
          items:
            $ref: '#/components/schemas/ClubSummary'
        interventionRequiredClubs:
          type: array
          description: |
            List of clubs that require immediate intervention.
            These clubs are in critical condition with very low membership,
            suspended status, or other serious issues requiring urgent action.
            Criteria may include: <8 members, suspended status, no goals achieved.
          items:
            $ref: '#/components/schemas/ClubSummary'
        distinguishedClubs:
          $ref: '#/components/schemas/DistinguishedClubCounts'
        membershipTrend:
          type: array
          description: |
            Time series data showing membership changes over the analytics period.
            Data points are typically daily or weekly depending on the date range.
            Useful for visualizing membership growth or decline patterns.
          items:
            $ref: '#/components/schemas/MembershipTrendPoint'
        dateRange:
          $ref: '#/components/schemas/DateRange'
        programYear:
          type: string
          description: |
            Toastmasters program year for the analytics (July 1 - June 30).
            Format: "YYYY-YYYY" (e.g., "2025-2026").
          example: "2025-2026"
        calculatedAt:
          type: string
          format: date-time
          description: |
            Timestamp when the analytics were calculated.
          example: "2026-01-24T10:30:00Z"
      example:
        districtId: "57"
        totalMembership: 2500
        membershipChange: 150
        membershipChangePercent: 6.38
        totalClubs: 120
        activeClubs: 105
        thrivingClubs:
          - clubId: "1234567"
            clubName: "Downtown Speakers"
            division: "A"
            area: "12"
            memberCount: 32
            goalsAchieved: 8
            status: active
            distinguishedStatus: "Select Distinguished"
          - clubId: "7654321"
            clubName: "Morning Leaders"
            division: "A"
            area: "13"
            memberCount: 28
            goalsAchieved: 9
            status: active
            distinguishedStatus: "President's Distinguished"
        vulnerableClubs:
          - clubId: "2345678"
            clubName: "Sunset Speakers"
            division: "B"
            area: "21"
            memberCount: 10
            goalsAchieved: 2
            status: active
          - clubId: "3456789"
            clubName: "Midtown Toasters"
            division: "C"
            area: "31"
            memberCount: 11
            goalsAchieved: 3
            status: active
        interventionRequiredClubs:
          - clubId: "4567890"
            clubName: "Evening Orators"
            division: "D"
            area: "41"
            memberCount: 6
            goalsAchieved: 0
            status: low
        distinguishedClubs:
          total: 45
          distinguished: 22
          selectDistinguished: 15
          presidentsDistinguished: 8
          percentageOfTotal: 37.5
        membershipTrend:
          - date: "2025-07-01"
            value: 2350
            change: 0
            changePercent: 0
          - date: "2025-10-01"
            value: 2420
            change: 70
            changePercent: 2.98
          - date: "2026-01-01"
            value: 2485
            change: 65
            changePercent: 2.69
          - date: "2026-01-24"
            value: 2500
            change: 15
            changePercent: 0.6
        dateRange:
          startDate: "2025-07-01"
          endDate: "2026-01-24"
          daysInRange: 208
        programYear: "2025-2026"
        calculatedAt: "2026-01-24T10:30:00Z"

    DistrictAnalyticsResponse:
      type: object
      description: |
        Response containing district analytics with snapshot metadata.
        Used by the GET /districts/{districtId}/analytics endpoint to return
        comprehensive analytics data for a district.
      required:
        - analytics
      properties:
        analytics:
          $ref: '#/components/schemas/DistrictAnalytics'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        analytics:
          districtId: "57"
          totalMembership: 2500
          membershipChange: 150
          membershipChangePercent: 6.38
          totalClubs: 120
          activeClubs: 105
          thrivingClubs:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              division: "A"
              area: "12"
              memberCount: 32
              goalsAchieved: 8
              status: active
              distinguishedStatus: "Select Distinguished"
          vulnerableClubs:
            - clubId: "2345678"
              clubName: "Sunset Speakers"
              division: "B"
              area: "21"
              memberCount: 10
              goalsAchieved: 2
              status: active
          interventionRequiredClubs:
            - clubId: "4567890"
              clubName: "Evening Orators"
              division: "D"
              area: "41"
              memberCount: 6
              goalsAchieved: 0
              status: low
          distinguishedClubs:
            total: 45
            distinguished: 22
            selectDistinguished: 15
            presidentsDistinguished: 8
            percentageOfTotal: 37.5
          membershipTrend:
            - date: "2025-07-01"
              value: 2350
              change: 0
              changePercent: 0
            - date: "2026-01-24"
              value: 2500
              change: 15
              changePercent: 0.6
          dateRange:
            startDate: "2025-07-01"
            endDate: "2026-01-24"
            daysInRange: 208
          programYear: "2025-2026"
          calculatedAt: "2026-01-24T10:30:00Z"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Club Trend Schemas (for Club-Specific Analytics)
    MembershipHistoryPoint:
      type: object
      description: |
        A single data point in a club's membership history.
        Represents the membership count at a specific date.
      required:
        - date
        - memberCount
      properties:
        date:
          type: string
          format: date
          description: |
            Date of the membership snapshot in ISO 8601 format (YYYY-MM-DD).
          example: "2026-01-24"
        memberCount:
          type: integer
          description: |
            Number of members in the club on this date.
          minimum: 0
          example: 25
      example:
        date: "2026-01-24"
        memberCount: 25

    ClubHealthStatus:
      type: string
      description: |
        Health status classification for a club based on membership levels,
        goal achievement, and overall performance indicators.
        - `thriving`: Club is performing excellently with strong membership (20+ members),
          high goal achievement, and positive growth trajectory.
        - `stable`: Club is performing adequately with healthy membership (12-19 members),
          moderate goal achievement, and steady performance.
        - `vulnerable`: Club shows warning signs with declining membership (8-11 members),
          low goal achievement, or negative growth trends requiring attention.
        - `critical`: Club requires immediate intervention with very low membership (<8 members),
          suspended status, or severe performance issues.
      enum:
        - thriving
        - stable
        - vulnerable
        - critical
      example: stable

    ClubTrajectory:
      type: string
      description: |
        Trajectory classification indicating the direction of club performance
        based on recent membership and activity trends.
        - `growing`: Club membership and/or performance is increasing over time.
        - `stable`: Club membership and performance is relatively unchanged.
        - `declining`: Club membership and/or performance is decreasing over time.
      enum:
        - growing
        - stable
        - declining
      example: growing

    ClubTrend:
      type: object
      description: |
        Comprehensive trend and analytics data for a specific club within a district.
        Provides insights into membership history, health status, performance trajectory,
        and goal achievement for club-level analysis and monitoring.

        This schema is used by the GET /districts/{districtId}/clubs/{clubId}/trends
        endpoint to return detailed trend data for a specific club.
      required:
        - clubId
        - clubName
        - division
        - area
        - membershipHistory
        - healthStatus
        - trajectory
        - currentMemberCount
        - membershipChange
        - membershipChangePercent
        - goalsAchieved
      properties:
        clubId:
          type: string
          description: |
            Unique identifier for the club assigned by Toastmasters International.
            This is a numeric string that uniquely identifies the club globally.
          example: "1234567"
        clubName:
          type: string
          description: |
            Official name of the club as registered with Toastmasters International.
          example: "Downtown Speakers"
        division:
          type: string
          description: |
            Division identifier within the district. Divisions are organizational
            units that contain multiple areas. Typically a single letter (A-Z).
          example: "A"
        area:
          type: string
          description: |
            Area identifier within the division. Areas are the smallest organizational
            unit and typically contain 4-6 clubs. Usually a two-digit number.
          example: "12"
        membershipHistory:
          type: array
          description: |
            Historical membership data showing the club's membership count over time.
            Data points are ordered chronologically from oldest to newest.
            Useful for visualizing membership trends and identifying patterns.
          items:
            $ref: '#/components/schemas/MembershipHistoryPoint'
        healthStatus:
          $ref: '#/components/schemas/ClubHealthStatus'
        trajectory:
          $ref: '#/components/schemas/ClubTrajectory'
        currentMemberCount:
          type: integer
          description: |
            Current number of members in the club as of the most recent data point.
            This represents the latest known membership count.
          minimum: 0
          example: 25
        membershipChange:
          type: integer
          description: |
            Net change in membership over the analysis period.
            Positive values indicate growth, negative values indicate decline.
            Calculated as (current membership - starting membership).
          example: 5
        membershipChangePercent:
          type: number
          format: float
          description: |
            Percentage change in membership over the analysis period.
            Calculated as ((current - starting) / starting)  100.
          example: 25.0
        goalsAchieved:
          type: integer
          description: |
            Number of Distinguished Club Program (DCP) goals achieved by the club.
            Clubs can achieve up to 10 goals per program year.
          minimum: 0
          maximum: 10
          example: 7
        distinguishedStatus:
          type: string
          description: |
            Distinguished achievement level of the club based on DCP goals achieved.
            - `Distinguished`: 5+ goals achieved
            - `Select Distinguished`: 7+ goals achieved
            - `President's Distinguished`: 9+ goals achieved
            - `null` or absent: Club has not achieved Distinguished status
          enum:
            - Distinguished
            - Select Distinguished
            - President's Distinguished
          nullable: true
          example: "Select Distinguished"
        analysisStartDate:
          type: string
          format: date
          description: |
            Start date of the analysis period for trend calculations.
          example: "2025-07-01"
        analysisEndDate:
          type: string
          format: date
          description: |
            End date of the analysis period for trend calculations.
          example: "2026-01-24"
      example:
        clubId: "1234567"
        clubName: "Downtown Speakers"
        division: "A"
        area: "12"
        membershipHistory:
          - date: "2025-07-01"
            memberCount: 20
          - date: "2025-08-01"
            memberCount: 21
          - date: "2025-09-01"
            memberCount: 22
          - date: "2025-10-01"
            memberCount: 23
          - date: "2025-11-01"
            memberCount: 24
          - date: "2025-12-01"
            memberCount: 24
          - date: "2026-01-01"
            memberCount: 25
          - date: "2026-01-24"
            memberCount: 25
        healthStatus: thriving
        trajectory: growing
        currentMemberCount: 25
        membershipChange: 5
        membershipChangePercent: 25.0
        goalsAchieved: 7
        distinguishedStatus: "Select Distinguished"
        analysisStartDate: "2025-07-01"
        analysisEndDate: "2026-01-24"

    ClubTrendResponse:
      type: object
      description: |
        Response containing club trend data with snapshot metadata.
        Used by the GET /districts/{districtId}/clubs/{clubId}/trends endpoint
        to return comprehensive trend analytics for a specific club.
      required:
        - trend
      properties:
        trend:
          $ref: '#/components/schemas/ClubTrend'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        trend:
          clubId: "1234567"
          clubName: "Downtown Speakers"
          division: "A"
          area: "12"
          membershipHistory:
            - date: "2025-07-01"
              memberCount: 20
            - date: "2025-10-01"
              memberCount: 23
            - date: "2026-01-01"
              memberCount: 25
            - date: "2026-01-24"
              memberCount: 25
          healthStatus: thriving
          trajectory: growing
          currentMemberCount: 25
          membershipChange: 5
          membershipChangePercent: 25.0
          goalsAchieved: 7
          distinguishedStatus: "Select Distinguished"
          analysisStartDate: "2025-07-01"
          analysisEndDate: "2026-01-24"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Vulnerable Clubs Schemas
    VulnerableClubTrend:
      type: object
      description: |
        Trend and risk data for a vulnerable club within a district.
        Extends basic club information with membership trends, DCP goal progress,
        health status classification, and specific risk factors that identify
        why the club is considered vulnerable or requiring intervention.

        This schema is used by the GET /districts/{districtId}/vulnerable-clubs
        endpoint to provide detailed information about at-risk clubs.
      required:
        - clubId
        - clubName
        - divisionId
        - divisionName
        - areaId
        - areaName
        - membershipTrend
        - dcpGoalsTrend
        - currentStatus
        - riskFactors
        - distinguishedLevel
      properties:
        clubId:
          type: string
          description: |
            Unique identifier for the club assigned by Toastmasters International.
            This is a numeric string that uniquely identifies the club globally.
          example: "1234567"
        clubName:
          type: string
          description: |
            Official name of the club as registered with Toastmasters International.
          example: "Struggling Speakers"
        divisionId:
          type: string
          description: |
            Division identifier within the district. Divisions are organizational
            units that contain multiple areas. Typically a single letter (A-Z).
          example: "A"
        divisionName:
          type: string
          description: |
            Full name of the division within the district.
          example: "Division A"
        areaId:
          type: string
          description: |
            Area identifier within the division. Areas are the smallest organizational
            unit and typically contain 4-6 clubs. Usually a two-digit number.
          example: "12"
        areaName:
          type: string
          description: |
            Full name of the area within the division.
          example: "Area 12"
        membershipTrend:
          type: array
          description: |
            Historical membership data showing the club's membership count over time.
            Data points are ordered chronologically and show the decline pattern
            that contributed to the club's vulnerable status.
          items:
            type: object
            required:
              - date
              - count
            properties:
              date:
                type: string
                format: date
                description: Date of the membership count measurement.
                example: "2025-10-01"
              count:
                type: integer
                description: Number of members on this date.
                minimum: 0
                example: 12
        dcpGoalsTrend:
          type: array
          description: |
            Historical DCP goals achievement data showing the club's progress
            toward Distinguished Club Program goals over time.
          items:
            type: object
            required:
              - date
              - goalsAchieved
            properties:
              date:
                type: string
                format: date
                description: Date of the DCP goals measurement.
                example: "2025-10-01"
              goalsAchieved:
                type: integer
                description: Number of DCP goals achieved as of this date.
                minimum: 0
                maximum: 10
                example: 2
        currentStatus:
          type: string
          description: |
            Current health status classification of the club:
            - `vulnerable`: Club shows signs of potential decline and may need
              proactive support and monitoring
            - `intervention-required`: Club is in critical condition requiring
              immediate attention to prevent closure or suspension
          enum:
            - vulnerable
            - intervention-required
          example: vulnerable
        riskFactors:
          type: array
          description: |
            List of specific risk factors that identify why the club is considered
            vulnerable or requiring intervention. These factors help district
            leadership understand the specific challenges facing the club.
          items:
            type: string
          example:
            - "Low membership (9 members)"
            - "Declining membership trend"
            - "Below minimum DCP goals for Distinguished status"
        distinguishedLevel:
          type: string
          description: |
            Current Distinguished Club Program achievement level:
            - `NotDistinguished`: Club has not achieved Distinguished status
            - `Distinguished`: 5+ DCP goals achieved
            - `Select`: 7+ DCP goals achieved (Select Distinguished)
            - `Presidents`: 9+ DCP goals achieved (President's Distinguished)
          enum:
            - NotDistinguished
            - Distinguished
            - Select
            - Presidents
          example: "NotDistinguished"
        octoberRenewals:
          type: integer
          description: |
            Count of October membership renewals for the club.
            Derived from Toastmasters dashboard data.
          minimum: 0
          example: 5
        aprilRenewals:
          type: integer
          description: |
            Count of April membership renewals for the club.
            Derived from Toastmasters dashboard data.
          minimum: 0
          example: 3
        newMembers:
          type: integer
          description: |
            Count of new members added to the club.
            Derived from Toastmasters dashboard data.
          minimum: 0
          example: 2
        clubStatus:
          type: string
          description: |
            Club operational status from Toastmasters dashboard:
            - `Active`: Club is in good standing
            - `Suspended`: Club has been suspended
            - `Ineligible`: Club is ineligible for recognition
            - `Low`: Club has low membership (below threshold)
          enum:
            - Active
            - Suspended
            - Ineligible
            - Low
          example: "Low"
      example:
        clubId: "1234567"
        clubName: "Struggling Speakers"
        divisionId: "A"
        divisionName: "Division A"
        areaId: "12"
        areaName: "Area 12"
        membershipTrend:
          - date: "2025-10-01"
            count: 12
          - date: "2025-11-01"
            count: 11
          - date: "2025-12-01"
            count: 10
          - date: "2026-01-01"
            count: 9
        dcpGoalsTrend:
          - date: "2025-10-01"
            goalsAchieved: 1
          - date: "2026-01-01"
            goalsAchieved: 2
        currentStatus: vulnerable
        riskFactors:
          - "Low membership (9 members)"
          - "Declining membership trend"
          - "Below minimum DCP goals for Distinguished status"
        distinguishedLevel: "NotDistinguished"
        clubStatus: "Low"

    VulnerableClubsResponse:
      type: object
      description: |
        Response containing vulnerable clubs data for a district.
        Used by the GET /districts/{districtId}/vulnerable-clubs endpoint
        to return a list of clubs that need attention or intervention.

        The response includes summary counts for quick assessment and a detailed
        list of affected clubs with their trend data and risk factors.
      required:
        - districtId
        - totalVulnerableClubs
        - interventionRequiredClubs
        - vulnerableClubs
        - clubs
      properties:
        districtId:
          type: string
          description: |
            District identifier for which vulnerable clubs are being reported.
          example: "57"
        totalVulnerableClubs:
          type: integer
          description: |
            Total count of all clubs that are either vulnerable or require intervention.
            This is the sum of vulnerable clubs and intervention-required clubs.
          minimum: 0
          example: 12
        interventionRequiredClubs:
          type: integer
          description: |
            Count of clubs in critical condition requiring immediate attention.
            These clubs are at high risk of suspension or closure.
          minimum: 0
          example: 3
        vulnerableClubs:
          type: integer
          description: |
            Count of clubs showing signs of potential decline that may need
            proactive support and monitoring.
          minimum: 0
          example: 9
        clubs:
          type: array
          description: |
            Detailed list of all vulnerable and intervention-required clubs.
            Includes trend data, risk factors, and health status for each club.
          items:
            $ref: '#/components/schemas/VulnerableClubTrend'
      example:
        districtId: "57"
        totalVulnerableClubs: 12
        interventionRequiredClubs: 3
        vulnerableClubs: 9
        clubs:
          - clubId: "1234567"
            clubName: "Struggling Speakers"
            divisionId: "A"
            divisionName: "Division A"
            areaId: "12"
            areaName: "Area 12"
            membershipTrend:
              - date: "2025-10-01"
                count: 12
              - date: "2026-01-01"
                count: 9
            dcpGoalsTrend:
              - date: "2025-10-01"
                goalsAchieved: 1
              - date: "2026-01-01"
                goalsAchieved: 2
            currentStatus: vulnerable
            riskFactors:
              - "Low membership (9 members)"
              - "Declining membership trend"
            distinguishedLevel: "NotDistinguished"
            clubStatus: "Low"
          - clubId: "7654321"
            clubName: "Critical Club"
            divisionId: "B"
            divisionName: "Division B"
            areaId: "21"
            areaName: "Area 21"
            membershipTrend:
              - date: "2025-10-01"
                count: 10
              - date: "2026-01-01"
                count: 6
            dcpGoalsTrend:
              - date: "2025-10-01"
                goalsAchieved: 0
              - date: "2026-01-01"
                goalsAchieved: 0
            currentStatus: intervention-required
            riskFactors:
              - "Critical low membership (6 members)"
              - "No DCP goals achieved"
            distinguishedLevel: "NotDistinguished"
            clubStatus: "Low"

    # Leadership Insights Schemas
    LeadershipEffectivenessScore:
      type: object
      description: |
        Leadership effectiveness score for a division, measuring health, growth,
        and DCP performance. Used to evaluate division director effectiveness
        and identify best practice divisions.
      required:
        - divisionId
        - divisionName
        - healthScore
        - growthScore
        - dcpScore
        - overallScore
        - rank
        - isBestPractice
      properties:
        divisionId:
          type: string
          description: Unique identifier for the division.
          example: "A"
        divisionName:
          type: string
          description: Name of the division.
          example: "Division A"
        healthScore:
          type: number
          format: float
          description: |
            Club health score for the division (0-100).
            Measures the overall health status of clubs within the division.
          minimum: 0
          maximum: 100
          example: 85.5
        growthScore:
          type: number
          format: float
          description: |
            Membership growth score for the division (0-100).
            Measures membership growth trends across clubs in the division.
          minimum: 0
          maximum: 100
          example: 72.3
        dcpScore:
          type: number
          format: float
          description: |
            Distinguished Club Program score for the division (0-100).
            Measures DCP goal achievement across clubs in the division.
          minimum: 0
          maximum: 100
          example: 68.0
        overallScore:
          type: number
          format: float
          description: |
            Weighted overall leadership effectiveness score.
            Calculated as: 40% health + 30% growth + 30% DCP.
          minimum: 0
          maximum: 100
          example: 76.2
        rank:
          type: integer
          description: |
            Rank of this division among all divisions in the district.
            1 = highest performing division.
          minimum: 1
          example: 3
        isBestPractice:
          type: boolean
          description: |
            Indicates whether this division is identified as a best practice
            division based on exceptional performance metrics.
          example: true
      example:
        divisionId: "A"
        divisionName: "Division A"
        healthScore: 85.5
        growthScore: 72.3
        dcpScore: 68.0
        overallScore: 76.2
        rank: 3
        isBestPractice: true

    LeadershipChange:
      type: object
      description: |
        Tracks performance changes associated with leadership transitions
        in a division. Used to analyze the impact of leadership changes
        on division performance.
      required:
        - divisionId
        - divisionName
        - changeDate
        - performanceBeforeChange
        - performanceAfterChange
        - performanceDelta
        - trend
      properties:
        divisionId:
          type: string
          description: Unique identifier for the division.
          example: "B"
        divisionName:
          type: string
          description: Name of the division.
          example: "Division B"
        changeDate:
          type: string
          format: date
          description: |
            Date when the leadership change occurred, in ISO 8601 format (YYYY-MM-DD).
          example: "2025-10-15"
        performanceBeforeChange:
          type: number
          format: float
          description: |
            Division performance score before the leadership change.
            Measured on a 0-100 scale.
          minimum: 0
          maximum: 100
          example: 65.0
        performanceAfterChange:
          type: number
          format: float
          description: |
            Division performance score after the leadership change.
            Measured on a 0-100 scale.
          minimum: 0
          maximum: 100
          example: 78.5
        performanceDelta:
          type: number
          format: float
          description: |
            Change in performance score (after - before).
            Positive values indicate improvement, negative values indicate decline.
          example: 13.5
        trend:
          type: string
          description: |
            Overall trend classification based on performance delta.
            - `improved`: Performance increased significantly
            - `declined`: Performance decreased significantly
            - `stable`: Performance remained relatively unchanged
          enum:
            - improved
            - declined
            - stable
          example: improved
      example:
        divisionId: "B"
        divisionName: "Division B"
        changeDate: "2025-10-15"
        performanceBeforeChange: 65.0
        performanceAfterChange: 78.5
        performanceDelta: 13.5
        trend: improved

    AreaDirectorCorrelation:
      type: object
      description: |
        Correlation data between area director activity and club performance.
        Used to identify relationships between leadership engagement and
        club success within an area.
      required:
        - areaId
        - areaName
        - divisionId
        - clubPerformanceScore
        - activityIndicator
        - correlation
      properties:
        areaId:
          type: string
          description: Unique identifier for the area.
          example: "A1"
        areaName:
          type: string
          description: Name of the area.
          example: "Area A1"
        divisionId:
          type: string
          description: Division that this area belongs to.
          example: "A"
        clubPerformanceScore:
          type: number
          format: float
          description: |
            Average performance score of clubs in this area (0-100).
            Higher scores indicate better overall club performance.
          minimum: 0
          maximum: 100
          example: 82.5
        activityIndicator:
          type: string
          description: |
            Level of area director activity/engagement.
            - `high`: Frequent club visits, active mentoring, regular communication
            - `medium`: Moderate engagement with clubs
            - `low`: Minimal direct engagement with clubs
          enum:
            - high
            - medium
            - low
          example: high
        correlation:
          type: string
          description: |
            Correlation between area director activity and club performance.
            - `positive`: Higher activity correlates with better performance
            - `neutral`: No clear correlation observed
            - `negative`: Higher activity correlates with lower performance (unusual)
          enum:
            - positive
            - neutral
            - negative
          example: positive
      example:
        areaId: "A1"
        areaName: "Area A1"
        divisionId: "A"
        clubPerformanceScore: 82.5
        activityIndicator: high
        correlation: positive

    LeadershipInsightsSummary:
      type: object
      description: |
        Summary of leadership insights including top performing divisions
        and areas, along with aggregate metrics.
      required:
        - topPerformingDivisions
        - topPerformingAreas
        - averageLeadershipScore
        - totalBestPracticeDivisions
      properties:
        topPerformingDivisions:
          type: array
          description: |
            List of top performing divisions ranked by overall score.
            Typically limited to top 5 divisions.
          items:
            type: object
            required:
              - divisionId
              - divisionName
              - score
            properties:
              divisionId:
                type: string
                description: Unique identifier for the division.
                example: "A"
              divisionName:
                type: string
                description: Name of the division.
                example: "Division A"
              score:
                type: number
                format: float
                description: Overall leadership effectiveness score.
                minimum: 0
                maximum: 100
                example: 85.2
        topPerformingAreas:
          type: array
          description: |
            List of top performing areas ranked by club performance score.
            Typically limited to top 5 areas.
          items:
            type: object
            required:
              - areaId
              - areaName
              - score
            properties:
              areaId:
                type: string
                description: Unique identifier for the area.
                example: "A1"
              areaName:
                type: string
                description: Name of the area.
                example: "Area A1"
              score:
                type: number
                format: float
                description: Average club performance score for the area.
                minimum: 0
                maximum: 100
                example: 88.5
        averageLeadershipScore:
          type: number
          format: float
          description: |
            Average leadership effectiveness score across all divisions
            in the district.
          minimum: 0
          maximum: 100
          example: 72.8
        totalBestPracticeDivisions:
          type: integer
          description: |
            Total number of divisions identified as best practice divisions.
          minimum: 0
          example: 3
      example:
        topPerformingDivisions:
          - divisionId: "A"
            divisionName: "Division A"
            score: 85.2
          - divisionId: "C"
            divisionName: "Division C"
            score: 82.1
          - divisionId: "B"
            divisionName: "Division B"
            score: 78.5
        topPerformingAreas:
          - areaId: "A1"
            areaName: "Area A1"
            score: 88.5
          - areaId: "C2"
            areaName: "Area C2"
            score: 86.3
          - areaId: "A3"
            areaName: "Area A3"
            score: 84.7
        averageLeadershipScore: 72.8
        totalBestPracticeDivisions: 3

    LeadershipInsights:
      type: object
      description: |
        Comprehensive leadership effectiveness analytics for a district.
        Includes division and area performance scores, leadership change
        impact analysis, and correlations between leadership activity
        and club performance.

        This data helps district leaders identify high-performing divisions,
        understand the impact of leadership changes, and recognize best
        practices that can be shared across the district.
      required:
        - leadershipScores
        - bestPracticeDivisions
        - leadershipChanges
        - areaDirectorCorrelations
        - summary
      properties:
        leadershipScores:
          type: array
          description: |
            Leadership effectiveness scores for all divisions in the district.
            Sorted by overall score in descending order.
          items:
            $ref: '#/components/schemas/LeadershipEffectivenessScore'
        bestPracticeDivisions:
          type: array
          description: |
            Divisions identified as best practice divisions based on
            exceptional performance across health, growth, and DCP metrics.
          items:
            $ref: '#/components/schemas/LeadershipEffectivenessScore'
        leadershipChanges:
          type: array
          description: |
            Performance changes associated with leadership transitions.
            Tracks how division performance changed before and after
            leadership changes during the analysis period.
          items:
            $ref: '#/components/schemas/LeadershipChange'
        areaDirectorCorrelations:
          type: array
          description: |
            Correlations between area director activity levels and
            club performance within each area.
          items:
            $ref: '#/components/schemas/AreaDirectorCorrelation'
        summary:
          $ref: '#/components/schemas/LeadershipInsightsSummary'
      example:
        leadershipScores:
          - divisionId: "A"
            divisionName: "Division A"
            healthScore: 85.5
            growthScore: 72.3
            dcpScore: 68.0
            overallScore: 76.2
            rank: 1
            isBestPractice: true
          - divisionId: "B"
            divisionName: "Division B"
            healthScore: 78.0
            growthScore: 65.5
            dcpScore: 72.0
            overallScore: 72.3
            rank: 2
            isBestPractice: false
        bestPracticeDivisions:
          - divisionId: "A"
            divisionName: "Division A"
            healthScore: 85.5
            growthScore: 72.3
            dcpScore: 68.0
            overallScore: 76.2
            rank: 1
            isBestPractice: true
        leadershipChanges:
          - divisionId: "B"
            divisionName: "Division B"
            changeDate: "2025-10-15"
            performanceBeforeChange: 65.0
            performanceAfterChange: 78.5
            performanceDelta: 13.5
            trend: improved
        areaDirectorCorrelations:
          - areaId: "A1"
            areaName: "Area A1"
            divisionId: "A"
            clubPerformanceScore: 82.5
            activityIndicator: high
            correlation: positive
          - areaId: "B2"
            areaName: "Area B2"
            divisionId: "B"
            clubPerformanceScore: 68.0
            activityIndicator: medium
            correlation: neutral
        summary:
          topPerformingDivisions:
            - divisionId: "A"
              divisionName: "Division A"
              score: 76.2
            - divisionId: "B"
              divisionName: "Division B"
              score: 72.3
          topPerformingAreas:
            - areaId: "A1"
              areaName: "Area A1"
              score: 82.5
            - areaId: "B2"
              areaName: "Area B2"
              score: 68.0
          averageLeadershipScore: 74.25
          totalBestPracticeDivisions: 1

    LeadershipInsightsResponse:
      type: object
      description: |
        Response containing leadership insights data with snapshot metadata.
        Used by the GET /districts/{districtId}/leadership-insights endpoint
        to return comprehensive leadership effectiveness analytics.
      required:
        - insights
      properties:
        insights:
          $ref: '#/components/schemas/LeadershipInsights'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        insights:
          leadershipScores:
            - divisionId: "A"
              divisionName: "Division A"
              healthScore: 85.5
              growthScore: 72.3
              dcpScore: 68.0
              overallScore: 76.2
              rank: 1
              isBestPractice: true
          bestPracticeDivisions:
            - divisionId: "A"
              divisionName: "Division A"
              healthScore: 85.5
              growthScore: 72.3
              dcpScore: 68.0
              overallScore: 76.2
              rank: 1
              isBestPractice: true
          leadershipChanges:
            - divisionId: "B"
              divisionName: "Division B"
              changeDate: "2025-10-15"
              performanceBeforeChange: 65.0
              performanceAfterChange: 78.5
              performanceDelta: 13.5
              trend: improved
          areaDirectorCorrelations:
            - areaId: "A1"
              areaName: "Area A1"
              divisionId: "A"
              clubPerformanceScore: 82.5
              activityIndicator: high
              correlation: positive
          summary:
            topPerformingDivisions:
              - divisionId: "A"
                divisionName: "Division A"
                score: 76.2
            topPerformingAreas:
              - areaId: "A1"
                areaName: "Area A1"
                score: 82.5
            averageLeadershipScore: 74.25
            totalBestPracticeDivisions: 1
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Distinguished Club Analytics Schemas
    DistinguishedClubProjection:
      type: object
      description: |
        Projected counts of clubs expected to achieve each Distinguished level
        by the end of the program year, based on current trajectory and goal progress.
      required:
        - distinguished
        - selectDistinguished
        - presidentsDistinguished
        - total
      properties:
        distinguished:
          type: integer
          description: |
            Projected number of clubs expected to achieve Distinguished status
            (5+ DCP goals) by end of program year.
          minimum: 0
          example: 28
        selectDistinguished:
          type: integer
          description: |
            Projected number of clubs expected to achieve Select Distinguished status
            (7+ DCP goals) by end of program year.
          minimum: 0
          example: 18
        presidentsDistinguished:
          type: integer
          description: |
            Projected number of clubs expected to achieve President's Distinguished status
            (9+ DCP goals) by end of program year.
          minimum: 0
          example: 12
        total:
          type: integer
          description: |
            Total projected number of clubs expected to achieve any Distinguished level.
          minimum: 0
          example: 58
        confidence:
          type: string
          description: |
            Confidence level of the projection based on data quality and time remaining.
            - `high`: Strong historical data, consistent trends
            - `medium`: Adequate data, some variability
            - `low`: Limited data or high variability
          enum:
            - high
            - medium
            - low
          example: medium
      example:
        distinguished: 28
        selectDistinguished: 18
        presidentsDistinguished: 12
        total: 58
        confidence: medium

    ClubDistinguishedProgress:
      type: object
      description: |
        Progress information for a club toward Distinguished status.
        Used in clubsOnTrack and clubsAtRisk arrays to show individual club status.
      required:
        - clubId
        - clubName
        - goalsAchieved
        - goalsRequired
        - currentStatus
      properties:
        clubId:
          type: string
          description: Unique identifier for the club.
          example: "1234567"
        clubName:
          type: string
          description: Official name of the club.
          example: "Downtown Speakers"
        division:
          type: string
          description: Division the club belongs to.
          example: "A"
        area:
          type: string
          description: Area the club belongs to within its division.
          example: "12"
        goalsAchieved:
          type: integer
          description: |
            Number of DCP goals currently achieved by the club (0-10).
          minimum: 0
          maximum: 10
          example: 4
        goalsRequired:
          type: integer
          description: |
            Number of goals required for the next Distinguished level.
            5 for Distinguished, 7 for Select, 9 for President's.
          minimum: 5
          maximum: 9
          example: 5
        goalsRemaining:
          type: integer
          description: |
            Number of additional goals needed to reach the next Distinguished level.
          minimum: 0
          example: 1
        currentStatus:
          type: string
          description: |
            Current Distinguished status of the club, if any.
          enum:
            - none
            - distinguished
            - selectDistinguished
            - presidentsDistinguished
          example: none
        projectedStatus:
          type: string
          description: |
            Projected Distinguished status by end of program year based on trajectory.
          enum:
            - none
            - distinguished
            - selectDistinguished
            - presidentsDistinguished
          example: distinguished
        memberCount:
          type: integer
          description: Current number of active members in the club.
          minimum: 0
          example: 22
        trajectory:
          type: string
          description: |
            Club's trajectory toward Distinguished status.
            - `on_track`: Likely to achieve target status
            - `at_risk`: May not achieve target status without intervention
            - `achieved`: Already achieved Distinguished status
          enum:
            - on_track
            - at_risk
            - achieved
          example: on_track
        riskFactors:
          type: array
          description: |
            List of factors putting the club at risk of not achieving Distinguished.
            Only present for clubs with trajectory "at_risk".
          items:
            type: string
          example:
            - "Low membership (below 12)"
            - "No educational awards this quarter"
      example:
        clubId: "1234567"
        clubName: "Downtown Speakers"
        division: "A"
        area: "12"
        goalsAchieved: 4
        goalsRequired: 5
        goalsRemaining: 1
        currentStatus: none
        projectedStatus: distinguished
        memberCount: 22
        trajectory: on_track

    GoalDistribution:
      type: object
      description: |
        Distribution of clubs by number of DCP goals achieved.
        Shows how many clubs have achieved each goal count (0-10).
      required:
        - distribution
        - averageGoals
      properties:
        distribution:
          type: object
          description: |
            Map of goal count to number of clubs achieving that count.
            Keys are goal counts (0-10), values are club counts.
          additionalProperties:
            type: integer
            minimum: 0
          example:
            "0": 5
            "1": 8
            "2": 12
            "3": 15
            "4": 18
            "5": 22
            "6": 14
            "7": 10
            "8": 8
            "9": 5
            "10": 3
        averageGoals:
          type: number
          format: float
          description: |
            Average number of DCP goals achieved across all clubs in the district.
          minimum: 0
          maximum: 10
          example: 4.8
        medianGoals:
          type: integer
          description: |
            Median number of DCP goals achieved across all clubs.
          minimum: 0
          maximum: 10
          example: 5
        clubsWithZeroGoals:
          type: integer
          description: |
            Number of clubs that have not achieved any DCP goals.
          minimum: 0
          example: 5
        clubsWithAllGoals:
          type: integer
          description: |
            Number of clubs that have achieved all 10 DCP goals.
          minimum: 0
          example: 3
      example:
        distribution:
          "0": 5
          "1": 8
          "2": 12
          "3": 15
          "4": 18
          "5": 22
          "6": 14
          "7": 10
          "8": 8
          "9": 5
          "10": 3
        averageGoals: 4.8
        medianGoals: 5
        clubsWithZeroGoals: 5
        clubsWithAllGoals: 3

    DistinguishedTrendPoint:
      type: object
      description: |
        A single data point in a distinguished club trend series.
        Represents the count of distinguished clubs at a specific point in time.
      required:
        - date
        - total
        - distinguished
        - selectDistinguished
        - presidentsDistinguished
      properties:
        date:
          type: string
          format: date
          description: |
            Date of the data point in ISO 8601 format (YYYY-MM-DD).
          example: "2026-01-24"
        total:
          type: integer
          description: |
            Total number of clubs with any Distinguished status on this date.
          minimum: 0
          example: 45
        distinguished:
          type: integer
          description: |
            Number of clubs with Distinguished status on this date.
          minimum: 0
          example: 22
        selectDistinguished:
          type: integer
          description: |
            Number of clubs with Select Distinguished status on this date.
          minimum: 0
          example: 15
        presidentsDistinguished:
          type: integer
          description: |
            Number of clubs with President's Distinguished status on this date.
          minimum: 0
          example: 8
        percentageOfTotal:
          type: number
          format: float
          description: |
            Percentage of all clubs that have achieved Distinguished status.
          minimum: 0
          maximum: 100
          example: 37.5
      example:
        date: "2026-01-24"
        total: 45
        distinguished: 22
        selectDistinguished: 15
        presidentsDistinguished: 8
        percentageOfTotal: 37.5

    DistinguishedClubAnalytics:
      type: object
      description: |
        Comprehensive analytics for Distinguished Club Program (DCP) performance
        within a Toastmasters district. Provides insights into current distinguished
        club counts, projections, clubs on track or at risk, goal distribution,
        and historical trends.

        This schema is used by the GET /districts/{districtId}/distinguished-club-analytics
        endpoint to return detailed DCP analytics for district leadership planning.
      required:
        - districtId
        - totalClubs
        - distinguishedClubs
        - percentageDistinguished
        - projectedDistinguished
        - clubsOnTrack
        - clubsAtRisk
        - goalDistribution
        - trend
        - dateRange
      properties:
        districtId:
          type: string
          description: |
            Unique district identifier. Can be numeric (e.g., "57") or
            alphabetic (e.g., "F") for special districts.
          example: "57"
        totalClubs:
          type: integer
          description: |
            Total number of clubs in the district eligible for Distinguished status.
          minimum: 0
          example: 120
        distinguishedClubs:
          type: object
          description: |
            Current counts of clubs at each Distinguished achievement level.
          required:
            - total
            - distinguished
            - selectDistinguished
            - presidentsDistinguished
          properties:
            total:
              type: integer
              description: |
                Total number of clubs that have achieved any Distinguished level.
              minimum: 0
              example: 45
            distinguished:
              type: integer
              description: |
                Number of clubs that achieved Distinguished status (5+ DCP goals).
              minimum: 0
              example: 22
            selectDistinguished:
              type: integer
              description: |
                Number of clubs that achieved Select Distinguished status (7+ DCP goals).
              minimum: 0
              example: 15
            presidentsDistinguished:
              type: integer
              description: |
                Number of clubs that achieved President's Distinguished status (9+ DCP goals).
              minimum: 0
              example: 8
        percentageDistinguished:
          type: number
          format: float
          description: |
            Percentage of total clubs that have achieved any Distinguished level.
            Calculated as (distinguishedClubs.total / totalClubs)  100.
          minimum: 0
          maximum: 100
          example: 37.5
        projectedDistinguished:
          $ref: '#/components/schemas/DistinguishedClubProjection'
        clubsOnTrack:
          type: array
          description: |
            List of clubs that are on track to achieve Distinguished status
            by the end of the program year. These clubs show positive trajectory
            and are likely to meet their goals without intervention.
          items:
            $ref: '#/components/schemas/ClubDistinguishedProgress'
        clubsAtRisk:
          type: array
          description: |
            List of clubs that are at risk of not achieving Distinguished status.
            These clubs may need intervention, support, or focused attention
            to improve their chances of reaching Distinguished level.
          items:
            $ref: '#/components/schemas/ClubDistinguishedProgress'
        goalDistribution:
          $ref: '#/components/schemas/GoalDistribution'
        trend:
          type: array
          description: |
            Time series data showing distinguished club counts over the analytics period.
            Useful for visualizing progress toward distinguished club goals.
          items:
            $ref: '#/components/schemas/DistinguishedTrendPoint'
        dateRange:
          $ref: '#/components/schemas/DateRange'
        programYear:
          type: string
          description: |
            Toastmasters program year for the analytics (July 1 - June 30).
            Format: "YYYY-YYYY" (e.g., "2025-2026").
          example: "2025-2026"
        calculatedAt:
          type: string
          format: date-time
          description: |
            Timestamp when the analytics were calculated.
          example: "2026-01-24T10:30:00Z"
      example:
        districtId: "57"
        totalClubs: 120
        distinguishedClubs:
          total: 45
          distinguished: 22
          selectDistinguished: 15
          presidentsDistinguished: 8
        percentageDistinguished: 37.5
        projectedDistinguished:
          distinguished: 28
          selectDistinguished: 18
          presidentsDistinguished: 12
          total: 58
          confidence: medium
        clubsOnTrack:
          - clubId: "1234567"
            clubName: "Downtown Speakers"
            division: "A"
            area: "12"
            goalsAchieved: 4
            goalsRequired: 5
            goalsRemaining: 1
            currentStatus: none
            projectedStatus: distinguished
            memberCount: 22
            trajectory: on_track
          - clubId: "7654321"
            clubName: "Morning Leaders"
            division: "A"
            area: "13"
            goalsAchieved: 6
            goalsRequired: 7
            goalsRemaining: 1
            currentStatus: distinguished
            projectedStatus: selectDistinguished
            memberCount: 28
            trajectory: on_track
        clubsAtRisk:
          - clubId: "2345678"
            clubName: "Sunset Speakers"
            division: "B"
            area: "21"
            goalsAchieved: 2
            goalsRequired: 5
            goalsRemaining: 3
            currentStatus: none
            projectedStatus: none
            memberCount: 10
            trajectory: at_risk
            riskFactors:
              - "Low membership (below 12)"
              - "Only 2 goals achieved with 5 months remaining"
          - clubId: "3456789"
            clubName: "Midtown Toasters"
            division: "C"
            area: "31"
            goalsAchieved: 3
            goalsRequired: 5
            goalsRemaining: 2
            currentStatus: none
            projectedStatus: none
            memberCount: 11
            trajectory: at_risk
            riskFactors:
              - "No educational awards this quarter"
        goalDistribution:
          distribution:
            "0": 5
            "1": 8
            "2": 12
            "3": 15
            "4": 18
            "5": 22
            "6": 14
            "7": 10
            "8": 8
            "9": 5
            "10": 3
          averageGoals: 4.8
          medianGoals: 5
          clubsWithZeroGoals: 5
          clubsWithAllGoals: 3
        trend:
          - date: "2025-07-01"
            total: 0
            distinguished: 0
            selectDistinguished: 0
            presidentsDistinguished: 0
            percentageOfTotal: 0
          - date: "2025-10-01"
            total: 15
            distinguished: 10
            selectDistinguished: 4
            presidentsDistinguished: 1
            percentageOfTotal: 12.5
          - date: "2026-01-01"
            total: 38
            distinguished: 20
            selectDistinguished: 12
            presidentsDistinguished: 6
            percentageOfTotal: 31.7
          - date: "2026-01-24"
            total: 45
            distinguished: 22
            selectDistinguished: 15
            presidentsDistinguished: 8
            percentageOfTotal: 37.5
        dateRange:
          startDate: "2025-07-01"
          endDate: "2026-01-24"
          daysInRange: 208
        programYear: "2025-2026"
        calculatedAt: "2026-01-24T10:30:00Z"

    DistinguishedClubAnalyticsResponse:
      type: object
      description: |
        Response containing distinguished club analytics data with snapshot metadata.
        Used by the GET /districts/{districtId}/distinguished-club-analytics endpoint
        to return comprehensive DCP analytics for district leadership.
      required:
        - analytics
      properties:
        analytics:
          $ref: '#/components/schemas/DistinguishedClubAnalytics'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        analytics:
          districtId: "57"
          totalClubs: 120
          distinguishedClubs:
            total: 45
            distinguished: 22
            selectDistinguished: 15
            presidentsDistinguished: 8
          percentageDistinguished: 37.5
          projectedDistinguished:
            distinguished: 28
            selectDistinguished: 18
            presidentsDistinguished: 12
            total: 58
            confidence: medium
          clubsOnTrack:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              division: "A"
              area: "12"
              goalsAchieved: 4
              goalsRequired: 5
              goalsRemaining: 1
              currentStatus: none
              projectedStatus: distinguished
              memberCount: 22
              trajectory: on_track
          clubsAtRisk:
            - clubId: "2345678"
              clubName: "Sunset Speakers"
              division: "B"
              area: "21"
              goalsAchieved: 2
              goalsRequired: 5
              goalsRemaining: 3
              currentStatus: none
              projectedStatus: none
              memberCount: 10
              trajectory: at_risk
              riskFactors:
                - "Low membership (below 12)"
                - "Only 2 goals achieved with 5 months remaining"
          goalDistribution:
            distribution:
              "0": 5
              "1": 8
              "2": 12
              "3": 15
              "4": 18
              "5": 22
              "6": 14
              "7": 10
              "8": 8
              "9": 5
              "10": 3
            averageGoals: 4.8
            medianGoals: 5
            clubsWithZeroGoals: 5
            clubsWithAllGoals: 3
          trend:
            - date: "2025-07-01"
              total: 0
              distinguished: 0
              selectDistinguished: 0
              presidentsDistinguished: 0
              percentageOfTotal: 0
            - date: "2026-01-24"
              total: 45
              distinguished: 22
              selectDistinguished: 15
              presidentsDistinguished: 8
              percentageOfTotal: 37.5
          dateRange:
            startDate: "2025-07-01"
            endDate: "2026-01-24"
            daysInRange: 208
          programYear: "2025-2026"
          calculatedAt: "2026-01-24T10:30:00Z"
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Year-Over-Year Comparison Schemas
    YearOverYearMetricComparison:
      type: object
      description: |
        A comparison of a single metric between current and previous year,
        including the absolute change and percentage change.
      required:
        - current
        - previous
        - change
        - percentageChange
      properties:
        current:
          type: number
          description: Current year's value for this metric.
          example: 2500
        previous:
          type: number
          description: Previous year's value for this metric.
          example: 2350
        change:
          type: number
          description: |
            Absolute change (current - previous).
            Positive values indicate growth, negative values indicate decline.
          example: 150
        percentageChange:
          type: number
          format: float
          description: |
            Percentage change from previous year.
            Calculated as ((current - previous) / previous) * 100.
          example: 6.38

    YearOverYearDistinguishedByLevel:
      type: object
      description: |
        Year-over-year comparison of distinguished clubs broken down by achievement level.
      required:
        - smedley
        - presidents
        - select
        - distinguished
      properties:
        smedley:
          type: object
          description: Smedley Distinguished clubs comparison.
          required:
            - current
            - previous
            - change
          properties:
            current:
              type: integer
              description: Current year Smedley Distinguished clubs.
              minimum: 0
              example: 2
            previous:
              type: integer
              description: Previous year Smedley Distinguished clubs.
              minimum: 0
              example: 1
            change:
              type: integer
              description: Change in Smedley Distinguished clubs.
              example: 1
        presidents:
          type: object
          description: President's Distinguished clubs comparison.
          required:
            - current
            - previous
            - change
          properties:
            current:
              type: integer
              description: Current year President's Distinguished clubs.
              minimum: 0
              example: 8
            previous:
              type: integer
              description: Previous year President's Distinguished clubs.
              minimum: 0
              example: 6
            change:
              type: integer
              description: Change in President's Distinguished clubs.
              example: 2
        select:
          type: object
          description: Select Distinguished clubs comparison.
          required:
            - current
            - previous
            - change
          properties:
            current:
              type: integer
              description: Current year Select Distinguished clubs.
              minimum: 0
              example: 15
            previous:
              type: integer
              description: Previous year Select Distinguished clubs.
              minimum: 0
              example: 12
            change:
              type: integer
              description: Change in Select Distinguished clubs.
              example: 3
        distinguished:
          type: object
          description: Distinguished clubs comparison.
          required:
            - current
            - previous
            - change
          properties:
            current:
              type: integer
              description: Current year Distinguished clubs.
              minimum: 0
              example: 22
            previous:
              type: integer
              description: Previous year Distinguished clubs.
              minimum: 0
              example: 18
            change:
              type: integer
              description: Change in Distinguished clubs.
              example: 4

    YearOverYearDistinguishedClubs:
      type: object
      description: |
        Year-over-year comparison of distinguished club counts,
        including totals and breakdown by achievement level.
      required:
        - current
        - previous
        - change
        - percentageChange
        - byLevel
      properties:
        current:
          type: integer
          description: Current year total distinguished clubs.
          minimum: 0
          example: 45
        previous:
          type: integer
          description: Previous year total distinguished clubs.
          minimum: 0
          example: 37
        change:
          type: integer
          description: Change in total distinguished clubs.
          example: 8
        percentageChange:
          type: number
          format: float
          description: Percentage change in distinguished clubs.
          example: 21.62
        byLevel:
          $ref: '#/components/schemas/YearOverYearDistinguishedByLevel'

    YearOverYearClubHealth:
      type: object
      description: |
        Year-over-year comparison of club health categories,
        showing changes in thriving, vulnerable, and intervention-required clubs.
      required:
        - thrivingClubs
        - vulnerableClubs
        - interventionRequiredClubs
      properties:
        thrivingClubs:
          $ref: '#/components/schemas/YearOverYearMetricComparison'
        vulnerableClubs:
          $ref: '#/components/schemas/YearOverYearMetricComparison'
        interventionRequiredClubs:
          $ref: '#/components/schemas/YearOverYearMetricComparison'
      example:
        thrivingClubs:
          current: 85
          previous: 78
          change: 7
          percentageChange: 8.97
        vulnerableClubs:
          current: 12
          previous: 18
          change: -6
          percentageChange: -33.33
        interventionRequiredClubs:
          current: 5
          previous: 8
          change: -3
          percentageChange: -37.5

    YearOverYearDcpGoals:
      type: object
      description: |
        Year-over-year comparison of DCP goal achievement,
        including total goals and average per club.
      required:
        - totalGoals
        - averagePerClub
      properties:
        totalGoals:
          $ref: '#/components/schemas/YearOverYearMetricComparison'
        averagePerClub:
          type: object
          description: Average DCP goals per club comparison.
          required:
            - current
            - previous
            - change
            - percentageChange
          properties:
            current:
              type: number
              format: float
              description: Current year average goals per club.
              example: 4.8
            previous:
              type: number
              format: float
              description: Previous year average goals per club.
              example: 4.2
            change:
              type: number
              format: float
              description: Change in average goals per club.
              example: 0.6
            percentageChange:
              type: number
              format: float
              description: Percentage change in average goals.
              example: 14.29
      example:
        totalGoals:
          current: 576
          previous: 504
          change: 72
          percentageChange: 14.29
        averagePerClub:
          current: 4.8
          previous: 4.2
          change: 0.6
          percentageChange: 14.29

    YearOverYearMetrics:
      type: object
      description: |
        Comprehensive year-over-year metrics comparing current and previous
        program year performance across all key indicators.
      required:
        - membership
        - distinguishedClubs
        - clubHealth
        - dcpGoals
        - clubCount
      properties:
        membership:
          $ref: '#/components/schemas/YearOverYearMetricComparison'
        distinguishedClubs:
          $ref: '#/components/schemas/YearOverYearDistinguishedClubs'
        clubHealth:
          $ref: '#/components/schemas/YearOverYearClubHealth'
        dcpGoals:
          $ref: '#/components/schemas/YearOverYearDcpGoals'
        clubCount:
          $ref: '#/components/schemas/YearOverYearMetricComparison'

    YearOverYearTrendPoint:
      type: object
      description: |
        A single data point in the multi-year trend history,
        representing key metrics for a specific year.
      required:
        - year
        - date
        - membership
        - distinguishedClubs
        - totalDcpGoals
        - clubCount
      properties:
        year:
          type: integer
          description: Program year (e.g., 2025 for 2025-2026 program year).
          example: 2025
        date:
          type: string
          format: date
          description: Date of the data point within the program year.
          example: "2026-01-24"
        membership:
          type: integer
          description: Total membership count at this point.
          minimum: 0
          example: 2500
        distinguishedClubs:
          type: integer
          description: Number of distinguished clubs at this point.
          minimum: 0
          example: 45
        totalDcpGoals:
          type: integer
          description: Total DCP goals achieved at this point.
          minimum: 0
          example: 576
        clubCount:
          type: integer
          description: Total number of clubs at this point.
          minimum: 0
          example: 120

    YearOverYearTrends:
      type: object
      description: |
        Trend direction indicators showing whether key metrics are
        increasing, decreasing, or stable over multiple years.
      properties:
        membershipTrend:
          type: string
          description: Overall membership trend direction.
          enum:
            - increasing
            - decreasing
            - stable
          example: increasing
        distinguishedTrend:
          type: string
          description: Overall distinguished clubs trend direction.
          enum:
            - increasing
            - decreasing
            - stable
          example: increasing
        dcpGoalsTrend:
          type: string
          description: Overall DCP goals trend direction.
          enum:
            - increasing
            - decreasing
            - stable
          example: stable

    YearOverYearMultiYearTrends:
      type: object
      description: |
        Multi-year trend data showing historical performance across
        multiple program years when available.
      required:
        - available
      properties:
        available:
          type: boolean
          description: |
            Whether multi-year trend data is available.
            False if insufficient historical data exists.
          example: true
        years:
          type: array
          description: |
            Array of yearly data points, ordered from oldest to newest.
            Only present when `available` is true.
          items:
            $ref: '#/components/schemas/YearOverYearTrendPoint'
        trends:
          $ref: '#/components/schemas/YearOverYearTrends'
      example:
        available: true
        years:
          - year: 2023
            date: "2024-01-24"
            membership: 2200
            distinguishedClubs: 32
            totalDcpGoals: 420
            clubCount: 115
          - year: 2024
            date: "2025-01-24"
            membership: 2350
            distinguishedClubs: 37
            totalDcpGoals: 504
            clubCount: 118
          - year: 2025
            date: "2026-01-24"
            membership: 2500
            distinguishedClubs: 45
            totalDcpGoals: 576
            clubCount: 120
        trends:
          membershipTrend: increasing
          distinguishedTrend: increasing
          dcpGoalsTrend: increasing

    YearOverYearComparison:
      type: object
      description: |
        Comprehensive year-over-year comparison data for a district,
        comparing current program year performance against the previous
        program year at the same point in time.

        This endpoint is useful for understanding district progress and
        identifying trends in membership, club health, and DCP achievement.

        When data is not available for comparison (e.g., no previous year data),
        the `dataAvailable` field will be false and a `message` will explain why.
      required:
        - districtId
        - currentDate
        - previousYearDate
        - dataAvailable
      properties:
        districtId:
          type: string
          description: |
            District identifier for this comparison.
            Can be numeric (e.g., "57") or alphabetic (e.g., "F").
          example: "57"
        currentDate:
          type: string
          format: date
          description: |
            The date being compared in the current program year.
            This is the reference point for the comparison.
          example: "2026-01-24"
        previousYearDate:
          type: string
          format: date
          description: |
            The equivalent date in the previous program year.
            Calculated as approximately one year prior to currentDate.
          example: "2025-01-24"
        dataAvailable:
          type: boolean
          description: |
            Indicates whether comparison data is available.
            When false, the `metrics` field will not be present and
            a `message` will explain why data is unavailable.
          example: true
        message:
          type: string
          description: |
            Explanatory message when data is not available or partially available.
            Provides context about why the comparison could not be completed.
          example: "No data available for previous program year"
        metrics:
          $ref: '#/components/schemas/YearOverYearMetrics'
        multiYearTrends:
          $ref: '#/components/schemas/YearOverYearMultiYearTrends'
        programYears:
          type: object
          description: |
            Program year labels for the comparison.
            Useful for display purposes.
          properties:
            currentYear:
              type: string
              description: Current program year label.
              example: "2025-2026"
            previousYear:
              type: string
              description: Previous program year label.
              example: "2024-2025"
      example:
        districtId: "57"
        currentDate: "2026-01-24"
        previousYearDate: "2025-01-24"
        dataAvailable: true
        programYears:
          currentYear: "2025-2026"
          previousYear: "2024-2025"
        metrics:
          membership:
            current: 2500
            previous: 2350
            change: 150
            percentageChange: 6.38
          distinguishedClubs:
            current: 45
            previous: 37
            change: 8
            percentageChange: 21.62
            byLevel:
              smedley:
                current: 2
                previous: 1
                change: 1
              presidents:
                current: 8
                previous: 6
                change: 2
              select:
                current: 15
                previous: 12
                change: 3
              distinguished:
                current: 22
                previous: 18
                change: 4
          clubHealth:
            thrivingClubs:
              current: 85
              previous: 78
              change: 7
              percentageChange: 8.97
            vulnerableClubs:
              current: 12
              previous: 18
              change: -6
              percentageChange: -33.33
            interventionRequiredClubs:
              current: 5
              previous: 8
              change: -3
              percentageChange: -37.5
          dcpGoals:
            totalGoals:
              current: 576
              previous: 504
              change: 72
              percentageChange: 14.29
            averagePerClub:
              current: 4.8
              previous: 4.2
              change: 0.6
              percentageChange: 14.29
          clubCount:
            current: 120
            previous: 118
            change: 2
            percentageChange: 1.69
        multiYearTrends:
          available: true
          years:
            - year: 2024
              date: "2025-01-24"
              membership: 2350
              distinguishedClubs: 37
              totalDcpGoals: 504
              clubCount: 118
            - year: 2025
              date: "2026-01-24"
              membership: 2500
              distinguishedClubs: 45
              totalDcpGoals: 576
              clubCount: 120
          trends:
            membershipTrend: increasing
            distinguishedTrend: increasing
            dcpGoalsTrend: increasing

    YearOverYearComparisonResponse:
      type: object
      description: |
        Response containing year-over-year comparison data with snapshot metadata.
        Used by the GET /districts/{districtId}/year-over-year/{date} endpoint
        to return comprehensive year-over-year analytics for district leadership.
      required:
        - comparison
      properties:
        comparison:
          $ref: '#/components/schemas/YearOverYearComparison'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        comparison:
          districtId: "57"
          currentDate: "2026-01-24"
          previousYearDate: "2025-01-24"
          dataAvailable: true
          programYears:
            currentYear: "2025-2026"
            previousYear: "2024-2025"
          metrics:
            membership:
              current: 2500
              previous: 2350
              change: 150
              percentageChange: 6.38
            distinguishedClubs:
              current: 45
              previous: 37
              change: 8
              percentageChange: 21.62
              byLevel:
                smedley:
                  current: 2
                  previous: 1
                  change: 1
                presidents:
                  current: 8
                  previous: 6
                  change: 2
                select:
                  current: 15
                  previous: 12
                  change: 3
                distinguished:
                  current: 22
                  previous: 18
                  change: 4
            clubHealth:
              thrivingClubs:
                current: 85
                previous: 78
                change: 7
                percentageChange: 8.97
              vulnerableClubs:
                current: 12
                previous: 18
                change: -6
                percentageChange: -33.33
              interventionRequiredClubs:
                current: 5
                previous: 8
                change: -3
                percentageChange: -37.5
            dcpGoals:
              totalGoals:
                current: 576
                previous: 504
                change: 72
                percentageChange: 14.29
              averagePerClub:
                current: 4.8
                previous: 4.2
                change: 0.6
                percentageChange: 14.29
            clubCount:
              current: 120
              previous: 118
              change: 2
              percentageChange: 1.69
          multiYearTrends:
            available: true
            trends:
              membershipTrend: increasing
              distinguishedTrend: increasing
              dcpGoalsTrend: increasing
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

    # Export Response Schemas
    ExportClubData:
      type: object
      description: |
        Club data included in export responses.
        Contains comprehensive information about a single club.
      required:
        - clubId
        - clubName
        - division
        - area
        - memberCount
      properties:
        clubId:
          type: string
          description: Club identifier assigned by Toastmasters International.
          example: "1234567"
        clubName:
          type: string
          description: Official name of the club.
          example: "Downtown Speakers"
        division:
          type: string
          description: Division within the district (typically a letter).
          example: "A"
        area:
          type: string
          description: Area within the division (typically a number).
          example: "12"
        memberCount:
          type: integer
          description: Current total member count.
          example: 25
        activeMembers:
          type: integer
          description: Number of active members.
          example: 22
        membershipBase:
          type: integer
          description: Membership base used for DCP calculations.
          example: 20
        goalsAchieved:
          type: integer
          description: Number of DCP goals achieved.
          minimum: 0
          maximum: 10
          example: 7
        distinguishedStatus:
          type: string
          description: |
            Distinguished club status based on DCP goals achieved.
            - Distinguished: 5+ goals
            - Select Distinguished: 7+ goals
            - President's Distinguished: 9+ goals
          enum:
            - Not Distinguished
            - Distinguished
            - Select Distinguished
            - President's Distinguished
          example: "Select Distinguished"
        charterDate:
          type: string
          format: date
          description: Date the club was chartered.
          example: "2015-03-15"
        educationalAwards:
          type: integer
          description: Total educational awards earned by club members.
          example: 12

    ExportDateRange:
      type: object
      description: Date range for the exported data.
      properties:
        startDate:
          type: string
          format: date
          description: Start date of the export range.
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          description: End date of the export range.
          example: "2026-01-24"

    ExportSummary:
      type: object
      description: Summary statistics for the exported data.
      required:
        - totalClubs
        - totalMembers
      properties:
        totalClubs:
          type: integer
          description: Total number of clubs in the export.
          example: 120
        totalMembers:
          type: integer
          description: Total membership across all clubs.
          example: 2500
        averageGoalsAchieved:
          type: number
          format: float
          description: Average DCP goals achieved per club.
          example: 6.2
        distinguishedClubs:
          type: integer
          description: Number of clubs with Distinguished status or higher.
          example: 45

    ExportData:
      type: object
      description: |
        Complete export data for a district including all clubs,
        summary statistics, and metadata about the export.
      required:
        - districtId
        - districtName
        - exportDate
        - clubs
      properties:
        districtId:
          type: string
          description: District identifier.
          example: "57"
        districtName:
          type: string
          description: District name.
          example: "District 57"
        exportDate:
          type: string
          format: date
          description: Date the export was generated.
          example: "2026-01-24"
        dateRange:
          $ref: '#/components/schemas/ExportDateRange'
        clubs:
          type: array
          description: Array of club data included in the export.
          items:
            $ref: '#/components/schemas/ExportClubData'
        summary:
          $ref: '#/components/schemas/ExportSummary'

    ExportResponse:
      type: object
      description: |
        Response containing exported district data with snapshot metadata.
        Used by the GET /districts/{districtId}/export endpoint to return
        district data in JSON format for programmatic access.
      required:
        - export
      properties:
        export:
          $ref: '#/components/schemas/ExportData'
        _snapshot_metadata:
          $ref: '#/components/schemas/SnapshotMetadata'
      example:
        export:
          districtId: "57"
          districtName: "District 57"
          exportDate: "2026-01-24"
          dateRange:
            startDate: "2025-07-01"
            endDate: "2026-01-24"
          clubs:
            - clubId: "1234567"
              clubName: "Downtown Speakers"
              division: "A"
              area: "12"
              memberCount: 25
              activeMembers: 22
              membershipBase: 20
              goalsAchieved: 7
              distinguishedStatus: "Select Distinguished"
              charterDate: "2015-03-15"
              educationalAwards: 12
            - clubId: "7654321"
              clubName: "Morning Leaders"
              division: "A"
              area: "12"
              memberCount: 32
              activeMembers: 30
              membershipBase: 28
              goalsAchieved: 9
              distinguishedStatus: "President's Distinguished"
              charterDate: "2010-09-01"
              educationalAwards: 18
          summary:
            totalClubs: 120
            totalMembers: 2500
            averageGoalsAchieved: 6.2
            distinguishedClubs: 45
        _snapshot_metadata:
          snapshot_id: "2026-01-24"
          created_at: "2026-01-24T06:00:00Z"
          status: success
          is_closing_period: false
          is_fallback: false
          data_source: scraper
          from_cache: true

  parameters:
    districtIdParam:
      name: districtId
      in: path
      required: true
      description: |
        District identifier. Can be numeric (e.g., "57") or alphabetic (e.g., "F")
        for special districts.
      schema:
        type: string
      example: "57"

    clubIdParam:
      name: clubId
      in: path
      required: true
      description: |
        Club identifier assigned by Toastmasters International.
        This is a numeric string that uniquely identifies the club globally.
      schema:
        type: string
      example: "1234567"

    datePathParam:
      name: date
      in: path
      required: true
      description: |
        Date for the comparison in ISO 8601 format (YYYY-MM-DD).
        This date serves as the reference point for year-over-year comparison.
        The API will compare data from this date against the equivalent date
        in the previous program year (approximately one year prior).
      schema:
        type: string
        format: date
      example: "2026-01-24"

    dateQueryParam:
      name: date
      in: query
      required: false
      description: |
        Specific date for data retrieval in ISO 8601 format (YYYY-MM-DD).
        If not provided, defaults to the most recent available snapshot.
      schema:
        type: string
        format: date
      example: "2026-01-24"

    startDateParam:
      name: startDate
      in: query
      required: false
      description: |
        Start date for date range queries in ISO 8601 format (YYYY-MM-DD).
        Must be before or equal to endDate when both are provided.
      schema:
        type: string
        format: date
      example: "2025-07-01"

    endDateParam:
      name: endDate
      in: query
      required: false
      description: |
        End date for date range queries in ISO 8601 format (YYYY-MM-DD).
        Must be after or equal to startDate when both are provided.
      schema:
        type: string
        format: date
      example: "2026-01-24"

    monthsParam:
      name: months
      in: query
      required: false
      description: |
        Number of months of historical data to retrieve.
        Used for membership history and educational awards endpoints.
      schema:
        type: integer
        minimum: 1
        maximum: 24
      example: 6

    limitParam:
      name: limit
      in: query
      required: false
      description: |
        Maximum number of results to return.
        Used for pagination and limiting response size.
      schema:
        type: integer
        minimum: 1
        default: 100
      example: 50

    formatParam:
      name: format
      in: query
      required: false
      description: |
        Export format for the data. Determines the content type of the response.

        - `csv`: Returns data in CSV format with `text/csv` content type.
          Suitable for spreadsheet applications and data analysis tools.
        - `json`: Returns data in JSON format with `application/json` content type.
          Suitable for programmatic access and API integrations.

        If not specified, defaults to `json`.
      schema:
        type: string
        enum:
          - csv
          - json
        default: json
      example: csv

    backfillIdParam:
      name: backfillId
      in: path
      required: true
      description: |
        Unique identifier for a backfill operation.
        This ID is returned when initiating a backfill via `POST /districts/backfill`
        and can be used to monitor progress or cancel the operation.
      schema:
        type: string
      example: "bf-2026-01-24-abc123"

    snapshotIdParam:
      name: snapshotId
      in: path
      required: true
      description: |
        Unique identifier for a snapshot, typically an ISO date string (YYYY-MM-DD)
        representing when the data was collected.

        Snapshots represent complete, normalized views of the source data at specific
        points in time. Use the `GET /admin/snapshots` endpoint to discover available
        snapshot IDs.
      schema:
        type: string
        format: date
      example: "2026-01-24"
