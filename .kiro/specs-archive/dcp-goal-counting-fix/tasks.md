# Implementation Plan

- [x] 1. Add helper method for field name resolution
  - Create `getLevel4FieldName()` private method in AnalyticsEngine class
  - Implement logic to detect and return correct field names based on data structure
  - Handle 2025+ format (Path Completions), 2020-2024 format (Level 5s), and 2019 format (CL/AL/DTMs)
  - Add fallback to 2025+ format if no match found
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 2. Fix DCP goal counting logic in analyzeDCPGoals method
  - [x] 2.1 Update Goal 3 logic to check both base Level 2s >= 2 AND additional Level 2s >= 2
    - Modify the Goal 3 counting condition
    - _Requirements: 2.1_
  - [x] 2.2 Update Goal 5 logic to use field name helper and check base field >= 1
    - Call `getLevel4FieldName()` to get correct field names
    - Update Goal 5 condition to check base field >= 1
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.7_
  - [x] 2.3 Update Goal 6 logic to check both base field >= 1 AND additional field >= 1
    - Use field names from helper method
    - Update Goal 6 condition to check both base and additional fields
    - _Requirements: 1.4, 1.5, 1.6, 1.7, 1.8, 1.9_
  - [x] 2.4 Update Goal 8 logic to check both base New Members >= 4 AND additional New Members >= 4
    - Modify the Goal 8 counting condition
    - _Requirements: 2.2_

- [x] 3. Add comprehensive unit tests for DCP goal counting
  - [x] 3.1 Create test suite for field name resolution helper
    - Test 2025+ format detection
    - Test 2020-2024 format detection
    - Test 2019 format detection
    - Test fallback behavior
    - _Requirements: 3.1_
  - [x] 3.2 Create test suite for Goal 5 counting
    - Test with 0 Level 4 awards (should not count)
    - Test with 1 Level 4 award (should count)
    - Test with 2+ Level 4 awards (should count)
    - Test with all three data formats (2025+, 2020-2024, 2019)
    - _Requirements: 3.1, 3.2, 3.5_
  - [x] 3.3 Create test suite for Goal 6 counting
    - Test with base but no additional (should not count)
    - Test with additional but no base (should not count)
    - Test with both base and additional (should count)
    - Test with all three data formats
    - _Requirements: 3.1, 3.3, 3.5_
  - [x] 3.4 Create test suite for Goals 3 and 8 counting
    - Test Goal 3 with base but no additional Level 2s
    - Test Goal 3 with both base and additional Level 2s
    - Test Goal 8 with base but no additional New Members
    - Test Goal 8 with both base and additional New Members
    - _Requirements: 3.1, 3.4, 3.5_
  - [x] 3.5 Create integration test with real cached data
    - Load actual district data from November 2024
    - Verify Goals 5 and 6 return non-zero counts
    - Verify counts match manual inspection of data
    - _Requirements: 3.1, 3.5, 4.1, 4.4_

- [x] 4. Perform manual validation with real data
  - [x] 4.1 Test with 2025 program year data
    - Load district 61 data from November 2025
    - Verify Goals 5 and 6 show non-zero counts in API response
    - Compare counts to manual CSV inspection
    - _Requirements: 4.1, 4.2, 4.4_
  - [x] 4.2 Test with 2020-2024 program year data
    - Load district 61 data from November 2023
    - Verify correct field names are used
    - Verify accurate goal counts
    - _Requirements: 4.1, 4.4_
  - [x] 4.3 Test with 2019 program year data
    - Load district 61 data from November 2019
    - Verify correct field names are used
    - Verify accurate goal counts
    - _Requirements: 4.1, 4.4_
  - [x] 4.4 Test frontend display
    - Navigate to analytics page in browser
    - Select 2024-2025 program year
    - Verify DCP goal chart shows non-zero values for Goals 5 and 6
    - Verify percentages are calculated correctly
    - _Requirements: 4.3_

- [ ] 5. Add debug logging for field name resolution
  - Add logger.debug statement in getLevel4FieldName method
  - Log resolved field names and club ID for troubleshooting
  - Ensure logging doesn't impact performance
  - _Requirements: 1.7_
