# Requirements Document

## Introduction

This document specifies the requirements for fixing the type mismatch between the analytics-core package and the frontend for the `distinguishedClubs` field in `DistrictAnalytics`. The current implementation produces an array of `DistinguishedClubSummary` objects, while the frontend expects a summary object with counts by recognition level. This mismatch causes runtime errors when the frontend attempts to access properties like `.total` on an array.

## Glossary

- **Analytics_Core**: The shared analytics computation package (`packages/analytics-core`) that produces district analytics data
- **Frontend**: The React application that consumes and displays district analytics
- **Backend**: The Express server that serves pre-computed analytics to the frontend
- **DistrictAnalytics**: The data structure containing comprehensive analytics for a district
- **DistinguishedClubSummary**: An object containing details about a single distinguished club (clubId, clubName, status, dcpPoints, goalsCompleted)
- **DistinguishedClubCounts**: A summary object containing counts of clubs at each recognition level (smedley, presidents, select, distinguished, total)
- **Recognition_Level**: The distinguished status of a club: Smedley, President's, Select, Distinguished, or None
- **Pre_Computed_Analytics**: Analytics files generated by collector-cli and stored on disk for serving by the backend

## Requirements

### Requirement 1: Update DistrictAnalytics Type Definition

**User Story:** As a developer, I want the `DistrictAnalytics.distinguishedClubs` type to match the frontend expectations, so that the frontend can access count properties without runtime errors.

#### Acceptance Criteria

1. THE Analytics_Core SHALL define `distinguishedClubs` in `DistrictAnalytics` as an object with properties: `smedley` (number), `presidents` (number), `select` (number), `distinguished` (number), and `total` (number)
2. THE Analytics_Core SHALL export a new type `DistinguishedClubCounts` representing the summary object structure
3. THE Analytics_Core SHALL add a new field `distinguishedClubsList` of type `DistinguishedClubSummary[]` to preserve the detailed club information

### Requirement 2: Update AnalyticsComputer to Produce Correct Format

**User Story:** As a developer, I want the AnalyticsComputer to produce the correct `distinguishedClubs` format, so that the backend serves data compatible with the frontend.

#### Acceptance Criteria

1. WHEN the AnalyticsComputer computes district analytics, THE Analytics_Core SHALL populate `distinguishedClubs` with a counts object containing `smedley`, `presidents`, `select`, `distinguished`, and `total` fields
2. WHEN the AnalyticsComputer computes district analytics, THE Analytics_Core SHALL populate `distinguishedClubsList` with the array of `DistinguishedClubSummary` objects
3. THE Analytics_Core SHALL compute the `total` field as the sum of `smedley`, `presidents`, `select`, and `distinguished` counts

### Requirement 3: Update DistinguishedClubAnalyticsModule

**User Story:** As a developer, I want the DistinguishedClubAnalyticsModule to provide both count summaries and detailed club lists, so that the AnalyticsComputer can populate both fields.

#### Acceptance Criteria

1. THE DistinguishedClubAnalyticsModule SHALL provide a method to generate `DistinguishedClubCounts` from snapshots
2. THE DistinguishedClubAnalyticsModule SHALL include `smedley` count in the counts object for clubs achieving Smedley Distinguished status (10+ goals AND 25+ members)
3. WHEN counting distinguished clubs, THE DistinguishedClubAnalyticsModule SHALL ensure each club is counted in exactly one category (the highest achieved level)

### Requirement 4: Maintain Backward Compatibility

**User Story:** As a system operator, I want existing pre-computed analytics files to continue working, so that I don't need to regenerate all historical data immediately.

#### Acceptance Criteria

1. IF the backend reads a pre-computed analytics file with `distinguishedClubs` as an array, THEN THE Backend SHALL transform it to the expected object format before serving
2. WHEN transforming legacy data, THE Backend SHALL count clubs by their status field to populate the counts object
3. THE Backend SHALL log a warning when serving transformed legacy analytics data

### Requirement 5: Type Safety

**User Story:** As a developer, I want all type definitions to be consistent across packages, so that TypeScript catches type mismatches at compile time.

#### Acceptance Criteria

1. THE Frontend type definition for `distinguishedClubs` SHALL match the Analytics_Core type definition exactly
2. THE Analytics_Core SHALL NOT use the `any` type in any type definitions or implementations
3. WHEN the types are aligned, THE TypeScript compiler SHALL report zero type errors related to `distinguishedClubs`
